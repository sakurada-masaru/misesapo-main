<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>清掃報告書 | ミセサポ</title>
  @include('partials.head-links')
  <style>
    body { background:#f4f7f6; }
    .report-container { max-width: 900px; margin: 20px auto; background:#fff; border:1px solid #ddd; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,.05); overflow:hidden; }
    .report-header { background: var(--primary); color:#fff; padding:16px 24px; text-align:center; font-size:1.2rem; font-weight:600; }
    .items-list-bar { background:#f9f9f9; padding:12px 24px; border-bottom:1px solid #eee; display:flex; align-items:center; flex-wrap:wrap; gap:15px; }
    .items-list-label { font-weight:600; color:#555; font-size:.9rem; }
    .items-list-item { font-size:.9rem; color:#333; padding:6px 0; }
    .cleaning-section { padding:24px; border-bottom:1px solid #eee; }
    .cleaning-section:last-child { border-bottom:none; }
    .item-header { display:flex; align-items:center; flex-wrap:wrap; gap:15px; margin-bottom:20px; }
    .item-title { font-size:1.6rem; font-weight:600; color:#222; margin:0; }
    .item-details { display:flex; flex-wrap:wrap; gap:10px; padding-top:5px; }
    .detail-tag { background:#f0f4f8; color:#555; padding:6px 12px; border-radius:20px; font-size:.85rem; }
    .subsection { margin-top:20px; }
    .subsection-title { font-size:1.1rem; font-weight:600; color:#333; border-bottom:2px solid #333; padding-bottom:5px; margin-top:25px; margin-bottom:15px; }
    .subsection p { margin:0 0 15px 0; color:#555; }
    .image-comparison { display:flex; justify-content:space-between; gap:20px; margin-top:20px; }
    .image-box { flex:1; min-width:200px; text-align:center; }
    .image-box h4 { font-size:1rem; font-weight:600; color:#444; margin:0 0 10px; }
    .image-box img { width:100%; height:auto; border-radius:8px; border:1px solid #ccc; background:#fafafa; }
    /* Satisfaction form */
    .satisfaction-form { padding: 24px; border-top: 1px solid #eee; }
    .satisfaction-form .next-page-link { text-align: right; margin-bottom: 12px; }
    .satisfaction-form .next-page-link a { color: var(--primary); font-weight: 600; }
    .form-question { font-weight: 700; color:#333; margin: 6px 0 12px; text-align: center; }
    .rating-stars { display:flex; align-items:center; margin-bottom:30px; gap:15px; flex-wrap:wrap; justify-content:center; }
    .rating-label { font-size:.95rem; color:#555; flex-shrink:0; }
    .stars { display:flex; gap:5px; justify-content:flex-start; }
    .star { font-size:1.8rem; color:#ccc; cursor:pointer; line-height:1; user-select:none; }
    .star.filled { color: var(--primary); }
    .comment-section { max-width: 720px; margin: 0 auto; }
    .comment-label { display:block; font-weight:600; margin: 0 0 6px; color:#555; }
    .comment-textarea { width:100%; min-height: 96px; border:1px solid #e5e7eb; border-radius:8px; padding:10px 12px; font: inherit; }
    .submit-button-wrapper { text-align:center; margin-top: 16px; }
    .submit-button { display:inline-flex; align-items:center; gap:8px; height:40px; padding:0 16px; border-radius:999px; border: 1px solid transparent; background: var(--primary); color:#fff; box-shadow: 0 1px 2px rgba(0,0,0,.06); }
    .submit-button:hover { background: var(--primary-600); }
    .submit-button svg { width:18px; height:18px; fill: currentColor; }
    .satisfaction-thanks { display:none; text-align:center; padding: 48px 24px; font-weight:700; color:#1f2937; }
    @media (max-width: 768px) {
      .report-container { margin:0; border-radius:0; border-left:none; border-right:none; }
      .items-list-bar { flex-direction:column; align-items:flex-start; padding:15px; }
      .cleaning-section { padding:20px 15px; }
      .item-header { flex-direction:column; align-items:flex-start; gap:10px; }
      .item-title { font-size:1.4rem; }
      .image-comparison { flex-direction:column; gap:25px; }
      .image-box { min-width:100%; }
    }
  </style>
</head>
<body class="theme-pink bg-white">
  @include('partials.header')
  <section class="hero">
    <img class="hero-img" src="/images/header-main.png" alt="レポート ヒーロー" />
    <div class="hero-overlay" aria-hidden="true"></div>
  </section>
  <main class="section-gap-lg">
  <div class="report-container">
    <header class="report-header">清掃日時 {{ cleaning_datetime }}</header>
    <div class="items-list-bar" style="justify-content: space-between; align-items:center;">
      <div style="display:flex; align-items:center; gap:15px; flex-wrap:wrap;">
        <span class="items-list-label">実施清掃項目</span>
        @foreach $cleaning_content
        <span class="items-list-item">{{ value }}</span>
        @endforeach
      </div>
      <div class="report-nav" style="display:flex; gap:8px; flex-wrap:wrap;">
        <a class="{{ prev_class }}" href="{{ prev_href }}">&lt; 前のレポート</a>
        <a class="{{ next_class }}" href="{{ next_href }}">次のレポート &gt;</a>
      </div>
    </div>
    <div class="report-main">
      @foreach $detail
      <section class="cleaning-section">
        <div class="item-header">
          <h3 class="item-title">{{ cleaning_item }}</h3>
          <div class="item-details">{{ tags_html }}</div>
        </div>
        <div class="subsection">
          <h4 class="subsection-title">作業内容</h4>
          <p>{{ work_content }}</p>
        </div>
        <div class="image-comparison">
          <div class="image-box">
            <h4>清掃前</h4>
            <img src="{{ before_image }}" alt="清掃前の画像" />
          </div>
          <div class="image-box">
            <h4>清掃後</h4>
            <img src="{{ after_image }}" alt="清掃後の画像" />
          </div>
        </div>
        <div class="subsection">
          <h4 class="subsection-title">作業メモ</h4>
          <p>{{ work_memo }}</p>
        </div>
      </section>
      @endforeach
    </div>
    <!-- 満足度アンケートフォーム -->
    <div id="satisfaction-wrap" class="satisfaction-form">
      <div class="next-page-link"><a href="#">次のページへ</a></div>
      <div class="form-question">今回の作業の満足度はいかがでしたか？</div>
      <div class="rating-stars">
        <span class="rating-label">良い</span>
        <div class="stars" aria-label="5段階評価" role="radiogroup">
          <span class="star" data-value="1" role="radio" aria-label="1" aria-checked="false" tabindex="0">☆</span>
          <span class="star" data-value="2" role="radio" aria-label="2" aria-checked="false" tabindex="0">☆</span>
          <span class="star" data-value="3" role="radio" aria-label="3" aria-checked="false" tabindex="0">☆</span>
          <span class="star" data-value="4" role="radio" aria-label="4" aria-checked="false" tabindex="0">☆</span>
          <span class="star" data-value="5" role="radio" aria-label="5" aria-checked="false" tabindex="0">☆</span>
        </div>
        <span class="rating-label">悪い</span>
      </div>
      <div class="comment-section">
        <label for="storeComment" class="comment-label">店舗担当者コメント</label>
        <textarea id="storeComment" class="comment-textarea" placeholder="コメントを入力してください"></textarea>
      </div>
      <div class="submit-button-wrapper">
        <button id="satisfaction-submit" type="button" class="submit-button">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
          </svg>
          コメントを送る
        </button>
      </div>
    </div>
    <div id="satisfaction-thanks" class="satisfaction-thanks">コメントをお寄せいただきありがとうございました。</div>
  </div>
  </main>
  @include('partials.footer')
  <style>
    .report-nav-btn { color: var(--primary); font-weight:600; }
    .report-nav-btn.disabled { color:#cbd5e1; pointer-events:none; cursor:not-allowed; }
  </style>
  <script>
    // Ensure scrollable in case prior pages set overflow hidden
    document.addEventListener('DOMContentLoaded', function(){
      document.body.style.overflow = '';
      document.documentElement.style.overflow = '';
      // Rating stars logic
      const wrap = document.getElementById('satisfaction-wrap');
      const thanks = document.getElementById('satisfaction-thanks');
      if (wrap) {
        const stars = Array.from(wrap.querySelectorAll('.star'));
        let rating = 0;
        function render() {
          stars.forEach((s, i) => {
            const filled = (i + 1) <= rating;
            s.classList.toggle('filled', filled);
            s.setAttribute('aria-checked', String(filled && (i + 1) === rating));
          });
        }
        stars.forEach((s) => {
          s.addEventListener('click', () => { rating = Number(s.dataset.value || '0'); render(); });
          s.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); rating = Number(s.dataset.value || '0'); render(); }
            if (e.key === 'ArrowRight') { e.preventDefault(); rating = Math.min(5, rating + 1) || 1; render(); }
            if (e.key === 'ArrowLeft') { e.preventDefault(); rating = Math.max(1, rating - 1) || 1; render(); }
          });
        });
        const btn = document.getElementById('satisfaction-submit');
        if (btn) btn.addEventListener('click', () => {
          // 簡易バリデーション: rating未選択でも送信可にする場合はこの条件を外す
          // if (!rating) { alert('★を選択してください'); return; }
          wrap.style.display = 'none';
          if (thanks) thanks.style.display = 'block';
          // ここで送信APIにPOSTするなどのモックを入れてもOK
          // console.log({ rating, comment: document.getElementById('storeComment')?.value || '' });
        });
      }
    });
  </script>
  <script>
    // Ensure scrollable in case prior pages set overflow hidden
    document.addEventListener('DOMContentLoaded', function(){
      document.body.style.overflow = '';
      document.documentElement.style.overflow = '';
    });
  </script>
</body>
</html>
