@layout('layouts.base')
<script src="/js/client_auth.js"></script>
@json('data/meta/user_settings_title.json', $title)
@json('data/meta/user_settings_body_class.json', $body_class)

<main id="main" class="container mypage">
  <!-- Breadcrumbs -->
  <nav class="breadcrumb" aria-label="breadcrumb">
    <a href="/mypage">マイページ</a>
    <span class="sep">›</span>
    <span aria-current="page">アカウント設定</span>
  </nav>

  <h1 class="page-title">アカウント設定</h1>

  <!-- プロフィール設定 -->
  <section class="section">
    <h2 class="section-title">プロフィール設定</h2>
    <div class="card">
      <div class="profile-settings">
        <div class="profile-photo-section">
          <div class="profile-photo-preview">
            <img src="/images/logo_144x144.png" alt="プロフィール写真" id="profile-photo-preview" />
          </div>
          <button class="btn btn-outline btn-sm" onclick="document.getElementById('profile-photo-input').click()">
            <i class="fa-solid fa-camera" aria-hidden="true"></i>
            写真を変更
          </button>
          <input type="file" id="profile-photo-input" accept="image/*" style="display: none;" />
        </div>
        <div class="profile-form">
          <div class="form-group">
            <label for="display-name" class="form-label">表示名</label>
            <input type="text" id="display-name" class="form-control" value="山田 太郎" />
            <p class="form-help">サイト上で表示される名前を設定できます</p>
          </div>
          <div class="form-group">
            <label for="email" class="form-label">メールアドレス</label>
            <input type="email" id="email" class="form-control" value="yamada@dart-ace.com" />
            <p class="form-help">ログインに使用するメールアドレスです</p>
          </div>
        </div>
      </div>
      <div class="form-actions">
        <button class="btn btn-primary btn-round" onclick="saveProfileSettings()">
          <i class="fa-solid fa-save" aria-hidden="true"></i>
          保存する
        </button>
      </div>
    </div>
  </section>

  <!-- パスワード変更 -->
  <section class="section">
    <h2 class="section-title">パスワード変更</h2>
    <div class="card">
      <div class="password-form">
        <div class="form-group">
          <label for="current-password" class="form-label">現在のパスワード</label>
          <input type="password" id="current-password" class="form-control" />
        </div>
        <div class="form-group">
          <label for="new-password" class="form-label">新しいパスワード</label>
          <input type="password" id="new-password" class="form-control" />
          <p class="form-help">8文字以上、英数字と記号を組み合わせてください</p>
        </div>
        <div class="form-group">
          <label for="confirm-password" class="form-label">新しいパスワード（確認）</label>
          <input type="password" id="confirm-password" class="form-control" />
        </div>
      </div>
      <div class="form-actions">
        <button class="btn btn-primary btn-round" onclick="changePassword()">
          <i class="fa-solid fa-key" aria-hidden="true"></i>
          パスワードを変更
        </button>
      </div>
    </div>
  </section>

  <!-- 通知設定 -->
  <section class="section">
    <h2 class="section-title">通知設定</h2>
    <div class="card">
      <div class="notification-settings">
        <div class="notification-item">
          <div class="notification-info">
            <h3 class="notification-title">メール通知</h3>
            <p class="notification-description">清掃予定、レポート、お知らせなどのメール通知を受け取ります</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="email-notifications" checked />
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="notification-item">
          <div class="notification-info">
            <h3 class="notification-title">清掃予定の通知</h3>
            <p class="notification-description">清掃予定日の前日にメールでお知らせします</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="schedule-notifications" checked />
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="notification-item">
          <div class="notification-info">
            <h3 class="notification-title">レポート完了の通知</h3>
            <p class="notification-description">清掃レポートが作成されたらメールでお知らせします</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="report-notifications" checked />
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="notification-item">
          <div class="notification-info">
            <h3 class="notification-title">お知らせの通知</h3>
            <p class="notification-description">お知らせやメンテナンス情報をメールでお知らせします</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="announcement-notifications" checked />
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      <div class="form-actions">
        <button class="btn btn-primary btn-round" onclick="saveNotificationSettings()">
          <i class="fa-solid fa-bell" aria-hidden="true"></i>
          通知設定を保存
        </button>
      </div>
    </div>
  </section>

  <!-- セキュリティ設定 -->
  <section class="section">
    <h2 class="section-title">セキュリティ設定</h2>
    <div class="card">
      <div class="security-settings">
        <div class="security-item">
          <div class="security-info">
            <h3 class="security-title">二要素認証（2FA）</h3>
            <p class="security-description">セキュリティを強化するために、ログイン時にコードを入力する必要があります</p>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="two-factor-auth" />
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="security-item">
          <div class="security-info">
            <h3 class="security-title">ログイン履歴</h3>
            <p class="security-description">最近のログイン履歴を確認できます</p>
          </div>
          <a href="#" class="btn btn-outline btn-sm" onclick="viewLoginHistory()">
            履歴を確認
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- アカウント削除 -->
  <section class="section">
    <h2 class="section-title">アカウント管理</h2>
    <div class="card danger-zone">
      <div class="danger-zone-content">
        <h3 class="danger-zone-title">アカウントの削除</h3>
        <p class="danger-zone-description">アカウントを削除すると、すべてのデータが完全に削除され、復元できません。この操作は取り消せません。</p>
        <button class="btn btn-danger btn-round" onclick="confirmAccountDeletion()">
          <i class="fa-solid fa-trash" aria-hidden="true"></i>
          アカウントを削除
        </button>
      </div>
    </div>
  </section>

  <div class="page-actions">
    <a class="btn btn-outline-primary btn-round btn-lg" href="/mypage">
      <i class="fa-solid fa-arrow-left" aria-hidden="true"></i>
      マイページへ戻る
    </a>
  </div>
</main>

<style>
/* ユーザー設定ページのスタイル */
.page-user-settings .profile-settings {
  display: flex;
  gap: 24px;
  align-items: flex-start;
  margin-bottom: 24px;
}

.profile-photo-section {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
}

.profile-photo-preview {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  overflow: hidden;
  border: 3px solid #e5e7eb;
  background: #f3f4f6;
}

.profile-photo-preview img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.profile-form {
  flex: 1;
}

.notification-item,
.security-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 0;
  border-bottom: 1px solid #e5e7eb;
}

.notification-item:last-child,
.security-item:last-child {
  border-bottom: none;
}

.notification-info,
.security-info {
  flex: 1;
  margin-right: 16px;
}

.notification-title,
.security-title {
  font-size: 1rem;
  font-weight: 600;
  color: #111827;
  margin-bottom: 4px;
}

.notification-description,
.security-description {
  font-size: 0.875rem;
  color: #6b7280;
  margin: 0;
}

.toggle-switch {
  position: relative;
  display: inline-block;
  width: 48px;
  height: 24px;
}

.toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition: 0.3s;
  border-radius: 24px;
}

.toggle-slider:before {
  position: absolute;
  content: "";
  height: 18px;
  width: 18px;
  left: 3px;
  bottom: 3px;
  background-color: white;
  transition: 0.3s;
  border-radius: 50%;
}

.toggle-switch input:checked + .toggle-slider {
  background-color: #3b82f6;
}

.toggle-switch input:checked + .toggle-slider:before {
  transform: translateX(24px);
}

.danger-zone {
  border: 2px solid #ef4444;
  background: #fef2f2;
}

.danger-zone-content {
  padding: 16px;
}

.danger-zone-title {
  font-size: 1.125rem;
  font-weight: 600;
  color: #dc2626;
  margin-bottom: 8px;
}

.danger-zone-description {
  font-size: 0.875rem;
  color: #991b1b;
  margin-bottom: 16px;
}

.btn-danger {
  background: #dc2626;
  color: white;
  border-color: #dc2626;
}

.btn-danger:hover {
  background: #b91c1c;
  border-color: #b91c1c;
}

.form-actions {
  margin-top: 24px;
  padding-top: 24px;
  border-top: 1px solid #e5e7eb;
}

@media (max-width: 767.98px) {
  .profile-settings {
    flex-direction: column;
  }

  .notification-item,
  .security-item {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
  }

  .notification-info,
  .security-info {
    margin-right: 0;
  }
}
</style>

<script>
// プロフィール写真のプレビュー
document.getElementById('profile-photo-input')?.addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById('profile-photo-preview').src = e.target.result;
    };
    reader.readAsDataURL(file);
  }
});

// プロフィール設定の保存
function saveProfileSettings() {
  const displayName = document.getElementById('display-name').value;
  const email = document.getElementById('email').value;
  
  // バリデーション
  if (!displayName || !email) {
    alert('すべての項目を入力してください');
    return;
  }

  // モック保存処理
  alert('プロフィール設定を保存しました');
}

// パスワード変更
function changePassword() {
  const currentPassword = document.getElementById('current-password').value;
  const newPassword = document.getElementById('new-password').value;
  const confirmPassword = document.getElementById('confirm-password').value;

  // バリデーション
  if (!currentPassword || !newPassword || !confirmPassword) {
    alert('すべての項目を入力してください');
    return;
  }

  if (newPassword !== confirmPassword) {
    alert('新しいパスワードと確認用パスワードが一致しません');
    return;
  }

  if (newPassword.length < 8) {
    alert('パスワードは8文字以上にしてください');
    return;
  }

  // モック保存処理
  alert('パスワードを変更しました');
  
  // フォームをリセット
  document.getElementById('current-password').value = '';
  document.getElementById('new-password').value = '';
  document.getElementById('confirm-password').value = '';
}

// 通知設定の保存
function saveNotificationSettings() {
  const settings = {
    email: document.getElementById('email-notifications').checked,
    schedule: document.getElementById('schedule-notifications').checked,
    report: document.getElementById('report-notifications').checked,
    announcement: document.getElementById('announcement-notifications').checked
  };

  // モック保存処理
  localStorage.setItem('notificationSettings', JSON.stringify(settings));
  alert('通知設定を保存しました');
}

// ログイン履歴の確認
function viewLoginHistory() {
  alert('ログイン履歴機能は今後実装予定です');
}

// アカウント削除の確認
function confirmAccountDeletion() {
  if (confirm('本当にアカウントを削除しますか？\n\nこの操作は取り消せません。すべてのデータが完全に削除されます。')) {
    if (confirm('最終確認：アカウントを削除してもよろしいですか？')) {
      alert('アカウント削除機能は今後実装予定です');
      // 実際の実装では、ここで削除処理を実行
    }
  }
}

// ページ読み込み時に通知設定を復元
(function() {
  const savedSettings = localStorage.getItem('notificationSettings');
  if (savedSettings) {
    const settings = JSON.parse(savedSettings);
    document.getElementById('email-notifications').checked = settings.email ?? true;
    document.getElementById('schedule-notifications').checked = settings.schedule ?? true;
    document.getElementById('report-notifications').checked = settings.report ?? true;
    document.getElementById('announcement-notifications').checked = settings.announcement ?? true;
  }
})();
</script>


