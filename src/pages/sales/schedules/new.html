@layout('layouts.base')
@json('data/meta/sales_schedules_new_title.json', $title)
@json('data/meta/sales_schedules_new_body_class.json', $body_class)

<link rel="stylesheet" href="/css/sales-schedules.css" />
<script src="/js/data_utils.js"></script>
<script src="/js/aws-services-api.js"></script>

<main id="main" class="container sales-schedules-new">
  <div class="page-header">
    <a href="/sales/schedules" class="back-btn">
      <i class="fas fa-chevron-left"></i>
    </a>
    <h1 class="page-title">スケジュール作成</h1>
  </div>

  <form id="schedule-form" class="schedule-form-new">
    <input type="hidden" id="schedule-id" name="id">
    
    <div class="form-row">
      <div class="form-field">
        <label for="schedule-store-search">店舗・ブランド・法人名 <span class="required">*</span></label>
        <div class="store-search-wrapper">
          <div class="store-search-controls">
            <select id="store-category-filter" class="store-category-filter">
              <option value="">全て</option>
              <option value="store">店舗名</option>
              <option value="brand">ブランド名</option>
              <option value="client">法人名</option>
            </select>
            <input type="text" id="schedule-store-search" placeholder="店舗名、ブランド名、法人名で検索..." autocomplete="off" required>
          </div>
          <input type="hidden" id="schedule-store" name="store_id">
          <div class="store-search-results" id="schedule-store-results" style="display: none;"></div>
        </div>
      </div>
    </div>
    
    <div class="form-row">
      <div class="form-field half">
        <label for="schedule-date">日付 <span class="required">*</span></label>
        <input type="date" id="schedule-date" name="scheduled_date" required>
      </div>
      <div class="form-field half">
        <label for="schedule-time">時間 <span class="required">*</span></label>
        <input type="time" id="schedule-time" name="scheduled_time" required>
      </div>
    </div>
    
    <div class="form-row">
      <div class="form-field half">
        <label for="schedule-duration">作業時間（分）</label>
        <input type="number" id="schedule-duration" name="duration_minutes" value="60" min="15" step="15">
      </div>
      <div class="form-field half">
        <label for="schedule-sales">営業担当者</label>
        <select id="schedule-sales" name="sales_id">
          <option value="">未設定</option>
        </select>
      </div>
    </div>
    
    <div class="form-row">
      <div class="form-field half">
        <label for="schedule-worker">担当清掃員</label>
        <select id="schedule-worker" name="worker_id">
          <option value="">全員（オープン）</option>
        </select>
      </div>
    </div>
    
    <div class="form-row">
      <div class="form-field">
        <label for="cleaning-items-search">清掃内容</label>
        <div class="cleaning-items-search-wrapper">
          <div class="store-search-controls">
            <select id="cleaning-category-filter" class="store-category-filter">
              <option value="">全て</option>
              <option value="service">サービス名</option>
            </select>
            <input type="text" id="cleaning-items-search" placeholder="清掃内容（サービス）を検索..." autocomplete="off">
          </div>
          <div class="cleaning-items-results" id="cleaning-items-results" style="display: none;"></div>
        </div>
        <div class="cleaning-items-selected" id="cleaning-items-selected">
          <div style="color: #9ca3af; font-size: 0.875rem; padding: 8px;">選択された清掃内容がありません</div>
        </div>
        <input type="hidden" id="selected-cleaning-items-json" name="cleaning_items">
      </div>
    </div>
    
    <div class="form-row">
      <div class="form-field">
        <label for="schedule-status">ステータス</label>
        <select id="schedule-status" name="status">
          <option value="draft">未確定</option>
          <option value="scheduled">確定</option>
          <option value="in_progress">作業中</option>
          <option value="completed">完了</option>
          <option value="cancelled">キャンセル</option>
        </select>
      </div>
    </div>
    
    <div class="form-row">
      <div class="form-field">
        <label for="schedule-notes">備考</label>
        <textarea id="schedule-notes" name="notes" rows="3" placeholder="特記事項があれば入力"></textarea>
      </div>
    </div>
    
    <div class="form-status" id="form-status"></div>
    <div class="form-actions">
      <button type="button" class="btn btn-secondary" onclick="window.location.href='/sales/schedules'">キャンセル</button>
      <button type="submit" class="btn btn-primary">保存</button>
    </div>
  </form>
</main>

<script src="/js/sales-schedules-new.js"></script>
