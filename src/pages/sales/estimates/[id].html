@layout('layouts.base')
@json('data/meta/sales_estimate_detail_title.json', $title)
@json('data/meta/sales_estimate_detail_body_class.json', $body_class)

<main id="main" class="container sales-estimate-detail">
  <div class="page-header">
    <a href="/sales/estimates" class="back-btn">
      <i class="fas fa-chevron-left"></i>
    </a>
    <h1 class="page-title">見積もり詳細</h1>
    <a href="/sales/estimates/{{ id }}/edit" class="btn btn-outline btn-sm">
      <i class="fas fa-edit"></i> 編集
    </a>
  </div>

  <!-- Estimate Info Card -->
  <div class="info-card">
    <div class="card-header">
      <div class="estimate-main-info">
        <div class="estimate-id">見積書番号: {{ id }}</div>
        <h2 class="estimate-client">{{ client_name }}</h2>
        <div class="estimate-store">{{ store_name }}</div>
      </div>
      <span class="status-badge status-{{ status }}">{{ status_label }}</span>
    </div>

    <div class="info-grid">
      <div class="info-section">
        <h3 class="section-title">
          <i class="fas fa-calendar-alt"></i>
          日付情報
        </h3>
        <div class="info-item">
          <span class="info-label">作成日</span>
          <span class="info-value">{{ created_date }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">送付日</span>
          <span class="info-value">{{ sent_date }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">有効期限</span>
          <span class="info-value">{{ expiry_date }}</span>
        </div>
      </div>

      <div class="info-section">
        <h3 class="section-title">
          <i class="fas fa-building"></i>
          顧客情報
        </h3>
        <div class="info-item">
          <span class="info-label">会社名</span>
          <span class="info-value">{{ client_name }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">店舗名</span>
          <span class="info-value">{{ store_name }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">担当者</span>
          <span class="info-value">{{ contact_person }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">メール</span>
          <span class="info-value">
            <a href="mailto:{{ email }}">{{ email }}</a>
          </span>
        </div>
      </div>

      <div class="info-section">
        <h3 class="section-title">
          <i class="fas fa-yen-sign"></i>
          金額情報
        </h3>
        <div class="info-item">
          <span class="info-label">小計</span>
          <span class="info-value">{{ subtotal }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">消費税</span>
          <span class="info-value">{{ tax }}</span>
        </div>
        <div class="info-item total">
          <span class="info-label">合計金額</span>
          <span class="info-value">{{ total }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Services List -->
  <div class="services-card">
    <h3 class="section-title">
      <i class="fas fa-list"></i>
      サービス内容
    </h3>
    <div class="services-list">
      <div class="service-item">
        <div class="service-info">
          <h4 class="service-name">レンジフード洗浄</h4>
          <div class="service-desc">レンジフードの油汚れを完全に除去</div>
        </div>
        <div class="service-price">
          <div class="price-label">単価</div>
          <div class="price-value">¥30,000</div>
        </div>
        <div class="service-quantity">
          <div class="quantity-label">数量</div>
          <div class="quantity-value">1</div>
        </div>
        <div class="service-total">
          <div class="total-label">小計</div>
          <div class="total-value">¥30,000</div>
        </div>
      </div>
      <div class="service-item">
        <div class="service-info">
          <h4 class="service-name">換気扇洗浄</h4>
          <div class="service-desc">換気扇の内部洗浄</div>
        </div>
        <div class="service-price">
          <div class="price-label">単価</div>
          <div class="price-value">¥25,000</div>
        </div>
        <div class="service-quantity">
          <div class="quantity-label">数量</div>
          <div class="quantity-value">1</div>
        </div>
        <div class="service-total">
          <div class="total-label">小計</div>
          <div class="total-value">¥25,000</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Notes -->
  <div class="notes-card" id="notes-section" style="display: none;">
    <h3 class="section-title">
      <i class="fas fa-sticky-note"></i>
      備考・メモ
    </h3>
    <div class="notes-content">{{ notes }}</div>
  </div>

  <!-- Actions -->
  <div class="actions-section">
    <h3 class="section-title">アクション</h3>
    <div class="action-buttons">
      <a href="/sales/estimates/{{ id }}/send" class="btn btn-primary btn-block">
        <i class="fas fa-paper-plane"></i> 見積もりを送付
      </a>
      <a href="/sales/estimates/{{ id }}/edit" class="btn btn-outline btn-block">
        <i class="fas fa-edit"></i> 編集
      </a>
      <a href="/sales/estimates/{{ id }}/print" class="btn btn-outline btn-block">
        <i class="fas fa-print"></i> 印刷
      </a>
      <a href="/sales/estimates" class="btn btn-outline btn-block">
        <i class="fas fa-list"></i> 一覧に戻る
      </a>
    </div>
  </div>

  <style>
    .sales-estimate-detail {
      max-width: 100%;
      margin: 0;
      padding: 16px;
      background: #f9fafb;
    }
    .page-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 2px solid #e5e7eb;
      flex-wrap: wrap;
    }
    .back-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #ffffff;
      border: 1px solid #e5e7eb;
      color: #374151;
      text-decoration: none;
      transition: all 0.2s;
    }
    .back-btn:hover {
      background: #f9fafb;
      border-color: var(--primary);
      color: var(--primary);
    }
    .page-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #111827;
      margin: 0;
      flex: 1;
    }
    .info-card,
    .services-card,
    .notes-card {
      background: #ffffff;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
      margin-bottom: 24px;
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 24px;
      padding-bottom: 20px;
      border-bottom: 2px solid #f3f4f6;
    }
    .estimate-main-info {
      flex: 1;
    }
    .estimate-id {
      font-size: 0.875rem;
      color: #6b7280;
      margin-bottom: 8px;
    }
    .estimate-client {
      font-size: 1.5rem;
      font-weight: 700;
      color: #111827;
      margin: 0 0 8px 0;
    }
    .estimate-store {
      font-size: 1.125rem;
      color: #6b7280;
    }
    .status-badge {
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 0.875rem;
      font-weight: 600;
      flex-shrink: 0;
      margin-left: 16px;
    }
    .status-draft {
      background: #f3f4f6;
      color: #374151;
    }
    .status-sent {
      background: #dbeafe;
      color: #1e40af;
    }
    .status-approved {
      background: #d1fae5;
      color: #065f46;
    }
    .status-rejected {
      background: #fee2e2;
      color: #991b1b;
    }
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 24px;
    }
    .info-section {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .section-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: #111827;
      margin: 0 0 16px 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .section-title i {
      color: var(--primary);
    }
    .info-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: #f9fafb;
      border-radius: 8px;
    }
    .info-item.total {
      background: #fff5f8;
      border: 2px solid var(--primary);
      font-weight: 600;
    }
    .info-label {
      font-size: 0.875rem;
      color: #6b7280;
    }
    .info-value {
      font-size: 0.95rem;
      color: #111827;
      font-weight: 500;
    }
    .info-value a {
      color: var(--primary);
      text-decoration: none;
    }
    .info-value a:hover {
      text-decoration: underline;
    }
    .info-item.total .info-value {
      font-size: 1.25rem;
      color: var(--primary);
    }
    .services-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .service-item {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr;
      gap: 16px;
      padding: 16px;
      background: #f9fafb;
      border-radius: 8px;
      align-items: center;
    }
    .service-info {
      flex: 1;
    }
    .service-name {
      font-size: 1rem;
      font-weight: 600;
      color: #111827;
      margin: 0 0 4px 0;
    }
    .service-desc {
      font-size: 0.875rem;
      color: #6b7280;
    }
    .service-price,
    .service-quantity,
    .service-total {
      text-align: center;
    }
    .price-label,
    .quantity-label,
    .total-label {
      font-size: 0.75rem;
      color: #6b7280;
      margin-bottom: 4px;
    }
    .price-value,
    .quantity-value,
    .total-value {
      font-size: 1rem;
      font-weight: 600;
      color: #111827;
    }
    .total-value {
      color: var(--primary);
    }
    .notes-content {
      padding: 16px;
      background: #f9fafb;
      border-radius: 8px;
      font-size: 0.95rem;
      color: #374151;
      line-height: 1.6;
      white-space: pre-wrap;
    }
    .actions-section {
      margin-bottom: 24px;
    }
    .action-buttons {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    @media (max-width: 768px) {
      .sales-estimate-detail {
        padding: 12px;
      }
      .info-card,
      .services-card,
      .notes-card {
        padding: 16px;
      }
      .card-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }
      .info-grid {
        grid-template-columns: 1fr;
      }
      .service-item {
        grid-template-columns: 1fr;
        gap: 12px;
      }
      .service-price,
      .service-quantity,
      .service-total {
        text-align: left;
      }
    }
  </style>
  <script>
    // Show notes if available
    (function() {
      const notes = "{{ notes }}";
      if (notes && notes.trim()) {
        const notesSection = document.getElementById('notes-section');
        if (notesSection) {
          notesSection.style.display = 'block';
        }
      }
    })();
  </script>
</main>

