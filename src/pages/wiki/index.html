@layout('layouts.admin')
@json('data/meta/wiki_title.json', $title)
@json('data/meta/wiki_body_class.json', $body_class)

<main id="main" class="wiki-page">
  <!-- サイドバー -->
  <aside class="sidebar" id="admin-sidebar">
    <div class="sidebar-header">
      <a href="/admin/dashboard.html" class="logo-link">
        <img src="/images/logo_144x144.png" alt="ミセサポ" class="logo-img" />
        <span class="logo-text">ミセサポ</span>
      </a>
    </div>
    
    <!-- ロール表示 -->
    <div class="sidebar-role">
      <span class="role-badge" id="sidebar-role-badge">管理者</span>
    </div>
    
    <nav class="sidebar-nav">
      <a href="/admin/dashboard.html" class="nav-item">
        <i class="fas fa-home"></i>
        <span class="nav-label">ダッシュボード</span>
      </a>
      <a href="/admin/schedules/" class="nav-item">
        <i class="fas fa-calendar-alt"></i>
        <span class="nav-label">スケジュール</span>
      </a>
      <a href="/admin/customers/" class="nav-item">
        <i class="fas fa-store"></i>
        <span class="nav-label">顧客管理</span>
      </a>
      <a href="/admin/reports/" class="nav-item">
        <i class="fas fa-file-alt"></i>
        <span class="nav-label">レポート</span>
      </a>
      <a href="/admin/estimates/" class="nav-item">
        <i class="fas fa-file-invoice-dollar"></i>
        <span class="nav-label">見積もり</span>
      </a>
      <a href="/admin/orders.html" class="nav-item">
        <i class="fas fa-shopping-cart"></i>
        <span class="nav-label">発注管理</span>
      </a>
      <a href="/admin/partners.html" class="nav-item">
        <i class="fas fa-handshake"></i>
        <span class="nav-label">パートナー企業</span>
      </a>
      <a href="/admin/users/" class="nav-item">
        <i class="fas fa-users"></i>
        <span class="nav-label">ユーザー</span>
      </a>
      <a href="/admin/analytics/" class="nav-item">
        <i class="fas fa-chart-bar"></i>
        <span class="nav-label">分析</span>
      </a>
      <a href="/admin/cleaning-manual.html" class="nav-item">
        <i class="fas fa-book"></i>
        <span class="nav-label">マニュアル</span>
      </a>
      <a href="/admin/images/" class="nav-item">
        <i class="fas fa-images"></i>
        <span class="nav-label">メディア</span>
      </a>
      <div class="nav-divider"></div>
      <a href="/admin/services/" class="nav-item">
        <i class="fas fa-cog"></i>
        <span class="nav-label">設定</span>
      </a>
      <a href="/wiki" class="nav-item active">
        <i class="fas fa-book-open"></i>
        <span class="nav-label">WIKI</span>
      </a>
      <a href="/mypage.html" class="nav-item">
        <i class="fas fa-user"></i>
        <span class="nav-label">マイページ</span>
      </a>
      <button class="nav-item nav-item-button" onclick="window.Auth && window.Auth.logout()">
        <i class="fas fa-sign-out-alt"></i>
        <span class="nav-label">ログアウト</span>
      </button>
    </nav>

    <!-- トグルボタン -->
    <button class="sidebar-toggle" id="sidebar-toggle" aria-label="サイドバーを開閉">
      <i class="fas fa-chevron-left"></i>
    </button>
  </aside>

  <!-- メインコンテンツ -->
  <div class="main-content">
    <div class="wiki-layout">
      <!-- 中央カラム：詳細表示 -->
      <div class="wiki-center">
        <header class="wiki-header">
          <h1>ミセサポ システム用語辞典</h1>
          <p class="wiki-subtitle">開発者ではない事務の方でも理解できるよう、システムの要点と専門用語をわかりやすく説明します。</p>
        </header>

        <div class="wiki-detail" id="wiki-detail">
          <div class="wiki-welcome">
            <h2>ようこそ</h2>
            <p>左側のメニューから項目を選択すると、詳細が表示されます。</p>
          </div>
        </div>
      </div>

      <!-- 右カラム：項目リスト -->
      <div class="wiki-sidebar">
        <h2>目次</h2>
        <nav class="wiki-menu">
          <div class="wiki-menu-section">
            <h3>基本情報</h3>
            <ul>
              <li><a href="#" data-section="overview" class="wiki-menu-item">システム概要</a></li>
              <li><a href="#" data-section="roles" class="wiki-menu-item">ロール（役割）について</a></li>
            </ul>
          </div>

          <div class="wiki-menu-section">
            <h3>専門用語</h3>
            <ul>
              <li><a href="#" data-section="glossary" class="wiki-menu-item">専門用語辞典</a></li>
            </ul>
          </div>

          <div class="wiki-menu-section">
            <h3>機能説明</h3>
            <ul>
              <li><a href="#" data-section="features" class="wiki-menu-item">主要機能の説明</a></li>
              <li><a href="#" data-section="data" class="wiki-menu-item">データ構造の説明</a></li>
            </ul>
          </div>
        </nav>
      </div>
    </div>
  </div>
</main>

<!-- データテンプレート（非表示） -->
<div id="wiki-data" style="display: none;">
  <!-- システム概要 -->
  <div data-section="overview" class="wiki-section-content">
    <h2>1. システム概要</h2>
    <div class="wiki-card">
      <h3>ミセサポとは</h3>
      <p>ミセサポは、店舗清掃サービスを管理するためのWebアプリケーション（ウェブサイト）です。お客様、清掃員、営業担当、管理者など、それぞれの立場の人が使える機能を提供しています。</p>
      
      <h4>主な機能</h4>
      <ul>
        <li><strong>お客様向け</strong>: サービスを注文したり、清掃レポートを確認したりできます</li>
        <li><strong>清掃員向け</strong>: 作業予定を確認したり、作業レポートを作成したりできます</li>
        <li><strong>営業担当向け</strong>: お客様を管理したり、見積もりを作成したりできます</li>
        <li><strong>管理者向け</strong>: システム全体を管理し、すべての情報を確認できます</li>
      </ul>
    </div>
  </div>

  <!-- ロールについて -->
  <div data-section="roles" class="wiki-section-content">
    <h2>2. ロール（役割）について</h2>
    <p class="wiki-intro">ロールとは、システムを使う人の「役割」のことです。ロールによって、見られるページや使える機能が変わります。</p>

    <div class="roles-grid">
      <div class="role-card">
        <div class="role-badge customer">顧客</div>
        <h3>customer（顧客・お客様）</h3>
        <p><strong>誰のこと？</strong> 清掃サービスを利用するお客様（個人・法人）</p>
        <p><strong>できること</strong></p>
        <ul>
          <li>サービスを注文する</li>
          <li>清掃レポートを確認する</li>
          <li>スケジュールを確認する</li>
          <li>マイページで情報を管理する</li>
        </ul>
      </div>

      <div class="role-card">
        <div class="role-badge staff">清掃員</div>
        <h3>staff（清掃員）</h3>
        <p><strong>誰のこと？</strong> 実際に清掃作業を行うスタッフ</p>
        <p><strong>できること</strong></p>
        <ul>
          <li>作業予定を確認する</li>
          <li>作業レポートを作成する</li>
          <li>作業前後の写真をアップロードする</li>
          <li>研修動画を見る</li>
        </ul>
      </div>

      <div class="role-card">
        <div class="role-badge concierge">コンシェルジュ</div>
        <h3>concierge（コンシェルジュ・営業担当）</h3>
        <p><strong>誰のこと？</strong> お客様対応や営業を行う担当者</p>
        <p><strong>できること</strong></p>
        <ul>
          <li>お客様情報を管理する</li>
          <li>見積もりを作成する</li>
          <li>スケジュールを管理する</li>
          <li>発注を管理する</li>
        </ul>
      </div>

      <div class="role-card">
        <div class="role-badge admin">管理者</div>
        <h3>admin（管理者）</h3>
        <p><strong>誰のこと？</strong> システム全体を管理する人</p>
        <p><strong>できること</strong></p>
        <ul>
          <li>すべてのユーザーを管理する</li>
          <li>サービス内容を管理する</li>
          <li>発注を管理する</li>
          <li>レポートを確認・管理する</li>
          <li>システムの設定を変更する</li>
        </ul>
      </div>

      <div class="role-card">
        <div class="role-badge developer">開発者</div>
        <h3>developer（開発者）</h3>
        <p><strong>誰のこと？</strong> システムを作ったり、修正したりする技術者</p>
        <p><strong>できること</strong></p>
        <ul>
          <li>管理者のすべての機能</li>
          <li>サービス変更のレビュー（確認）</li>
          <li>画像の管理</li>
          <li>システムの技術的な設定</li>
        </ul>
      </div>

      <div class="role-card">
        <div class="role-badge master">マスター</div>
        <h3>master（マスター）</h3>
        <p><strong>誰のこと？</strong> システムの最上位権限を持つ人</p>
        <p><strong>できること</strong></p>
        <ul>
          <li>すべての機能にアクセスできる</li>
          <li>システム全体を完全に管理できる</li>
          <li>他のロールのユーザーを作成できる</li>
        </ul>
      </div>
    </div>

    <div class="wiki-note">
      <h4>ロールの階層</h4>
      <p>ロールには階層があり、上位のロールは下位のロールの機能も使えます。</p>
      <div class="hierarchy">
        <div class="hierarchy-item">マスター（最上位）</div>
        <div class="hierarchy-arrow">↓</div>
        <div class="hierarchy-item">開発者</div>
        <div class="hierarchy-arrow">↓</div>
        <div class="hierarchy-item">管理者</div>
        <div class="hierarchy-arrow">↓</div>
        <div class="hierarchy-item">コンシェルジュ</div>
        <div class="hierarchy-arrow">↓</div>
        <div class="hierarchy-item">清掃員・顧客（同レベル）</div>
      </div>
    </div>
  </div>

  <!-- 専門用語辞典 -->
  <div data-section="glossary" class="wiki-section-content">
    <h2>3. 専門用語辞典</h2>
    <p class="wiki-intro">システムで使われる専門用語を、わかりやすく説明します。</p>

    <div class="glossary-list">
      <div class="glossary-item">
        <h3>API（エーピーアイ）</h3>
        <p><strong>読み方</strong>: エーピーアイ</p>
        <p><strong>意味</strong>: アプリケーション同士が情報をやり取りするための仕組み。システムの「窓口」のようなもの。</p>
        <p><strong>例</strong>: 清掃レポートのデータを取得するとき、APIを通じてデータを取得します。</p>
      </div>

      <div class="glossary-item">
        <h3>API Gateway（エーピーアイゲートウェイ）</h3>
        <p><strong>読み方</strong>: エーピーアイゲートウェイ</p>
        <p><strong>意味</strong>: APIへのアクセスを管理する「門番」のようなもの。誰がアクセスできるか、どのような情報をやり取りできるかを制御します。</p>
      </div>

      <div class="glossary-item">
        <h3>認証（にんしょう）</h3>
        <p><strong>読み方</strong>: にんしょう</p>
        <p><strong>意味</strong>: 「あなたは本当にこの人ですか？」を確認すること。ログインするときに、メールアドレスとパスワードで本人確認をします。</p>
        <p><strong>関連用語</strong>: ログイン、パスワード</p>
      </div>

      <div class="glossary-item">
        <h3>権限（けんげん）</h3>
        <p><strong>読み方</strong>: けんげん</p>
        <p><strong>意味</strong>: その人が「何をできるか」を決めるもの。ロールによって権限が変わります。</p>
        <p><strong>例</strong>: 管理者はすべての情報を見られますが、清掃員は自分の作業に関係する情報だけ見られます。</p>
      </div>

      <div class="glossary-item">
        <h3>クラウド（Cloud）</h3>
        <p><strong>読み方</strong>: クラウド</p>
        <p><strong>意味</strong>: インターネット上にあるコンピューターやサービス。自分のパソコンではなく、インターネット上でデータを保存したり、処理したりします。</p>
        <p><strong>例</strong>: AWS（アマゾンのクラウドサービス）、Azure（マイクロソフトのクラウドサービス）</p>
      </div>

      <div class="glossary-item">
        <h3>CORS（コース）</h3>
        <p><strong>読み方</strong>: コース</p>
        <p><strong>意味</strong>: 異なるウェブサイト間でデータをやり取りするためのセキュリティの仕組み。安全にデータを共有するためのルールです。</p>
      </div>

      <div class="glossary-item">
        <h3>データベース（Database）</h3>
        <p><strong>読み方</strong>: データベース</p>
        <p><strong>意味</strong>: 情報を整理して保存しておく場所。Excelの表のようなものですが、もっと大量のデータを効率的に管理できます。</p>
        <p><strong>例</strong>: DynamoDB（AWSのデータベース）、Firestore（Googleのデータベース）</p>
      </div>

      <div class="glossary-item">
        <h3>デプロイ（Deploy）</h3>
        <p><strong>読み方</strong>: デプロイ</p>
        <p><strong>意味</strong>: 作ったシステムを実際に使えるように公開すること。「本番環境に反映する」という意味です。</p>
        <p><strong>例</strong>: 新しい機能を追加したら、デプロイして実際のサイトに反映します。</p>
      </div>

      <div class="glossary-item">
        <h3>DynamoDB（ダイナモディービー）</h3>
        <p><strong>読み方</strong>: ダイナモディービー</p>
        <p><strong>意味</strong>: AWSが提供するデータベースサービス。お客様情報やレポートなどのデータを保存します。</p>
      </div>

      <div class="glossary-item">
        <h3>Firebase（ファイアベース）</h3>
        <p><strong>読み方</strong>: ファイアベース</p>
        <p><strong>意味</strong>: Googleが提供するサービス。認証（ログイン機能）やデータベースなど、さまざまな機能を提供します。</p>
        <p><strong>関連用語</strong>: Firebase Authentication（認証機能）、Firestore（データベース機能）</p>
      </div>

      <div class="glossary-item">
        <h3>Firestore（ファイアストア）</h3>
        <p><strong>読み方</strong>: ファイアストア</p>
        <p><strong>意味</strong>: Firebaseが提供するデータベースサービス。現在はAWSのDynamoDBに移行中です。</p>
      </div>

      <div class="glossary-item">
        <h3>GitHub（ギットハブ）</h3>
        <p><strong>読み方</strong>: ギットハブ</p>
        <p><strong>意味</strong>: プログラムのコードを保存・管理するサービス。複数の人が協力してシステムを作るときに使います。</p>
      </div>

      <div class="glossary-item">
        <h3>JSON（ジェイソン）</h3>
        <p><strong>読み方</strong>: ジェイソン</p>
        <p><strong>意味</strong>: データを保存する形式の一つ。テキストファイルで、人間が読める形式でデータを保存します。</p>
        <p><strong>例</strong>: お客様情報をJSON形式で保存すると、{ "name": "山田太郎", "email": "yamada@example.com" } のような形式になります。</p>
      </div>

      <div class="glossary-item">
        <h3>Lambda（ラムダ）</h3>
        <p><strong>読み方</strong>: ラムダ</p>
        <p><strong>意味</strong>: AWSが提供するサービス。プログラムを実行するための「関数」のようなもの。データを処理したり、APIの処理を行ったりします。</p>
        <p><strong>例</strong>: レポートを保存するとき、Lambda関数がデータを処理してデータベースに保存します。</p>
      </div>

      <div class="glossary-item">
        <h3>ログイン（Login）</h3>
        <p><strong>読み方</strong>: ログイン</p>
        <p><strong>意味</strong>: システムを使うために、メールアドレスとパスワードを入力して本人確認をすること。</p>
        <p><strong>関連用語</strong>: 認証、ログアウト</p>
      </div>

      <div class="glossary-item">
        <h3>ログアウト（Logout）</h3>
        <p><strong>読み方</strong>: ログアウト</p>
        <p><strong>意味</strong>: システムの使用を終了すること。セキュリティのため、使い終わったらログアウトしましょう。</p>
      </div>

      <div class="glossary-item">
        <h3>マスターデータ</h3>
        <p><strong>読み方</strong>: マスターデータ</p>
        <p><strong>意味</strong>: 基本的な情報で、あまり変更されないデータ。お客様の店舗情報やサービス一覧などが該当します。</p>
        <p><strong>例</strong>: 店舗情報、サービス一覧、清掃員の基本情報</p>
      </div>

      <div class="glossary-item">
        <h3>S3（エススリー）</h3>
        <p><strong>読み方</strong>: エススリー</p>
        <p><strong>意味</strong>: AWSが提供するファイル保存サービス。画像やPDFなどのファイルを保存します。</p>
        <p><strong>例</strong>: 清掃レポートの写真はS3に保存されます。</p>
      </div>

      <div class="glossary-item">
        <h3>スケジュール（Schedule）</h3>
        <p><strong>読み方</strong>: スケジュール</p>
        <p><strong>意味</strong>: 作業予定のこと。いつ、どこで、誰が清掃作業を行うかを管理します。</p>
      </div>

      <div class="glossary-item">
        <h3>トランザクションデータ</h3>
        <p><strong>読み方</strong>: トランザクションデータ</p>
        <p><strong>意味</strong>: 頻繁に追加・更新されるデータ。作業予定やレポートなど、日々増えていくデータです。</p>
        <p><strong>例</strong>: 作業予定、清掃レポート、メッセージ</p>
      </div>

      <div class="glossary-item">
        <h3>レポート（Report）</h3>
        <p><strong>読み方</strong>: レポート</p>
        <p><strong>意味</strong>: 清掃作業の報告書。作業内容や作業前後の写真が含まれます。</p>
      </div>

      <div class="glossary-item">
        <h3>ロール（Role）</h3>
        <p><strong>読み方</strong>: ロール</p>
        <p><strong>意味</strong>: システムを使う人の「役割」。顧客、清掃員、管理者など、それぞれの役割によって使える機能が変わります。</p>
        <p><strong>関連用語</strong>: 権限</p>
      </div>

      <div class="glossary-item">
        <h3>UI（ユーアイ）</h3>
        <p><strong>読み方</strong>: ユーアイ</p>
        <p><strong>意味</strong>: ユーザーインターフェースの略。システムの画面や操作の見た目のことです。</p>
        <p><strong>例</strong>: ボタンのデザイン、メニューの配置など</p>
      </div>
    </div>
  </div>

  <!-- 主要機能の説明 -->
  <div data-section="features" class="wiki-section-content">
    <h2>4. 主要機能の説明</h2>

    <div class="feature-card">
      <h3>ダッシュボード</h3>
      <p>システムにログインしたときに最初に表示される画面。重要な情報や統計が一目でわかるように表示されます。</p>
      <p><strong>例</strong>: 今日の清掃予定数、今月の清掃件数、通知など</p>
    </div>

    <div class="feature-card">
      <h3>顧客管理</h3>
      <p>お客様の情報を管理する機能。店舗情報、連絡先、契約情報などを登録・編集・確認できます。</p>
    </div>

    <div class="feature-card">
      <h3>スケジュール管理</h3>
      <p>清掃作業の予定を管理する機能。いつ、どこで、誰が作業するかを登録し、カレンダー形式で確認できます。</p>
    </div>

    <div class="feature-card">
      <h3>レポート管理</h3>
      <p>清掃作業の報告書を管理する機能。清掃員が作成したレポートを確認したり、お客様に公開したりできます。</p>
    </div>

    <div class="feature-card">
      <h3>発注管理</h3>
      <p>お客様からのサービス注文を管理する機能。注文内容を確認し、処理状況を管理します。</p>
    </div>

    <div class="feature-card">
      <h3>ユーザー管理</h3>
      <p>システムを使う人（ユーザー）を管理する機能。新しいユーザーを追加したり、権限を変更したりできます。</p>
    </div>

    <div class="feature-card">
      <h3>サービス管理</h3>
      <p>提供する清掃サービスの内容を管理する機能。サービス名、料金、説明などを登録・編集できます。</p>
    </div>
  </div>

  <!-- データ構造の説明 -->
  <div data-section="data" class="wiki-section-content">
    <h2>5. データ構造の簡単な説明</h2>
    <p class="wiki-intro">システムで管理しているデータの種類と、どこに保存されているかを説明します。</p>

    <div class="data-card">
      <h3>マスターデータ（基本情報）</h3>
      <p>あまり変更されない基本的な情報です。</p>
      <ul>
        <li><strong>店舗情報</strong>: お客様の店舗名、住所、連絡先など</li>
        <li><strong>サービス一覧</strong>: 提供する清掃サービスの内容</li>
        <li><strong>ユーザー情報</strong>: システムを使う人の基本情報</li>
        <li><strong>清掃員情報</strong>: 清掃スタッフの基本情報</li>
      </ul>
      <p><strong>保存場所</strong>: データベース（DynamoDB）またはJSONファイル</p>
    </div>

    <div class="data-card">
      <h3>トランザクションデータ（日々のデータ）</h3>
      <p>日々追加・更新されるデータです。</p>
      <ul>
        <li><strong>スケジュール</strong>: 作業予定（年間10,000件以上）</li>
        <li><strong>レポート</strong>: 作業報告書（年間10,000件以上）</li>
        <li><strong>契約</strong>: お客様との契約情報（500件以上）</li>
        <li><strong>メッセージ</strong>: 通知や連絡（年間50,000件以上）</li>
      </ul>
      <p><strong>保存場所</strong>: データベース（DynamoDB）</p>
    </div>

    <div class="data-card">
      <h3>ファイルデータ（画像・文書）</h3>
      <p>画像やPDFなどのファイルです。</p>
      <ul>
        <li><strong>レポート画像</strong>: 作業前後の写真</li>
        <li><strong>契約書類</strong>: PDFなどの文書</li>
        <li><strong>研修動画</strong>: 清掃員向けの動画</li>
      </ul>
      <p><strong>保存場所</strong>: S3（ファイル保存サービス）</p>
    </div>
  </div>
</div>

<style>
  :root {
    --sidebar-width: 240px;
    --sidebar-width-collapsed: 64px;
  }

  .wiki-page {
    display: flex;
    min-height: 100vh;
    background: #f9fafb;
  }

  /* サイドバー（管理画面と同じスタイル） */
  .sidebar {
    width: var(--sidebar-width);
    background: #fff;
    border-right: 1px solid #e5e7eb;
    display: flex;
    flex-direction: column;
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    z-index: 100;
    box-shadow: 2px 0 8px rgba(0,0,0,0.05);
    transition: width 0.3s ease;
    overflow: hidden;
  }
  .sidebar.collapsed {
    width: var(--sidebar-width-collapsed);
  }
  .sidebar.collapsed .nav-label,
  .sidebar.collapsed .logo-text,
  .sidebar.collapsed .sidebar-role {
    opacity: 0;
    width: 0;
    overflow: hidden;
  }
  .sidebar.collapsed .sidebar-toggle i {
    transform: rotate(180deg);
  }
  .sidebar-header {
    padding: 20px;
    border-bottom: 1px solid #e5e7eb;
    min-height: 64px;
    display: flex;
    align-items: center;
  }
  .logo-link {
    display: flex;
    align-items: center;
    gap: 12px;
    text-decoration: none;
    color: inherit;
  }
  .logo-img {
    width: 32px;
    height: 32px;
    object-fit: contain;
    flex-shrink: 0;
  }
  .logo-text {
    font-size: 1.25rem;
    font-weight: 700;
    color: #111827;
    white-space: nowrap;
    transition: opacity 0.3s ease;
  }
  .sidebar-role {
    padding: 8px 20px;
    border-bottom: 1px solid #e5e7eb;
    transition: opacity 0.3s ease;
  }
  .sidebar-role .role-badge {
    display: inline-block;
    padding: 4px 12px;
    background: #e0e7ff;
    color: #3730a3;
    border-radius: 4px;
    font-size: 0.875rem;
    font-weight: 500;
    white-space: nowrap;
  }
  .sidebar-nav {
    flex: 1;
    padding: 12px;
    display: flex;
    flex-direction: column;
    gap: 2px;
    overflow-y: auto;
  }
  .nav-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 12px;
    color: #6b7280;
    text-decoration: none;
    border-radius: 8px;
    transition: all 0.2s;
    white-space: nowrap;
  }
  .nav-item-button {
    background: none;
    border: none;
    cursor: pointer;
    width: 100%;
    text-align: left;
  }
  .nav-item:hover {
    background: #f3f4f6;
    color: #111827;
  }
  .nav-item.active {
    background: var(--primary);
    color: #fff;
  }
  .nav-item i {
    width: 20px;
    text-align: center;
    flex-shrink: 0;
  }
  .nav-label {
    transition: opacity 0.3s ease;
    white-space: nowrap;
  }
  .sidebar-toggle {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    width: 28px;
    height: 28px;
    border: 1px solid #e5e7eb;
    border-radius: 50%;
    background: #fff;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #6b7280;
    transition: all 0.2s;
    z-index: 200;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  .sidebar-toggle:hover {
    background: #f3f4f6;
    border-color: var(--primary);
    color: var(--primary);
  }
  .sidebar-toggle i {
    transition: transform 0.3s ease;
  }
  .sidebar.collapsed .sidebar-toggle {
    right: 18px;
  }
  .nav-divider {
    height: 1px;
    background: #e5e7eb;
    margin: 8px 12px;
  }

  /* メインコンテンツ */
  .main-content {
    flex: 1;
    margin-left: var(--sidebar-width);
    padding: 24px;
    background: #f9fafb;
    transition: margin-left 0.3s ease;
  }
  .sidebar.collapsed ~ .main-content {
    margin-left: var(--sidebar-width-collapsed);
  }

  /* WIKIレイアウト（3カラム） */
  .wiki-layout {
    display: grid;
    grid-template-columns: 1fr 300px;
    gap: 24px;
    max-width: 1400px;
    margin: 0 auto;
  }

  /* 中央カラム */
  .wiki-center {
    background: #fff;
    border-radius: 12px;
    padding: 40px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    min-height: calc(100vh - 48px);
  }

  .wiki-header {
    text-align: center;
    margin-bottom: 40px;
    padding-bottom: 30px;
    border-bottom: 2px solid #e5e7eb;
  }

  .wiki-header h1 {
    font-size: 2rem;
    color: #111827;
    margin-bottom: 16px;
  }

  .wiki-subtitle {
    font-size: 1rem;
    color: #6b7280;
    line-height: 1.6;
  }

  .wiki-detail {
    min-height: 400px;
  }

  .wiki-welcome {
    text-align: center;
    padding: 60px 20px;
    color: #6b7280;
  }

  .wiki-welcome h2 {
    font-size: 1.5rem;
    margin-bottom: 16px;
    color: #111827;
  }

  /* 右カラム */
  .wiki-sidebar {
    background: #fff;
    border-radius: 12px;
    padding: 24px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    height: fit-content;
    position: sticky;
    top: 24px;
  }

  .wiki-sidebar h2 {
    font-size: 1.25rem;
    color: #111827;
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 2px solid #e5e7eb;
  }

  .wiki-menu-section {
    margin-bottom: 24px;
  }

  .wiki-menu-section h3 {
    font-size: 0.875rem;
    font-weight: 600;
    color: #6b7280;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 12px;
  }

  .wiki-menu ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .wiki-menu-item {
    display: block;
    padding: 10px 12px;
    color: #374151;
    text-decoration: none;
    border-radius: 6px;
    transition: all 0.2s;
    margin-bottom: 4px;
    font-size: 0.9375rem;
  }

  .wiki-menu-item:hover {
    background: #f3f4f6;
    color: #111827;
  }

  .wiki-menu-item.active {
    background: #eff6ff;
    color: #2563eb;
    font-weight: 500;
  }

  /* セクションコンテンツ */
  .wiki-section-content {
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .wiki-section-content h2 {
    font-size: 2rem;
    color: #111827;
    margin-bottom: 24px;
    padding-bottom: 12px;
    border-bottom: 2px solid #e5e7eb;
  }

  .wiki-intro {
    font-size: 1.125rem;
    color: #6b7280;
    margin-bottom: 24px;
    line-height: 1.6;
  }

  .wiki-card,
  .feature-card,
  .data-card {
    background: #f9fafb;
    padding: 24px;
    border-radius: 8px;
    margin-bottom: 24px;
    border-left: 4px solid #2563eb;
  }

  .wiki-card h3,
  .feature-card h3,
  .data-card h3 {
    font-size: 1.5rem;
    color: #111827;
    margin-bottom: 12px;
  }

  .wiki-card h4 {
    font-size: 1.25rem;
    color: #374151;
    margin-top: 20px;
    margin-bottom: 12px;
  }

  .wiki-card ul,
  .feature-card ul,
  .data-card ul {
    margin-left: 20px;
    line-height: 1.8;
  }

  .wiki-card li,
  .feature-card li,
  .data-card li {
    margin-bottom: 8px;
  }

  .roles-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 24px;
    margin-bottom: 32px;
  }

  .role-card {
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 24px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  }

  .role-badge {
    display: inline-block;
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 0.875rem;
    font-weight: 600;
    margin-bottom: 12px;
  }

  .role-badge.customer {
    background: #dbeafe;
    color: #1e40af;
  }

  .role-badge.staff {
    background: #dcfce7;
    color: #166534;
  }

  .role-badge.concierge {
    background: #fef3c7;
    color: #92400e;
  }

  .role-badge.admin {
    background: #e0e7ff;
    color: #3730a3;
  }

  .role-badge.developer {
    background: #fce7f3;
    color: #831843;
  }

  .role-badge.master {
    background: #fef2f2;
    color: #991b1b;
  }

  .role-card h3 {
    font-size: 1.25rem;
    color: #111827;
    margin-bottom: 12px;
  }

  .role-card p {
    margin-bottom: 12px;
    line-height: 1.6;
  }

  .role-card ul {
    margin-left: 20px;
    line-height: 1.8;
  }

  .wiki-note {
    background: #fef3c7;
    border-left: 4px solid #f59e0b;
    padding: 20px;
    border-radius: 8px;
    margin-top: 32px;
  }

  .wiki-note h4 {
    font-size: 1.125rem;
    color: #92400e;
    margin-bottom: 12px;
  }

  .hierarchy {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    margin-top: 16px;
  }

  .hierarchy-item {
    background: #fff;
    padding: 12px 24px;
    border-radius: 6px;
    border: 1px solid #e5e7eb;
    font-weight: 500;
  }

  .hierarchy-arrow {
    color: #6b7280;
    font-size: 1.5rem;
  }

  .glossary-list {
    display: flex;
    flex-direction: column;
    gap: 24px;
  }

  .glossary-item {
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 24px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  }

  .glossary-item h3 {
    font-size: 1.5rem;
    color: #2563eb;
    margin-bottom: 12px;
  }

  .glossary-item p {
    margin-bottom: 8px;
    line-height: 1.6;
  }

  .glossary-item strong {
    color: #111827;
    font-weight: 600;
  }

  @media (max-width: 1200px) {
    .wiki-layout {
      grid-template-columns: 1fr;
    }

    .wiki-sidebar {
      position: static;
      order: -1;
    }
  }

  @media (max-width: 768px) {
    .main-content {
      margin-left: 0;
      padding: 16px;
    }

    .sidebar {
      transform: translateX(-100%);
    }

    .sidebar.collapsed {
      transform: translateX(0);
      width: var(--sidebar-width-collapsed);
    }

    .sidebar.collapsed ~ .main-content {
      margin-left: var(--sidebar-width-collapsed);
    }

    .wiki-center {
      padding: 24px;
    }

    .roles-grid {
      grid-template-columns: 1fr;
    }
  }
</style>

<script>
(function() {
  // サイドバー開閉機能
  const sidebar = document.getElementById('admin-sidebar');
  const sidebarToggle = document.getElementById('sidebar-toggle');
  
  if (sidebar && sidebarToggle) {
    const isCollapsed = localStorage.getItem('sidebar-collapsed') === 'true';
    if (isCollapsed) {
      sidebar.classList.add('collapsed');
    }
    
    sidebarToggle.addEventListener('click', () => {
      sidebar.classList.toggle('collapsed');
      const collapsed = sidebar.classList.contains('collapsed');
      localStorage.setItem('sidebar-collapsed', collapsed);
    });
  }

  // ロール表示の更新
  function updateRoleBadge() {
    const roleBadge = document.getElementById('sidebar-role-badge');
    if (!roleBadge) return;
    
    if (window.Auth && window.Auth.getCurrentUser) {
      const user = window.Auth.getCurrentUser();
      if (user && user.role) {
        const roleConfig = window.RoleConfig?.ROLE_CONFIG;
        const roleInfo = roleConfig?.roles?.[user.role];
        if (roleInfo) {
          roleBadge.textContent = roleInfo.displayName || roleInfo.name || user.role;
          
          const badgeColors = {
            'guest': { bg: '#e5e7eb', color: '#6b7280' },
            'customer': { bg: '#dbeafe', color: '#1e40af' },
            'staff': { bg: '#dcfce7', color: '#166534' },
            'concierge': { bg: '#fef3c7', color: '#92400e' },
            'admin': { bg: '#e0e7ff', color: '#3730a3' },
            'developer': { bg: '#fce7f3', color: '#831843' },
            'master': { bg: '#fef2f2', color: '#991b1b' }
          };
          
          const colors = badgeColors[user.role] || badgeColors['admin'];
          roleBadge.style.background = colors.bg;
          roleBadge.style.color = colors.color;
        }
      }
    } else {
      roleBadge.textContent = '管理者';
    }
  }
  
  updateRoleBadge();
  
  if (window.Auth && window.Auth.onAuthStateChanged) {
    window.Auth.onAuthStateChanged(() => {
      updateRoleBadge();
    });
  }

  // WIKIメニューのクリック処理
  const menuItems = document.querySelectorAll('.wiki-menu-item');
  const detailContainer = document.getElementById('wiki-detail');
  const dataContainer = document.getElementById('wiki-data');

  menuItems.forEach(item => {
    item.addEventListener('click', (e) => {
      e.preventDefault();
      
      // アクティブ状態を更新
      menuItems.forEach(i => i.classList.remove('active'));
      item.classList.add('active');
      
      // セクションを取得
      const section = item.getAttribute('data-section');
      const sectionContent = dataContainer.querySelector(`[data-section="${section}"]`);
      
      if (sectionContent) {
        // 詳細を表示
        detailContainer.innerHTML = sectionContent.innerHTML;
        
        // スクロールをトップに
        detailContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    });
  });

  // URLハッシュから初期表示
  const hash = window.location.hash.replace('#', '');
  if (hash) {
    const item = document.querySelector(`[data-section="${hash}"]`);
    if (item) {
      item.click();
    }
  }
})();
</script>
