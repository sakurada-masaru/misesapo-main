<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>レポート一覧 | ミセサポ</title>
    @include('partials.head-links')
    <style>
      body { background-color: #fff; }
      main.container { max-width: 100%; }
      .page-title { font-size: 1.7rem; font-weight: 800; margin-bottom: 1.5rem; }
      .controls-bar { display:flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
      .pagination-controls { display:flex; align-items:center; gap: 1rem; }
      .pagination-info { font-size: .9rem; color:#555; }
      .pagination { display:flex; align-items:center; gap: 8px; }
      .page-nav-icon { color: var(--primary); font-size: .9rem; font-weight: 700; padding: 0 .5rem; }
      .page-nav-icon.disabled { color: #ffd9e6; cursor: not-allowed; }
      .page-nav { width:30px; height:30px; border-radius:50%; color:#777; display:flex; align-items:center; justify-content:center; font-size:.9rem; font-weight:700; }
      .page-nav.active { background: var(--primary); color:#fff; }
      .items-per-page select { border:1px solid #ccc; border-radius:6px; padding:.5rem .8rem; font-size:.9rem; background:#fff; }
      .report-list { display:flex; flex-direction:column; gap: 1.5rem; }
      .report-card { background:#fff; border:1px solid #e0e0e0; border-radius:8px; box-shadow:0 3px 6px rgba(0,0,0,.04); transition: box-shadow .2s ease; }
      .report-card:hover { box-shadow:0 5px 12px rgba(0,0,0,.08); }
      .card-header { padding: 1.2rem 1.5rem; border-bottom:1px solid #f0f0f0; display:flex; align-items:center; gap:10px; }
      .new-badge { background:#fff5f8; color: var(--primary); font-size:.75rem; font-weight:700; padding:3px 8px; border-radius:4px; }
      .new-badge:empty { display:none; }
      .report-date { font-weight:700; font-size:1.05rem; color:#333; }
      .card-body { padding: 1.5rem; display:grid; grid-template-columns: 100px 1fr; gap:1.2rem; font-size:.95rem; }
      .body-label { font-weight:700; color:#666; padding-top:5px; }
      .body-content { display:flex; flex-wrap:wrap; gap:10px; }
      .content-tag { background:#f1f1f1; color:#555; padding:5px 12px; border-radius:15px; font-size:.9rem; font-weight:500; }
      .card-footer { padding: 0 1.5rem 1.5rem; text-align:right; }
      .details-link { color: var(--primary); font-weight:700; font-size:.9rem; }
      .details-link:hover { text-decoration: underline; }
      .pagination-bottom { margin-top:2.5rem; display:flex; justify-content:center; }
      @media (max-width: 768px){ .card-body { grid-template-columns: 1fr; gap:.5rem; } .body-label { padding-top:0; } }
    </style>
  </head>
  <body class="theme-pink page-report bg-white">
    @include('partials.header')
    <!-- Hero banner (reuse global hero styles) -->
    <section class="hero">
      <img class="hero-img" src="/images/header-main.png" alt="レポート ヒーロー" />
      <div class="hero-overlay" aria-hidden="true"></div>
    </section>
    <main class="container section-gap-lg">
      <h1 class="page-title">レポート一覧</h1>
      <div class="controls-bar">
        <div class="pagination-controls">
          <span class="pagination-info" id="count-total">全0件</span>
          <span class="pagination-info" id="count-range">0-0件を表示</span>
          <div class="pagination">
            <span class="page-nav-icon disabled">&lt;</span>
            <span class="page-nav active">1</span>
            <span class="page-nav-icon disabled">&gt;</span>
          </div>
        </div>
        <div class="items-per-page">
          <select name="items" id="per-page">
            <option value="10">10件</option>
            <option value="20">20件</option>
            <option value="50" selected>50件</option>
          </select>
        </div>
      </div>
      <div class="report-list" id="report-list"></div>
      <div class="pagination-bottom">
        <div class="pagination-controls">
          <span class="pagination-info" id="count-total-bottom">全0件</span>
          <span class="pagination-info" id="count-range-bottom">0-0件を表示</span>
          <div class="pagination">
            <span class="page-nav-icon disabled">&lt;</span>
            <span class="page-nav active">1</span>
            <span class="page-nav-icon disabled">&gt;</span>
          </div>
        </div>
      </div>
    </main>
    @include('partials.footer')

    @json('data/cleaning_reports.json', $cleaning_reports)
    <script>
      window.CLEANING_REPORTS = @jsonvar $cleaning_reports;
      (function(){
        const root = window.CLEANING_REPORTS || { reports: [] };
        const list = Array.isArray(root.reports) ? root.reports : [];
        const wrap = document.getElementById('report-list');
        const total = list.length;
        const per = 50; // mock: single page
        const shown = Math.min(total, per);
        const range = shown > 0 ? `1-${shown}件を表示` : '0-0件を表示';
        const totalText = `全${total}件`;
        ['count-total','count-total-bottom'].forEach(id => { const el = document.getElementById(id); if (el) el.textContent = totalText; });
        ['count-range','count-range-bottom'].forEach(id => { const el = document.getElementById(id); if (el) el.textContent = range; });

        function el(tag, cls, text){ const e = document.createElement(tag); if (cls) e.className = cls; if (text != null) e.textContent = text; return e; }
        list.slice(0, per).forEach((rep) => {
          const card = el('article', 'report-card');
          const head = el('div', 'card-header');
          const badge = el('span', 'new-badge', rep.status === 'NEW' ? 'NEW' : '');
          const date = el('span', 'report-date', rep.cleaning_datetime || '');
          head.appendChild(badge); head.appendChild(date);
          const body = el('div', 'card-body');
          const label = el('span', 'body-label', '清掃内容');
          const cont = el('div', 'body-content');
          const items = Array.isArray(rep.cleaning_content) ? rep.cleaning_content : [];
          items.forEach((name) => { cont.appendChild(el('span', 'content-tag', String(name))); });
          body.appendChild(label); body.appendChild(cont);
          const foot = el('div', 'card-footer');
          const a = el('a', 'details-link', '詳細を確認する >');
          a.href = `/reports/${rep.id}.html`;
          foot.appendChild(a);
          card.appendChild(head); card.appendChild(body); card.appendChild(foot);
          wrap.appendChild(card);
        });
      })();
    </script>
  </body>
  </html>
