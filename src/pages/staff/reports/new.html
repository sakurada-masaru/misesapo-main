@layout('layouts.base')
@json('data/meta/staff_reports_new_title.json', $title)
@json('data/meta/staff_reports_new_body_class.json', $body_class)

<script src="/js/data_utils.js"></script>
<link rel="stylesheet" href="/css/staff-report-new.css">

<main id="main" class="staff-report-page">
  <!-- 固定ヘッダー -->
  <header class="page-header-fixed">
    <a href="/staff/dashboard" class="back-btn">
      <i class="fas fa-chevron-left"></i>
    </a>
    <h1 class="page-title">レポート作成</h1>
    <button type="button" class="help-btn" id="help-btn">
      <i class="fas fa-question-circle"></i>
    </button>
  </header>

  <!-- タブナビゲーション -->
  <div class="tabs-navigation">
    <button type="button" class="tab-btn active" data-tab="new" id="tab-new">
      <i class="fas fa-plus-circle"></i>
      <span>新規作成</span>
    </button>
    <button type="button" class="tab-btn" data-tab="edit" id="tab-edit">
      <i class="fas fa-edit"></i>
      <span>修正・編集</span>
      <span class="badge" id="revision-badge" style="display: none;">0</span>
    </button>
  </div>

  <!-- 新規作成タブ -->
  <div id="tab-content-new" class="tab-content active">
    <form id="report-form" class="report-form">
    <!-- 基本情報（ピンク背景） -->
    <div class="report-header-section">
      <div class="form-row two-col">
        <div class="form-group store-search-group">
          <div class="store-search-wrapper">
            <input type="text" id="report-brand-search" class="form-input" placeholder="①ブランド名 *" autocomplete="off">
            <input type="hidden" id="report-brand" name="brand_id">
            <input type="hidden" id="report-brand-name" name="brand_name">
            <div id="brand-search-results" class="store-search-results" style="display: none;"></div>
          </div>
        </div>
        <div class="form-group store-search-group">
          <div class="store-search-wrapper">
            <input type="text" id="report-store-search" class="form-input" placeholder="②店舗名 *" autocomplete="off">
            <input type="hidden" id="report-store" name="store_id">
            <input type="hidden" id="report-store-name" name="store_name">
            <div id="store-search-results" class="store-search-results" style="display: none;"></div>
          </div>
        </div>
      </div>
      <div class="form-row three-col-inline">
        <div class="form-group date-time-group">
          <label for="report-date" class="date-time-label">清掃日 <span class="required">*</span></label>
          <input type="date" id="report-date" name="cleaning_date" class="form-input date-time-input" required>
        </div>
        <div class="form-group date-time-group">
          <label for="report-start" class="date-time-label">開始</label>
          <div class="date-time-input-wrapper">
            <i class="fas fa-clock date-time-icon"></i>
            <input type="time" id="report-start" name="cleaning_start_time" class="form-input date-time-input" placeholder="--:--">
          </div>
        </div>
        <div class="form-group date-time-group">
          <label for="report-end" class="date-time-label">終了</label>
          <div class="date-time-input-wrapper">
            <i class="fas fa-clock date-time-icon"></i>
            <input type="time" id="report-end" name="cleaning_end_time" class="form-input date-time-input" placeholder="--:--">
          </div>
        </div>
      </div>
    </div>

    <!-- 画像ストックエリア -->
    <div class="image-stock-section">
      <div class="image-stock-header">
        <h3><i class="fas fa-images"></i> 画像ストック</h3>
        <div class="image-stock-actions">
          <label class="btn-upload-stock">
            <input type="file" accept="image/*" multiple id="stock-file-input" style="display:none;">
            <i class="fas fa-plus"></i>
            <span>画像を追加</span>
          </label>
          <button type="button" class="btn-clear-stock" id="clear-stock-btn" style="display:none;">
            <i class="fas fa-trash"></i>
            <span>すべて削除</span>
          </button>
        </div>
      </div>
      <div class="image-stock-description">
        <p>画像をまとめてアップロードして、後で各セクションに振り分けられます</p>
      </div>
      <div class="image-stock-grid" id="image-stock-grid">
        <div class="image-stock-empty">
          <i class="fas fa-cloud-upload-alt"></i>
          <p>画像をアップロードしてください</p>
          <small>ドラッグ&ドロップで各セクションに配置できます</small>
        </div>
      </div>
    </div>

    <!-- 実施清掃項目リスト -->
    <div class="items-list-bar">
      <span class="items-list-label">実施清掃項目</span>
      <div class="items-list-items" id="cleaning-items-list">
        <span class="items-list-empty">項目を追加してください</span>
      </div>
    </div>

    <!-- コンテンツエリア -->
    <div class="report-content" id="report-content">
      <!-- セクションが動的に追加される -->
    </div>

    <!-- 追加ボタン（固定フッター） -->
    <div class="add-buttons-footer" id="add-buttons-footer">
      <button type="button" class="btn-add" id="add-cleaning-item" data-section-type="cleaning">
        <i class="fas fa-list"></i>
        <span>清掃項目</span>
      </button>
      <button type="button" class="btn-add" id="add-work-content" data-section-type="work_content">
        <i class="fas fa-tasks"></i>
        <span>作業内容</span>
      </button>
      <button type="button" class="btn-add" id="add-image" data-section-type="image">
        <i class="fas fa-image"></i>
        <span>画像</span>
      </button>
      <button type="button" class="btn-add" id="add-comment" data-section-type="comment">
        <i class="fas fa-comment"></i>
        <span>コメント</span>
      </button>
    </div>

    <!-- 送信ボタン -->
    <div class="submit-section">
      <button type="submit" class="btn-submit" id="submit-btn">
        <i class="fas fa-paper-plane"></i>
        レポートを提出
       </button>
    </div>
  </form>
  </div>

  <!-- 修正・編集タブ -->
  <div id="tab-content-edit" class="tab-content">
    <div class="revision-list-container">
      <div id="revision-list" class="revision-list">
        <div class="loading-spinner">
          <i class="fas fa-spinner fa-spin"></i>
          <p>読み込み中...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- 画像倉庫モーダル -->
  <div id="warehouse-dialog" class="modal-overlay" style="display:none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>画像を選択</h3>
        <button type="button" class="modal-close" onclick="document.getElementById('warehouse-dialog').style.display='none'">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="warehouse-tabs">
          <button type="button" class="tab-btn active" data-tab="stock">
            <i class="fas fa-box"></i> 画像ストック
          </button>
          <button type="button" class="tab-btn" data-tab="library">
            <i class="fas fa-images"></i> 画像倉庫
          </button>
        </div>
        
        <!-- 画像ストックタブ -->
        <div id="tab-stock" class="tab-content active">
          <div class="stock-selection-grid" id="stock-selection-grid">
            <p class="loading">読み込み中...</p>
          </div>
        </div>
        
        <!-- 画像倉庫タブ -->
        <div id="tab-library" class="tab-content">
          <div class="library-filters">
            <input type="date" id="library-date" class="form-input">
            <select id="library-category" class="form-select">
              <option value="">すべて</option>
              <option value="before">作業前</option>
              <option value="after">作業後</option>
            </select>
          </div>
          <div class="library-grid" id="library-grid">
            <p class="loading">読み込み中...</p>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" onclick="document.getElementById('warehouse-dialog').style.display='none'">キャンセル</button>
        <button type="button" class="btn btn-primary" id="save-images-btn">
          <i class="fas fa-check"></i> 選択を確定
        </button>
      </div>
    </div>
  </div>

  <!-- ブランド選択モーダル -->
  <div id="brand-select-modal" class="modal-overlay" style="display:none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>ブランドを選択</h3>
        <button type="button" class="modal-close" onclick="closeBrandModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="store-search-wrapper">
          <input type="text" id="brand-modal-search" class="form-input" placeholder="ブランド名で検索..." autocomplete="off">
          <div id="brand-modal-results" class="store-search-results-modal"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- 店舗選択モーダル -->
  <div id="store-select-modal" class="modal-overlay" style="display:none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>店舗を選択</h3>
        <button type="button" class="modal-close" onclick="closeStoreModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="store-search-wrapper">
          <input type="text" id="store-modal-search" class="form-input" placeholder="店舗名で検索..." autocomplete="off">
          <div id="store-modal-results" class="store-search-results-modal"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ヘルプモーダル -->
  <div id="help-dialog" class="modal-overlay" style="display:none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>使い方</h3>
        <button type="button" class="modal-close" onclick="document.getElementById('help-dialog').style.display='none'">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="help-section">
          <h4><i class="fas fa-list"></i> 清掃項目</h4>
          <p>実施した清掃項目を追加します（グリストラップ、レンジフードなど）</p>
        </div>
        <div class="help-section">
          <h4><i class="fas fa-image"></i> 画像</h4>
          <p>作業前・作業後の写真を追加します。カメラで撮影するか、画像倉庫から選択できます。</p>
        </div>
        <div class="help-section">
          <h4><i class="fas fa-comment"></i> コメント</h4>
          <p>特記事項やメモを追加します。</p>
        </div>
        <div class="help-section">
          <h4><i class="fas fa-tasks"></i> 作業内容</h4>
          <p>作業の詳細な内容を記載します。</p>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" onclick="document.getElementById('help-dialog').style.display='none'">閉じる</button>
      </div>
    </div>
  </div>
</main>

<script src="/js/staff-report-new.js"></script>
