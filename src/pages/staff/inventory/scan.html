@layout('layouts.base')
@json('data/meta/staff_inventory_scan_title.json', $title)
@json('data/meta/staff_inventory_scan_body_class.json', $body_class)

<link rel="stylesheet" href="/css/staff-inventory-scan.css" />

<main class="staff-inventory-scan">
  <div class="scan-container">
    <header class="scan-header">
      <h1>在庫管理</h1>
      <button type="button" class="btn-icon" id="btn-cart" style="position: relative;">
        <i class="fas fa-shopping-cart"></i>
        <span class="cart-badge" id="cart-badge" style="display: none;">0</span>
      </button>
    </header>

    <!-- QRスキャンエリア -->
    <div class="scan-section">
      <div class="scan-area" id="scan-area">
        <div class="scan-placeholder">
          <i class="fas fa-qrcode"></i>
          <p>QRコードをスキャンしてください</p>
          <button type="button" class="btn btn-primary" id="btn-start-scan">
            <i class="fas fa-camera"></i> スキャン開始
          </button>
          <button type="button" class="btn btn-outline" id="btn-manual-input" style="margin-top: 12px;">
            <i class="fas fa-keyboard"></i> 商品IDを手入力
          </button>
        </div>
        <div id="reader" style="display: none;"></div>
      </div>
    </div>

    <!-- 商品情報表示エリア -->
    <div class="product-info-section" id="product-info-section" style="display: none;">
      <div class="product-card">
        <div class="product-header">
          <h2 id="product-name">-</h2>
          <button type="button" class="btn-icon" id="btn-close-product">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="product-details">
          <div class="detail-row">
            <span class="detail-label">商品ID:</span>
            <span class="detail-value" id="product-id">-</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">現在の在庫:</span>
            <span class="detail-value" id="product-stock">-</span>
          </div>
        </div>
        <div class="quantity-input-area">
          <label for="quantity-input">数量</label>
          <div class="quantity-controls">
            <button type="button" class="btn-quantity" id="btn-decrease">-</button>
            <input type="number" id="quantity-input" value="1" min="1" required>
            <button type="button" class="btn-quantity" id="btn-increase">+</button>
          </div>
        </div>
        <div class="action-buttons">
          <button type="button" class="btn btn-success" id="btn-stock-in">
            <i class="fas fa-arrow-up"></i> 入庫
          </button>
          <button type="button" class="btn btn-danger" id="btn-stock-out">
            <i class="fas fa-arrow-down"></i> 出庫
          </button>
        </div>
      </div>
    </div>

    <!-- カートエリア -->
    <div class="cart-section" id="cart-section" style="display: none;">
      <div class="cart-header">
        <h2>カート</h2>
        <button type="button" class="btn-icon" id="btn-close-cart">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="cart-items" id="cart-items">
        <!-- カートアイテムが動的に追加される -->
      </div>
      <div class="cart-footer">
        <div class="cart-total">
          <span>合計:</span>
          <span id="cart-total-count">0</span>
          <span>商品</span>
        </div>
        <div class="cart-actions">
          <button type="button" class="btn btn-outline" id="btn-clear-cart">
            <i class="fas fa-trash"></i> クリア
          </button>
          <button type="button" class="btn btn-primary" id="btn-process-cart">
            <i class="fas fa-check"></i> 一括処理
          </button>
        </div>
      </div>
    </div>

    <!-- 手入力モーダル -->
    <div id="manual-input-dialog" class="modal-overlay" style="display:none;">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h3>商品IDを手入力</h3>
            <button type="button" class="modal-close" id="btn-close-manual">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="modal-body">
            <div class="input-group">
              <label for="manual-product-id">商品ID</label>
              <input type="text" id="manual-product-id" placeholder="例: P001" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-outline" id="btn-cancel-manual">キャンセル</button>
            <button type="button" class="btn btn-primary" id="btn-submit-manual">確定</button>
          </div>
        </div>
      </div>
    </div>

    <!-- 処理モード選択モーダル -->
    <div id="process-mode-dialog" class="modal-overlay" style="display:none;">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h3>処理モードを選択</h3>
            <button type="button" class="modal-close" id="btn-close-mode">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="modal-body">
            <p style="margin-bottom: 16px;">カート内の商品を一括処理します。</p>
            <div class="mode-buttons">
              <button type="button" class="btn btn-success btn-mode" data-mode="in">
                <i class="fas fa-arrow-up"></i> 入庫
              </button>
              <button type="button" class="btn btn-danger btn-mode" data-mode="out">
                <i class="fas fa-arrow-down"></i> 出庫
              </button>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-outline" id="btn-cancel-mode">キャンセル</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
<script src="/js/staff-inventory-scan.js?v=2"></script>

