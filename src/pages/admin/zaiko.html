@layout('layouts.admin')
@json('data/meta/admin_zaiko_title.json', $title)
@json('data/meta/admin_zaiko_body_class.json', $body_class)

<link rel="stylesheet" href="/css/zaiko.css" />

<main id="main" class="admin-zaiko">
  @include('partials.admin-sidebar')
  
  <!-- メインコンテンツ -->
  <div class="main-content">
    <!-- トップバー -->
    <header class="topbar">
      <div class="topbar-left">
        <h1>在庫管理</h1>
      </div>
      <div class="topbar-right">
        <button type="button" class="btn btn-primary" id="btn-new-item">
          <i class="fas fa-plus"></i> 商品登録
        </button>
        <button type="button" class="btn btn-outline" id="btn-show-qrcodes">
          <i class="fas fa-qrcode"></i> QRコード一覧
        </button>
      </div>
    </header>

    <div class="content-wrapper">
      <div class="zaiko-container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <h2 style="margin: 0;">📦 現在の在庫一覧</h2>
          <div id="loading-spinner" style="display: none;">
            <i class="fas fa-spinner fa-spin"></i> 読み込み中...
          </div>
        </div>
        <div class="inventory-grid" id="inventory-grid">
          <!-- カードが動的に追加される -->
        </div>
      </div>
    </div>
  </div>

  <!-- 商品詳細モーダル -->
  <dialog id="product-detail-dialog" class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal-product-name">商品詳細</h3>
        <button type="button" class="modal-close" onclick="document.getElementById('product-detail-dialog').close()">
          <i class="fas fa-times"></i>
        </button>
      </div>    
      <div class="modal-body">
        <div class="product-detail-info">
          <div class="detail-item">
            <span class="detail-label">商品ID:</span>
            <span class="detail-value" id="modal-product-id">-</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">商品名:</span>
            <span class="detail-value" id="modal-product-name-text">-</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">現在の在庫数:</span>
            <span class="detail-value" id="modal-product-stock">-</span>
          </div>
        </div>
        
        <!-- 最後の入出庫情報 -->
        <div class="last-transaction-section" style="margin-top: 20px; padding: 16px; background: #f9fafb; border-radius: 12px;">
          <h4 style="margin: 0 0 12px 0; font-size: 0.9rem; color: #6b7280;">最終更新</h4>
          <div id="last-transaction-info" style="font-size: 0.95rem; color: #374151;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
              <span>最終入庫:</span>
              <span id="last-in-info" style="font-weight: 600;">-</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span>最終出庫:</span>
              <span id="last-out-info" style="font-weight: 600;">-</span>
            </div>
          </div>
        </div>
        
        <hr style="margin: 20px 0; border: none; border-top: 1px solid #e5e7eb;">
        
        <div class="product-qrcode-section" style="text-align: center; padding: 20px 0;">
          <h4 style="margin-bottom: 16px; font-size: 1rem; color: #374151;">QRコード</h4>
          <div id="modal-product-qrcode" style="display: inline-block;"></div>
        </div>
        
        <hr style="margin: 20px 0; border: none; border-top: 1px solid #e5e7eb;">
        
        <div class="modal-transaction-area">
          <h4>在庫更新</h4>
          <div class="mode-buttons">
            <button id="modal-mode-in" class="active">入庫</button>
            <button id="modal-mode-out" class="inactive">出庫</button>
          </div>
          <div class="input-group">
            <label for="modal-quantity">数量</label>
            <input type="number" id="modal-quantity" value="1" min="1" required>
          </div>
          <button id="modal-process-button" class="btn-process">在庫更新を実行</button>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" onclick="document.getElementById('product-detail-dialog').close()">閉じる</button>
      </div>
    </div>
  </dialog>

  <!-- 商品登録モーダル -->
  <dialog id="new-item-dialog" class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3>商品登録</h3>
        <button type="button" class="modal-close" onclick="document.getElementById('new-item-dialog').close()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="input-group">
          <label for="new-product-id">商品ID <span style="color: red;">*</span> <span style="font-size: 0.85rem; color: #6b7280;">（自動生成）</span></label>
          <input type="text" id="new-product-id" placeholder="例: P011" required readonly style="background-color: #f3f4f6; cursor: not-allowed;">
        </div>
        <div class="input-group">
          <label for="new-product-name">商品名 <span style="color: red;">*</span></label>
          <input type="text" id="new-product-name" placeholder="例: 商品K（掃除用具）" required>
        </div>
        <div class="input-group">
          <label for="new-product-stock">初期在庫数</label>
          <input type="number" id="new-product-stock" value="0" min="0" required>
        </div>
        <div class="input-group">
          <label for="new-product-min-stock">最小在庫数</label>
          <input type="number" id="new-product-min-stock" value="50" min="0" required>
        </div>
        <div class="input-group">
          <label for="new-product-safe-stock">安全在庫数</label>
          <input type="number" id="new-product-safe-stock" value="100" min="0" required>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" onclick="document.getElementById('new-item-dialog').close()">キャンセル</button>
        <button type="button" class="btn btn-primary" id="btn-create-item">登録</button>
      </div>
    </div>
  </dialog>

  <!-- QRコード一覧モーダル -->
  <dialog id="qrcode-dialog" class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3>QRコード一覧</h3>
        <button type="button" class="modal-close" onclick="document.getElementById('qrcode-dialog').close()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div id="qrcode-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 16px; padding: 16px;">
          <!-- QRコードが動的に追加される -->
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" onclick="document.getElementById('qrcode-dialog').close()">閉じる</button>
      </div>
    </div>
  </dialog>
</main>

<script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
<script src="/js/zaiko.js"></script>