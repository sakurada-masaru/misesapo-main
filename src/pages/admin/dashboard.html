@layout('layouts.base')
@json('data/meta/admin_dashboard_title.json', $title)
@json('data/meta/admin_dashboard_body_class.json', $body_class)

<main id="main" class="admin-dashboard">
  <!-- ヘッダー -->
  <header class="dash-header">
    <div class="container">
      <div class="header-inner">
        <div class="header-left">
          <h1>管理ダッシュボード</h1>
          <span class="header-date" id="header-date"></span>
        </div>
        <div class="header-right">
          <button class="header-btn" id="open-notice-modal">
            <i class="fas fa-bullhorn"></i>
          </button>
          <div class="user-badge">
            <span class="user-avatar">管</span>
            <span class="user-name">管理者</span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- アラートセクション -->
  <section class="alerts-section" id="alerts-section">
    <div class="container">
      <!-- 仮押さえアラート -->
      <div class="alert-card alert-warning" id="draft-alert" style="display:none;">
        <div class="alert-icon">
          <i class="fas fa-clock"></i>
        </div>
        <div class="alert-content">
          <div class="alert-title">仮押さえ申請 <span class="alert-badge" id="draft-count">0</span>件</div>
          <div class="alert-text">営業からスケジュールの仮押さえ申請が届いています</div>
        </div>
        <a href="/admin/schedules/?status=draft" class="alert-action">
          確認する <i class="fas fa-arrow-right"></i>
        </a>
      </div>

      <!-- 仮見積もりアラート -->
      <div class="alert-card alert-success" id="estimate-alert" style="display:none;">
        <div class="alert-icon">
          <i class="fas fa-file-invoice-dollar"></i>
        </div>
        <div class="alert-content">
          <div class="alert-title">仮見積もり申請 <span class="alert-badge" id="estimate-count">0</span>件</div>
          <div class="alert-text">営業から仮見積もりが届いています（経理担当確認）</div>
        </div>
        <a href="/admin/estimates/?status=pending" class="alert-action">
          確認する <i class="fas fa-arrow-right"></i>
        </a>
      </div>

      <!-- 承認待ちレポート -->
      <div class="alert-card alert-info" id="pending-alert" style="display:none;">
        <div class="alert-icon">
          <i class="fas fa-file-alt"></i>
        </div>
        <div class="alert-content">
          <div class="alert-title">承認待ちレポート <span class="alert-badge" id="pending-report-count">0</span>件</div>
          <div class="alert-text">清掃員からのレポートが承認待ちです</div>
        </div>
        <a href="/admin/reports/?status=pending" class="alert-action">
          確認する <i class="fas fa-arrow-right"></i>
        </a>
      </div>
    </div>
  </section>

  <!-- 統計カード -->
  <section class="stats-section">
    <div class="container">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon blue"><i class="fas fa-store"></i></div>
          <div class="stat-body">
            <div class="stat-value" id="stat-customers">-</div>
            <div class="stat-label">総顧客数</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon green"><i class="fas fa-calendar-check"></i></div>
          <div class="stat-body">
            <div class="stat-value" id="stat-today">-</div>
            <div class="stat-label">今日の清掃</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon purple"><i class="fas fa-users"></i></div>
          <div class="stat-body">
            <div class="stat-value" id="stat-workers">-</div>
            <div class="stat-label">清掃員</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon orange"><i class="fas fa-chart-line"></i></div>
          <div class="stat-body">
            <div class="stat-value" id="stat-month">-</div>
            <div class="stat-label">今月の清掃</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- クイックアクション -->
  <section class="quick-section">
    <div class="container">
      <h2 class="section-title">クイックアクション</h2>
      <div class="quick-grid">
        <a href="/admin/schedules/" class="quick-card">
          <div class="quick-icon"><i class="fas fa-calendar-plus"></i></div>
          <span>スケジュール管理</span>
        </a>
        <a href="/admin/customers/" class="quick-card">
          <div class="quick-icon"><i class="fas fa-store"></i></div>
          <span>顧客管理</span>
        </a>
        <a href="/admin/reports/" class="quick-card">
          <div class="quick-icon"><i class="fas fa-file-alt"></i></div>
          <span>レポート管理</span>
        </a>
        <a href="/admin/estimates/" class="quick-card">
          <div class="quick-icon"><i class="fas fa-file-invoice-dollar"></i></div>
          <span>仮見積もり管理</span>
        </a>
        <a href="/admin/services/" class="quick-card">
          <div class="quick-icon"><i class="fas fa-tools"></i></div>
          <span>サービス管理</span>
        </a>
        <a href="/admin/users/" class="quick-card">
          <div class="quick-icon"><i class="fas fa-users-cog"></i></div>
          <span>ユーザー管理</span>
        </a>
        <a href="/admin/cleaning-manual.html" class="quick-card">
          <div class="quick-icon"><i class="fas fa-book"></i></div>
          <span>清掃マニュアル</span>
        </a>
        <a href="/admin/images/" class="quick-card">
          <div class="quick-icon"><i class="fas fa-images"></i></div>
          <span>画像管理</span>
        </a>
        <a href="/admin/analytics/" class="quick-card">
          <div class="quick-icon"><i class="fas fa-chart-bar"></i></div>
          <span>アクセス分析</span>
        </a>
      </div>
    </div>
  </section>

  <!-- メインコンテンツ -->
  <section class="main-section">
    <div class="container">
      <div class="main-grid">
        <!-- 今日のスケジュール -->
        <div class="panel">
          <div class="panel-header">
            <h3><i class="fas fa-calendar-day"></i> 今日のスケジュール</h3>
            <a href="/admin/schedules/" class="panel-link">すべて見る</a>
          </div>
          <div class="panel-body" id="today-schedules">
            <div class="loading"><i class="fas fa-spinner fa-spin"></i></div>
          </div>
        </div>

        <!-- 最近のアクティビティ -->
        <div class="panel">
          <div class="panel-header">
            <h3><i class="fas fa-history"></i> 最近のアクティビティ</h3>
          </div>
          <div class="panel-body" id="recent-activity">
            <div class="loading"><i class="fas fa-spinner fa-spin"></i></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- お知らせモーダル -->
  <div class="modal-backdrop" id="notice-modal-backdrop">
    <div class="modal" role="dialog">
      <button class="modal-close" id="close-notice-modal"><i class="fas fa-times"></i></button>
      <h3>お知らせを投稿</h3>
      <form id="notice-form">
        <div class="form-group">
          <label>タイトル</label>
          <input type="text" name="title" required placeholder="例：メンテナンスのお知らせ">
        </div>
        <div class="form-group">
          <label>配信対象</label>
          <select name="target">
            <option value="all">全ユーザー</option>
            <option value="customers">顧客</option>
            <option value="staff">清掃スタッフ</option>
          </select>
        </div>
        <div class="form-group">
          <label>本文</label>
          <textarea name="body" required rows="4" placeholder="お知らせの内容"></textarea>
        </div>
        <div class="form-actions">
          <button type="button" class="btn-cancel" id="cancel-notice">キャンセル</button>
          <button type="submit" class="btn-primary">投稿する</button>
        </div>
      </form>
    </div>
  </div>

  <style>
    .admin-dashboard {
      background: #f8fafc;
      min-height: 100vh;
    }

    /* ヘッダー */
    .dash-header {
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      color: #fff;
      padding: 20px 0;
    }
    .header-inner {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .header-left h1 {
      font-size: 1.5rem;
      font-weight: 600;
      margin: 0 0 4px;
    }
    .header-date {
      font-size: 0.875rem;
      opacity: 0.8;
    }
    .header-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    .header-btn {
      width: 40px;
      height: 40px;
      border: none;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      color: #fff;
      font-size: 1rem;
      cursor: pointer;
    }
    .header-btn:hover {
      background: rgba(255,255,255,0.2);
    }
    .user-badge {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 16px;
      background: rgba(255,255,255,0.1);
      border-radius: 30px;
    }
    .user-avatar {
      width: 32px;
      height: 32px;
      background: var(--primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.875rem;
    }
    .user-name {
      font-size: 0.875rem;
    }

    /* コンテナ - 画面全体を使用 */
    .container {
      max-width: 100%;
      margin: 0 auto;
      padding: 0 24px;
    }

    /* アラート */
    .alerts-section {
      padding: 24px 0 0;
    }
    .alert-card {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px 20px;
      border-radius: 12px;
      margin-bottom: 12px;
    }
    .alert-warning {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border: 1px solid #fbbf24;
    }
    .alert-info {
      background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
      border: 1px solid #3b82f6;
    }
    .alert-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      flex-shrink: 0;
    }
    .alert-warning .alert-icon {
      background: #fbbf24;
      color: #fff;
    }
    .alert-info .alert-icon {
      background: #3b82f6;
      color: #fff;
    }
    .alert-content {
      flex: 1;
    }
    .alert-title {
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 2px;
    }
    .alert-badge {
      display: inline-block;
      padding: 2px 8px;
      background: #ef4444;
      color: #fff;
      border-radius: 10px;
      font-size: 0.75rem;
      margin-left: 4px;
    }
    .alert-text {
      font-size: 0.85rem;
      color: #64748b;
    }
    .alert-action {
      padding: 10px 20px;
      background: #1e293b;
      color: #fff;
      text-decoration: none;
      border-radius: 8px;
      font-size: 0.875rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }
    .alert-action:hover {
      background: #334155;
    }

    /* 統計 */
    .stats-section {
      padding: 24px 0;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
    }
    .stat-card {
      background: #fff;
      border-radius: 16px;
      padding: 24px;
      display: flex;
      align-items: center;
      gap: 16px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    .stat-icon {
      width: 56px;
      height: 56px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      flex-shrink: 0;
    }
    .stat-icon.blue { background: #dbeafe; color: #2563eb; }
    .stat-icon.green { background: #dcfce7; color: #16a34a; }
    .stat-icon.purple { background: #f3e8ff; color: #9333ea; }
    .stat-icon.orange { background: #ffedd5; color: #ea580c; }
    .stat-body {
      flex: 1;
    }
    .stat-value {
      font-size: 1.75rem;
      font-weight: 700;
      color: #1e293b;
      line-height: 1.2;
    }
    .stat-label {
      font-size: 0.875rem;
      color: #64748b;
      margin-top: 2px;
    }

    /* クイックアクション */
    .quick-section {
      padding: 0 0 24px;
    }
    .section-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: #1e293b;
      margin: 0 0 16px;
    }
    .quick-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 16px;
    }
    .quick-card {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      text-decoration: none;
      color: #1e293b;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
      transition: all 0.2s;
    }
    .quick-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .quick-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, var(--primary) 0%, #ff8fab 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 12px;
      color: #fff;
      font-size: 1.25rem;
    }
    .quick-card span {
      font-size: 0.875rem;
      font-weight: 500;
    }

    /* メインコンテンツ */
    .main-section {
      padding: 0 0 48px;
    }
    .main-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
    }
    .panel {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
      overflow: hidden;
    }
    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 24px;
      border-bottom: 1px solid #f1f5f9;
    }
    .panel-header h3 {
      font-size: 1rem;
      font-weight: 600;
      color: #1e293b;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .panel-header h3 i {
      color: var(--primary);
    }
    .panel-link {
      font-size: 0.85rem;
      color: var(--primary);
      text-decoration: none;
    }
    .panel-body {
      padding: 20px 24px;
    }
    .loading {
      text-align: center;
      padding: 40px;
      color: #94a3b8;
    }

    /* スケジュールリスト */
    .schedule-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 12px 0;
      border-bottom: 1px solid #f1f5f9;
    }
    .schedule-item:last-child {
      border-bottom: none;
    }
    .schedule-time {
      font-size: 0.9rem;
      font-weight: 600;
      color: #1e293b;
      width: 60px;
      flex-shrink: 0;
    }
    .schedule-info {
      flex: 1;
    }
    .schedule-store {
      font-weight: 500;
      color: #1e293b;
      margin-bottom: 2px;
    }
    .schedule-worker {
      font-size: 0.8rem;
      color: #64748b;
    }
    .schedule-status {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .schedule-status.draft { background: #fef3c7; color: #b45309; }
    .schedule-status.scheduled { background: #dbeafe; color: #1d4ed8; }
    .schedule-status.completed { background: #dcfce7; color: #16a34a; }
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #94a3b8;
    }

    /* アクティビティ */
    .activity-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 12px 0;
      border-bottom: 1px solid #f1f5f9;
    }
    .activity-item:last-child {
      border-bottom: none;
    }
    .activity-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-top: 6px;
      flex-shrink: 0;
    }
    .activity-dot.green { background: #22c55e; }
    .activity-dot.blue { background: #3b82f6; }
    .activity-dot.orange { background: #f59e0b; }
    .activity-text {
      flex: 1;
    }
    .activity-text span:first-child {
      display: block;
      font-weight: 500;
      color: #1e293b;
      margin-bottom: 2px;
    }
    .activity-meta {
      font-size: 0.8rem;
      color: #94a3b8;
    }

    /* モーダル */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal-backdrop.active {
      display: flex;
    }
    .modal {
      background: #fff;
      border-radius: 20px;
      width: min(560px, 90vw);
      padding: 32px;
      position: relative;
    }
    .modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      background: none;
      border: none;
      font-size: 1.25rem;
      color: #94a3b8;
      cursor: pointer;
    }
    .modal h3 {
      font-size: 1.25rem;
      margin: 0 0 24px;
      color: #1e293b;
    }
    .form-group {
      margin-bottom: 16px;
    }
    .form-group label {
      display: block;
      font-size: 0.875rem;
      font-weight: 600;
      color: #475569;
      margin-bottom: 6px;
    }
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #e2e8f0;
      border-radius: 10px;
      font-size: 0.95rem;
    }
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--primary);
    }
    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      margin-top: 24px;
    }
    .btn-cancel {
      padding: 12px 24px;
      background: #f1f5f9;
      border: none;
      border-radius: 10px;
      font-size: 0.9rem;
      cursor: pointer;
    }
    .btn-primary {
      padding: 12px 24px;
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 10px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
    }

    /* レスポンシブ */
    @media (max-width: 1200px) {
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
      .quick-grid { grid-template-columns: repeat(3, 1fr); }
    }
    @media (max-width: 768px) {
      .container { padding: 0 16px; }
      .stats-grid { grid-template-columns: 1fr; }
      .quick-grid { grid-template-columns: repeat(2, 1fr); }
      .main-grid { grid-template-columns: 1fr; }
      .alert-card { flex-direction: column; text-align: center; }
      .alert-action { width: 100%; justify-content: center; }
    }
  </style>
</main>

<script>
(function() {
  const API_BASE = 'https://51bhoxkbxd.execute-api.ap-northeast-1.amazonaws.com/prod';
  
  // 日付表示
  const today = new Date();
  const dateStr = today.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
  document.getElementById('header-date').textContent = dateStr;

  // データ読み込み
  async function loadDashboard() {
    try {
      const [storesRes, schedulesRes, workersRes, reportsRes] = await Promise.all([
        fetch(`${API_BASE}/stores`),
        fetch(`${API_BASE}/schedules`),
        fetch(`${API_BASE}/workers`),
        fetch(`${API_BASE}/reports`)
      ]);

      const stores = await storesRes.json();
      const schedules = await schedulesRes.json();
      const workers = await workersRes.json();
      const reports = await reportsRes.json();

      // 統計
      document.getElementById('stat-customers').textContent = stores.length;
      document.getElementById('stat-workers').textContent = workers.length;

      const todayStr = today.toISOString().split('T')[0];
      const todaySchedules = schedules.filter(s => s.scheduled_date === todayStr);
      document.getElementById('stat-today').textContent = todaySchedules.length;

      const thisMonth = today.toISOString().slice(0, 7);
      const monthSchedules = schedules.filter(s => s.scheduled_date?.startsWith(thisMonth));
      document.getElementById('stat-month').textContent = monthSchedules.length;

      // 仮押さえアラート
      const draftSchedules = schedules.filter(s => s.status === 'draft');
      if (draftSchedules.length > 0) {
        document.getElementById('draft-alert').style.display = 'flex';
        document.getElementById('draft-count').textContent = draftSchedules.length;
      }

      // 仮見積もりアラート
      try {
        const estimatesRes = await fetch(`${API_BASE}/estimates?status=pending`);
        if (estimatesRes.ok) {
          const pendingEstimates = await estimatesRes.json();
          if (pendingEstimates.length > 0) {
            document.getElementById('estimate-alert').style.display = 'flex';
            document.getElementById('estimate-count').textContent = pendingEstimates.length;
          }
        }
      } catch (e) {
        console.log('Estimates API not available yet');
      }

      // 承認待ちレポートは現状承認済み扱い（非表示）
      // const pendingReports = reports.filter(r => !r.send_at);

      // 今日のスケジュール
      renderTodaySchedules(todaySchedules, stores, workers);

      // 最近のアクティビティ
      renderRecentActivity(schedules, stores, workers, reports);

    } catch (error) {
      console.error('Dashboard load error:', error);
    }
  }

  function renderTodaySchedules(schedules, stores, workers) {
    const container = document.getElementById('today-schedules');
    
    if (schedules.length === 0) {
      container.innerHTML = '<div class="empty-state"><i class="fas fa-calendar-check" style="font-size:2rem;margin-bottom:12px;display:block;"></i>今日の予定はありません</div>';
      return;
    }

    schedules.sort((a, b) => (a.scheduled_time || '').localeCompare(b.scheduled_time || ''));

    container.innerHTML = schedules.slice(0, 5).map(s => {
      const store = stores.find(st => st.id === s.store_id) || {};
      const worker = workers.find(w => w.id === s.worker_id);
      const statusLabel = s.status === 'draft' ? '仮押さえ' : (s.status === 'completed' ? '完了' : '確定');
      
      return `
        <div class="schedule-item">
          <div class="schedule-time">${s.scheduled_time || '-'}</div>
          <div class="schedule-info">
            <div class="schedule-store">${escapeHtml(store.name || '不明')}</div>
            <div class="schedule-worker">${worker ? escapeHtml(worker.name) : '未割当'}</div>
          </div>
          <span class="schedule-status ${s.status || 'scheduled'}">${statusLabel}</span>
        </div>
      `;
    }).join('');
  }

  function escapeHtml(str) {
    if (!str) return '';
    const div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
  }

  // 最近のアクティビティを描画
  function renderRecentActivity(schedules, stores, workers, reports) {
    const container = document.getElementById('recent-activity');
    const activities = [];

    // スケジュールからアクティビティ生成
    schedules.forEach(s => {
      const store = stores.find(st => st.id === s.store_id) || {};
      const worker = workers.find(w => w.id === s.worker_id);
      const date = s.updated_at || s.created_at;
      if (date) {
        if (s.status === 'draft') {
          activities.push({
            type: 'schedule_draft',
            text: '仮押さえ申請',
            meta: `${escapeHtml(store.name || '店舗')}`,
            date: date,
            color: 'orange'
          });
        } else if (s.status === 'scheduled') {
          activities.push({
            type: 'schedule_confirmed',
            text: 'スケジュール確定',
            meta: `${escapeHtml(store.name || '店舗')} - ${escapeHtml(worker?.name || '未割当')}`,
            date: date,
            color: 'blue'
          });
        } else if (s.status === 'completed') {
          activities.push({
            type: 'schedule_completed',
            text: '清掃完了',
            meta: `${escapeHtml(store.name || '店舗')}`,
            date: date,
            color: 'green'
          });
        }
      }
    });

    // 日付でソート（新しい順）
    activities.sort((a, b) => new Date(b.date) - new Date(a.date));

    // 上位5件を表示
    const recentActivities = activities.slice(0, 5);

    if (recentActivities.length === 0) {
      container.innerHTML = '<div class="empty-state">アクティビティはありません</div>';
      return;
    }

    container.innerHTML = recentActivities.map(a => {
      const timeAgo = getTimeAgo(a.date);
      return `
        <div class="activity-item">
          <div class="activity-dot ${a.color}"></div>
          <div class="activity-text">
            <span>${a.text}</span>
            <span class="activity-meta">${a.meta} - ${timeAgo}</span>
          </div>
        </div>
      `;
    }).join('');
  }

  // 経過時間を表示
  function getTimeAgo(dateStr) {
    const date = new Date(dateStr);
    const now = new Date();
    const diffMs = now - date;
    const diffMin = Math.floor(diffMs / 60000);
    const diffHour = Math.floor(diffMs / 3600000);
    const diffDay = Math.floor(diffMs / 86400000);

    if (diffMin < 1) return 'たった今';
    if (diffMin < 60) return `${diffMin}分前`;
    if (diffHour < 24) return `${diffHour}時間前`;
    if (diffDay < 7) return `${diffDay}日前`;
    return date.toLocaleDateString('ja-JP');
  }

  // モーダル
  const modalBackdrop = document.getElementById('notice-modal-backdrop');
  document.getElementById('open-notice-modal').addEventListener('click', () => {
    modalBackdrop.classList.add('active');
  });
  document.getElementById('close-notice-modal').addEventListener('click', () => {
    modalBackdrop.classList.remove('active');
  });
  document.getElementById('cancel-notice').addEventListener('click', () => {
    modalBackdrop.classList.remove('active');
  });
  modalBackdrop.addEventListener('click', (e) => {
    if (e.target === modalBackdrop) modalBackdrop.classList.remove('active');
  });

  document.getElementById('notice-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    // TODO: お知らせ投稿API
    alert('お知らせを投稿しました');
    modalBackdrop.classList.remove('active');
    e.target.reset();
  });

  // 初期化
  loadDashboard();
})();
</script>
