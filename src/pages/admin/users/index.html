@layout('layouts.admin')
@json('data/meta/admin_users_title.json', $title)
@json('data/meta/admin_users_body_class.json', $body_class)

<link rel="stylesheet" href="/css/admin-users.css" />

<main id="main" class="admin-users-v2">
  @include('partials.admin-sidebar')
  <!-- メインコンテンツ -->
  <div class="main-content">
    <!-- トップバー -->
    <header class="topbar">
      <div class="topbar-left">
        <h1>ユーザー管理</h1>
      </div>
      <div class="topbar-right">
        <button class="btn btn-primary" id="add-user-btn">
          <i class="fas fa-plus"></i> 新規ユーザー登録
        </button>
      </div>
    </header>

  <!-- 統計カード -->
  <div class="stats-row">
    <div class="stat-mini">
      <div class="stat-mini-icon blue"><i class="fas fa-users"></i></div>
      <div class="stat-mini-body">
        <div class="stat-mini-value" id="stat-total">-</div>
        <div class="stat-mini-label">総ユーザー</div>
      </div>
    </div>
    <div class="stat-mini">
      <div class="stat-mini-icon orange"><i class="fas fa-hard-hat"></i></div>
      <div class="stat-mini-body">
        <div class="stat-mini-value" id="stat-staff">-</div>
        <div class="stat-mini-label">清掃員</div>
      </div>
    </div>
    <div class="stat-mini">
      <div class="stat-mini-icon green"><i class="fas fa-user-tie"></i></div>
      <div class="stat-mini-body">
        <div class="stat-mini-value" id="stat-sales">-</div>
        <div class="stat-mini-label">営業</div>
      </div>
    </div>
    <div class="stat-mini">
      <div class="stat-mini-icon teal"><i class="fas fa-briefcase"></i></div>
      <div class="stat-mini-body">
        <div class="stat-mini-value" id="stat-office">-</div>
        <div class="stat-mini-label">事務</div>
      </div>
    </div>
    <div class="stat-mini">
      <div class="stat-mini-icon indigo"><i class="fas fa-code"></i></div>
      <div class="stat-mini-body">
        <div class="stat-mini-value" id="stat-developer">-</div>
        <div class="stat-mini-label">広報</div>
      </div>
    </div>
    <div class="stat-mini">
      <div class="stat-mini-icon purple"><i class="fas fa-user-shield"></i></div>
      <div class="stat-mini-body">
        <div class="stat-mini-value" id="stat-admin">-</div>
        <div class="stat-mini-label">管理者</div>
      </div>
    </div>
    <div class="stat-mini">
      <div class="stat-mini-icon pink"><i class="fas fa-cog"></i></div>
      <div class="stat-mini-body">
        <div class="stat-mini-value" id="stat-operation">-</div>
        <div class="stat-mini-label">運営</div>
      </div>
    </div>
  </div>

  <!-- フィルター -->
  <div class="filter-bar">
    <div class="search-box">
      <i class="fas fa-search"></i>
      <input type="text" id="search-input" placeholder="名前、メールで検索..." class="search-input" />
    </div>
    <div class="filter-options">
      <select class="filter-select" id="role-filter">
        <option value="">すべてのロール</option>
        <option value="admin">管理者</option>
        <option value="sales">営業</option>
        <option value="office">事務</option>
        <option value="cleaning">清掃</option>
        <option value="development">開発</option>
        <option value="director">取締役</option>
        <option value="general_affairs">総務</option>
        <option value="accounting">経理</option>
        <option value="human_resources">人事</option>
        <option value="special_advisor">スペシャルバイザー</option>
        <option value="field_sales">フィールドセールス</option>
        <option value="inside_sales">インサイドセールス</option>
        <option value="mechanic">メカニック</option>
        <option value="engineer">エンジニア</option>
        <option value="designer">デザイナー</option>
        <option value="part_time">アルバイト</option>
        <option value="contractor">外部委託</option>
        <option value="other">その他</option>
      </select>
      <select class="filter-select" id="status-filter">
        <option value="">すべてのステータス</option>
        <option value="active">有効</option>
        <option value="inactive">無効</option>
      </select>
      <button class="btn btn-secondary btn-sm" id="reset-filters">
        <i class="fas fa-undo"></i>
      </button>
    </div>
  </div>

  <!-- 出退勤管理（部署別） -->
  <div class="attendance-sections">
    <!-- 部署別のセクションはJavaScriptで動的に生成されます -->
  </div>

  <!-- 組織構造レイアウト -->
  <div class="organization-layout" id="organization-layout">
    <div class="loading-cell" id="loading-users">
      <i class="fas fa-spinner fa-spin"></i> 読み込み中...
    </div>
    
    <!-- フロントオフィス -->
    <section class="office-section front-office">
      <h2 class="section-title">
        <i class="fas fa-store"></i> フロントオフィス
      </h2>
      <div class="departments-container" id="front-office-departments">
        <!-- 部署が動的に追加されます -->
      </div>
    </section>

    <!-- ミドルオフィス -->
    <section class="office-section middle-office">
      <h2 class="section-title">
        <i class="fas fa-shield-alt"></i> ミドルオフィス
      </h2>
      <div class="departments-container" id="middle-office-departments">
        <!-- 部署が動的に追加されます -->
      </div>
    </section>

    <!-- バックオフィス -->
    <section class="office-section back-office">
      <h2 class="section-title">
        <i class="fas fa-cogs"></i> バックオフィス
      </h2>
      <div class="departments-container" id="back-office-departments">
        <!-- 部署が動的に追加されます -->
      </div>
    </section>

    <!-- 運営本部 -->
    <section class="office-section board-of-directors">
      <h2 class="section-title">
        <i class="fas fa-crown"></i> 運営本部
      </h2>
      <div class="departments-container" id="board-departments">
        <!-- 部署が動的に追加されます -->
      </div>
    </section>
  </div>

  <!-- 新規/編集モーダル -->
  <dialog id="user-dialog" class="user-dialog">
    <div class="dialog-content">
      <button type="button" class="dialog-close" onclick="document.getElementById('user-dialog').close()">
        <i class="fas fa-times"></i>
      </button>
      <h3 id="dialog-title">新規ユーザー登録</h3>
      <form id="user-form" method="dialog">
        <input type="hidden" id="user-id" name="id">
        <div class="form-row">
          <div class="form-field">
            <label for="user-name">名前 <span class="required">*</span></label>
            <input type="text" id="user-name" name="name" required placeholder="例: 山田太郎">
          </div>
        </div>
        <div class="form-row">
          <div class="form-field half">
            <label for="user-email">メールアドレス <span class="required">*</span></label>
            <input type="email" id="user-email" name="email" required placeholder="yamada.taro@example.com">
            <small class="form-hint">現状は個人メールアドレスも使用可能です（将来的には企業用メールアドレスへの移行を推奨）</small>
          </div>
          <div class="form-field half">
            <label for="user-phone">電話番号</label>
            <input type="tel" id="user-phone" name="phone" placeholder="090-1234-5678">
          </div>
        </div>
        <div class="form-row">
          <div class="form-field half">
            <label for="user-role">ロール <span class="required">*</span></label>
            <select id="user-role" name="role" required>
              <option value="">選択してください</option>
              <option value="admin">管理者</option>
              <option value="sales">営業</option>
              <option value="office">事務</option>
              <option value="cleaning">清掃</option>
              <option value="public_relations">広報</option>
              <option value="director">取締役</option>
              <option value="general_affairs">総務</option>
              <option value="accounting">経理</option>
              <option value="human_resources">人事</option>
              <option value="special_advisor">スペシャルバイザー</option>
              <option value="field_sales">フィールドセールス</option>
              <option value="inside_sales">インサイドセールス</option>
              <option value="mechanic">メカニック</option>
              <option value="engineer">エンジニア</option>
              <option value="designer">デザイナー</option>
              <option value="part_time">アルバイト</option>
              <option value="contractor">外部委託</option>
              <option value="other">その他</option>
            </select>
          </div>
          <div class="form-field half">
            <label for="user-department">部署</label>
            <input type="text" id="user-department" name="department" placeholder="例: 清掃員、FS営業、経理">
          </div>
        </div>
        <div class="form-row">
          <div class="form-field">
            <label for="user-status">ステータス</label>
            <select id="user-status" name="status">
              <option value="active">有効</option>
              <option value="inactive">無効</option>
            </select>
          </div>
        </div>
        <div class="form-row" id="password-row">
          <div class="form-field">
            <label for="user-password">パスワード <span class="required" id="password-required">*</span></label>
            <input type="password" id="user-password" name="password" placeholder="8文字以上">
            <p class="form-hint">編集時は空欄で変更なし</p>
          </div>
        </div>
        <div class="form-status" id="form-status"></div>
        <div class="dialog-actions">
          <button type="button" class="btn btn-secondary" onclick="document.getElementById('user-dialog').close()">キャンセル</button>
          <button type="submit" class="btn btn-primary" id="submit-btn">保存</button>
        </div>
      </form>
    </div>
  </dialog>

  <!-- 削除確認 -->
  <dialog id="delete-dialog" class="delete-dialog">
    <div class="dialog-content dialog-sm">
      <h3>削除確認</h3>
      <p>このユーザーを削除しますか？<br>この操作は取り消せません。</p>
      <div class="dialog-actions">
        <button type="button" class="btn btn-secondary" onclick="document.getElementById('delete-dialog').close()">キャンセル</button>
        <button type="button" class="btn btn-danger" id="confirm-delete">削除</button>
      </div>
    </div>
  </dialog>

  <!-- 一括ロール割り当て確認 -->
  <dialog id="bulk-role-dialog" class="delete-dialog">
    <div class="dialog-content dialog-sm">
      <h3>一括ロール割り当て</h3>
      <p id="bulk-role-message">選択したユーザーを<span id="bulk-role-name"></span>に設定しますか？</p>
      <div id="bulk-role-users-list" style="max-height: 200px; overflow-y: auto; margin: 16px 0; padding: 12px; background: #f9fafb; border-radius: 8px;">
        <!-- ユーザーリストがここに表示されます -->
      </div>
      <div class="dialog-actions">
        <button type="button" class="btn btn-secondary" onclick="document.getElementById('bulk-role-dialog').close()">キャンセル</button>
        <button type="button" class="btn btn-primary" id="confirm-bulk-role">設定する</button>
      </div>
    </div>
  </dialog>
  </div>
</main>

<script src="/js/admin-users.js"></script>
