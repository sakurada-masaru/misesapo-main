@layout('layouts.base')
@json('data/meta/dashboard_title.json', $title)
@json('data/meta/dashboard_body_class.json', $body_class)

<link rel="stylesheet" href="/assets/css/customer-dashboard.css">
<style>
    .document-list {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .document-card {
        background: white;
        padding: 20px;
        border-radius: 16px;
        border: 1px solid #f1f5f9;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: transform 0.2s;
    }

    .document-card:hover {
        transform: translateX(4px);
        border-color: var(--primary);
    }

    .document-info h3 {
        font-size: 1rem;
        margin: 0 0 4px;
        color: #0f172a;
    }

    .document-meta {
        font-size: 0.8125rem;
        color: #64748b;
    }

    .document-status {
        padding: 4px 12px;
        border-radius: 999px;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .status-sent {
        background: #eff6ff;
        color: #2563eb;
    }

    .status-approved {
        background: #f0fdf4;
        color: #16a34a;
    }

    .status-draft {
        background: #f1f5f9;
        color: #64748b;
    }

    .document-actions {
        display: flex;
        gap: 12px;
    }
</style>

<!-- サイドバー -->
<aside class="sidebar" id="admin-sidebar">
    <div class="sidebar-header">
        <a href="/customer/dashboard" class="logo-link">
            <img src="/images/logo_144x144.png" alt="ミセサポ" class="logo-img" />
            <span class="logo-text">ミセサポ</span>
        </a>
    </div>

    <nav class="sidebar-nav">
        <a href="/customer/dashboard" class="nav-item" data-page="dashboard">
            <i class="fas fa-th-large"></i>
            <span class="nav-label">ダッシュボード</span>
        </a>
        <a href="/customer/karte" class="nav-item" data-page="karte">
            <i class="fas fa-heartbeat"></i>
            <span class="nav-label">店舗カルテ</span>
        </a>
        <a href="/customer/reports" class="nav-item" data-page="reports">
            <i class="fas fa-file-alt"></i>
            <span class="nav-label">清掃レポート</span>
        </a>
        <a href="/customer/documents" class="nav-item active" data-page="documents">
            <i class="fas fa-file-invoice-dollar"></i>
            <span class="nav-label">見積・契約</span>
        </a>
        <div class="nav-divider"></div>
        <a href="/customer/ai-advisor" class="nav-item nav-item-ai" data-page="ai-advisor">
            <i class="fas fa-robot"></i>
            <span class="nav-label">AIアドバイザー</span>
        </a>
        <div class="nav-divider"></div>
        <a href="/customer/settings" class="nav-item" data-page="settings">
            <i class="fas fa-cog"></i>
            <span class="nav-label">設定</span>
        </a>
        <button class="nav-item nav-item-button" onclick="window.Auth && window.Auth.logout()">
            <i class="fas fa-sign-out-alt"></i>
            <span class="nav-label">ログアウト</span>
        </button>
    </nav>

    <button class="sidebar-toggle" id="sidebar-toggle">
        <i class="fas fa-chevron-left"></i>
    </button>
</aside>

<main id="main" class="container main-content customer-dashboard">
    <header class="dashboard-header">
        <div class="welcome-section">
            <h1 class="welcome-text">見積・契約管理</h1>
            <p class="welcome-subtext">過去の見積書や現在締結中の契約書をこちらで確認・承認いただけます。</p>
        </div>
        <div class="header-actions">
            <button class="btn btn-primary"><i class="fas fa-plus"></i> 新規見積依頼</button>
        </div>
    </header>

    <section class="dashboard-section">
        <div class="section-header">
            <h2 class="section-title"><i class="fas fa-file-invoice"></i> 最新の書類</h2>
        </div>
        <div class="document-list" id="document-list">
            <!-- Loading skeleton -->
            <div class="loading">データを読み込んでいます...</div>
        </div>
    </section>
</main>

<script src="/js/admin-sidebar.js"></script>
<script>
    async function loadDocuments() {
        const list = document.getElementById('document-list');
        try {
            const response = await fetch('/data/estimates.json');
            const data = await response.json();
            const estimates = data.estimates || [];

            list.innerHTML = '';
            estimates.forEach(est => {
                const card = document.createElement('div');
                card.className = 'document-card';
                card.innerHTML = `
                  <div class="document-info">
                      <span class="document-status status-${est.status}">${est.status_label}</span>
                      <h3>${est.store_name} - ${est.services[0].name}${est.services.length > 1 ? ' 外' : ''}</h3>
                      <div class="document-meta">
                          <span>${est.id}</span> · 
                          <span>作成日: ${est.created_date}</span> · 
                          <span>金額: ${est.total}</span>
                      </div>
                  </div>
                  <div class="document-actions">
                      <a href="/sales/estimates/${est.id}.html" class="btn btn-outline btn-sm">詳細を見る</a>
                      ${est.status === 'sent' ? '<button class="btn btn-primary btn-sm">承認する</button>' : ''}
                  </div>
              `;
                list.appendChild(card);
            });
        } catch (e) {
            list.innerHTML = '<p>データの読み込みに失敗しました。</p>';
            console.error(e);
        }
    }
    document.addEventListener('DOMContentLoaded', loadDocuments);
</script>