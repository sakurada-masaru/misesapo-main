@layout('layouts.base')
@json('data/meta/dashboard_title.json', $title)
@json('data/meta/dashboard_body_class.json', $body_class)

<link rel="stylesheet" href="/assets/css/customer-dashboard.css">
<link rel="stylesheet" href="/assets/css/ai-advisor.css">

<!-- サイドバー -->
<aside class="sidebar" id="admin-sidebar">
    <div class="sidebar-header">
        <a href="/customer/dashboard" class="logo-link">
            <img src="/images/logo_144x144.png" alt="ミセサポ" class="logo-img" />
            <span class="logo-text">ミセサポ</span>
        </a>
    </div>

    <nav class="sidebar-nav">
        <a href="/customer/dashboard" class="nav-item" data-page="dashboard">
            <i class="fas fa-th-large"></i>
            <span class="nav-label">ダッシュボード</span>
        </a>
        <a href="/customer/karte" class="nav-item" data-page="karte">
            <i class="fas fa-heartbeat"></i>
            <span class="nav-label">店舗カルテ</span>
        </a>
        <a href="/customer/reports" class="nav-item" data-page="reports">
            <i class="fas fa-file-alt"></i>
            <span class="nav-label">清掃レポート</span>
        </a>
        <div class="nav-divider"></div>
        <a href="/customer/ai-advisor" class="nav-item active nav-item-ai" data-page="ai-advisor">
            <i class="fas fa-robot"></i>
            <span class="nav-label">AIアドバイザー</span>
        </a>
        <div class="nav-divider"></div>
        <a href="/customer/settings" class="nav-item" data-page="settings">
            <i class="fas fa-cog"></i>
            <span class="nav-label">設定</span>
        </a>
        <button class="nav-item nav-item-button" onclick="window.Auth && window.Auth.logout()">
            <i class="fas fa-sign-out-alt"></i>
            <span class="nav-label">ログアウト</span>
        </button>
    </nav>

    <button class="sidebar-toggle" id="sidebar-toggle">
        <i class="fas fa-chevron-left"></i>
    </button>
</aside>

<main id="main" class="ai-advisor-shell main-content">
    <div class="ai-chat-container">
        <header class="chat-header">
            <div class="ai-profile">
                <div class="ai-avatar-small">
                    <i class="fas fa-robot"></i>
                    <span class="online-indicator"></span>
                </div>
                <div class="ai-info">
                    <h2>Gemini AI アドバイザー</h2>
                    <p>Misesapo AIX Engine v1.5 Flash</p>
                </div>
            </div>
            <div class="chat-actions">
                <button class="btn-icon" title="履歴を消去"><i class="fas fa-trash-alt"></i></button>
            </div>
        </header>

        <div class="chat-messages" id="chat-messages">
            <!-- Welcome Message -->
            <div class="message ai-message">
                <div class="message-content">
                    こんにちは！ミセサポAIアドバイザーです。
                    あなたの店舗の清掃データや健康状態（カルテ）に基づき、メンテナンスのアドバイスや改善提案をさせていただきます。
                    <br><br>
                    気になる店舗の状態や、次回の清掃プランについて何か質問はありますか？
                </div>
                <div class="message-time">10:00</div>
            </div>

            <!-- Suggestion Chips -->
            <div class="suggestion-chips">
                <button class="chip">代官山店の現在の清潔度は？</button>
                <button class="chip">次の清掃の提案を詳しく</button>
                <button class="chip">空調掃除のコストを抑えたい</button>
            </div>
        </div>

        <footer class="chat-input-area">
            <div class="input-wrapper">
                <textarea id="user-input" placeholder="AIにメッセージを送る..." rows="1"></textarea>
                <button id="send-btn" class="send-button">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
            <p class="input-note">AIは状況を分析して提案を行いますが、最終的な判断は担当スタッフにご相談ください。</p>
        </footer>
    </div>

    <aside class="ai-context-panel">
        <div class="context-card">
            <h3>分析対象のデータ</h3>
            <div class="context-item">
                <i class="fas fa-file-medical"></i>
                <span>最新の店舗カルテ (3件)</span>
            </div>
            <div class="context-item">
                <i class="fas fa-file-alt"></i>
                <span>直近の清掃レポート (12月分)</span>
            </div>
            <div class="context-item">
                <i class="fas fa-history"></i>
                <span>過去12ヶ月のメンテナンス履歴</span>
            </div>
        </div>

        <div class="context-card promo-card">
            <h3>AI 予測メンテ</h3>
            <p>レンジフードの汚れが限界値に近づいています。1月中の清掃で、故障リスクを25%軽減できます。</p>
            <a href="/customer/karte" class="btn btn-outline btn-xs">カルテで詳細を見る</a>
        </div>
    </aside>
</main>

<script src="/js/admin-sidebar.js"></script>
<script src="/assets/js/ai-advisor.js"></script>