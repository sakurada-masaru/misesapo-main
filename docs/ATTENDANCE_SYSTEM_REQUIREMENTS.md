# 出退勤システムの要件とベストプラクティス

## 📋 一般的な出退勤システムの仕様

### 1. 確認ダイアログ

#### 出勤時
- **確認メッセージ**: 「出勤を記録しますか？」
- **表示内容**:
  - 現在時刻
  - 出勤予定時刻（設定されている場合）
  - 遅刻警告（出勤予定時刻を過ぎている場合）
- **ボタン**: 「出勤する」「キャンセル」

#### 退勤時
- **確認メッセージ**: 「退勤を記録しますか？」
- **表示内容**:
  - 出勤時刻
  - 現在時刻
  - 勤務時間（自動計算）
  - 早退警告（所定労働時間に満たない場合）
- **ボタン**: 「退勤する」「キャンセル」

### 2. 1日1回制限

#### 一般的な仕様
- **出勤**: 1日1回のみ記録可能
- **退勤**: 出勤記録がある場合のみ記録可能（1日1回）
- **再出勤**: 退勤後に再出勤する場合は、別の記録として扱う（2回目以降の出勤）

#### 誤操作防止
- **確認ダイアログ**: 必ず表示
- **二重記録防止**: 既に出退勤済みの場合、警告を表示
- **時刻の表示**: 記録前に現在時刻を表示
- **取り消し機能**: 記録後、一定時間内（例：5分）は取り消し可能

### 3. 一般的なシステムの機能

#### 必須機能
1. **出退勤記録**
   - 出勤時刻の記録
   - 退勤時刻の記録
   - 時刻の自動記録（手動入力不可）

2. **確認機能**
   - 出退勤時の確認ダイアログ
   - 時刻の表示
   - 勤務時間の表示（退勤時）

3. **誤操作防止**
   - 1日1回制限
   - 確認ダイアログ
   - 時刻の表示

4. **履歴管理**
   - 出退勤履歴の表示
   - 月次集計
   - 勤務時間の自動計算

#### 推奨機能
1. **通知機能**
   - 出退勤記録の通知
   - 遅刻・早退の警告

2. **修正機能**
   - 管理者による修正
   - 申請・承認フロー

3. **位置情報**
   - GPS位置情報の記録
   - 出退勤場所の記録

4. **写真撮影**
   - 出退勤時の写真撮影
   - 本人確認

## 🎯 本システムの要件

### 必須要件

#### 1. 確認ダイアログ
- **出勤時**:
  - 「出勤を記録しますか？」の確認
  - 現在時刻の表示
  - 「出勤する」「キャンセル」ボタン

- **退勤時**:
  - 「退勤を記録しますか？」の確認
  - 出勤時刻の表示
  - 現在時刻の表示
  - 勤務時間の表示（自動計算）
  - 「退勤する」「キャンセル」ボタン

#### 2. 1日1回制限
- **出勤**: 1日1回のみ記録可能
  - 既に出勤済みの場合、警告を表示
  - 退勤後に再出勤する場合は別記録として扱う

- **退勤**: 出勤記録がある場合のみ記録可能（1日1回）
  - 既に退勤済みの場合、警告を表示

#### 3. 誤操作防止
- **確認ダイアログ**: 必ず表示
- **時刻の表示**: 記録前に現在時刻を表示
- **状態の確認**: 既に出退勤済みの場合、警告を表示

### 推奨要件（将来的に実装）

#### 1. 取り消し機能
- 記録後、一定時間内（例：5分）は取り消し可能
- 管理者による修正機能

#### 2. 通知機能
- 出退勤記録の通知
- 遅刻・早退の警告

#### 3. 位置情報
- GPS位置情報の記録
- 出退勤場所の記録

## 🔒 セキュリティ要件

### 1. データ整合性
- **時刻の自動記録**: 手動入力不可
- **サーバー時刻の使用**: クライアント時刻の改ざん防止
- **二重記録防止**: 既に記録済みの場合、警告を表示

### 2. 認証・認可
- **ログイン必須**: 出退勤記録にはログインが必要
- **本人確認**: ログインユーザーのみ記録可能

### 3. 監査ログ
- **記録履歴**: すべての出退勤記録を保存
- **変更履歴**: 修正・削除の履歴を保存

## 📊 データ構造

### 出退勤記録（Attendance Record）

```json
{
  "id": "2025-01-15_W00001",
  "staff_id": "W00001",
  "staff_name": "山田太郎",
  "date": "2025-01-15",
  "clock_in": "2025-01-15T09:00:00Z",
  "clock_out": "2025-01-15T18:00:00Z",
  "work_hours": 8.0,
  "status": "completed",
  "created_at": "2025-01-15T09:00:00Z",
  "updated_at": "2025-01-15T18:00:00Z"
}
```

### 状態管理

- **未出勤**: `clock_in` が null
- **出勤中**: `clock_in` が存在し、`clock_out` が null
- **退勤済み**: `clock_in` と `clock_out` が存在

## 🎨 UI/UX要件

### 1. 確認ダイアログのデザイン

#### 出勤時
```
┌─────────────────────────────────┐
│  出勤を記録しますか？           │
├─────────────────────────────────┤
│  現在時刻: 2025-01-15 09:00     │
│                                  │
│  [出勤する]  [キャンセル]       │
└─────────────────────────────────┘
```

#### 退勤時
```
┌─────────────────────────────────┐
│  退勤を記録しますか？           │
├─────────────────────────────────┤
│  出勤時刻: 2025-01-15 09:00     │
│  現在時刻: 2025-01-15 18:00     │
│  勤務時間: 9時間0分             │
│                                  │
│  [退勤する]  [キャンセル]       │
└─────────────────────────────────┘
```

### 2. エラーメッセージ

#### 既に出勤済み
```
既に出勤記録があります。
出勤時刻: 2025-01-15 09:00
```

#### 既に退勤済み
```
既に退勤記録があります。
退勤時刻: 2025-01-15 18:00
```

#### 出勤記録なしで退勤しようとした場合
```
出勤記録がありません。
先に出勤を記録してください。
```

## 🚀 実装チェックリスト

### Phase 1: 基本機能（必須）
- [x] 出退勤記録機能
- [ ] 出勤時の確認ダイアログ
- [ ] 退勤時の確認ダイアログ
- [ ] 1日1回制限（出勤）
- [ ] 1日1回制限（退勤）
- [ ] 既に出退勤済みの場合の警告

### Phase 2: UX改善
- [ ] 時刻の表示
- [ ] 勤務時間の表示（退勤時）
- [ ] エラーメッセージの改善

### Phase 3: 高度な機能（将来的に実装）
- [ ] 取り消し機能
- [ ] 通知機能
- [ ] 位置情報
- [ ] 写真撮影

## 📝 参考資料

### 一般的な勤怠管理システム
1. **ジョブカン**
   - 出退勤時の確認ダイアログ
   - 1日1回制限
   - 時刻の表示

2. **キングオブタイム**
   - 出退勤時の確認ダイアログ
   - 勤務時間の表示
   - 誤操作防止機能

3. **SmartHR**
   - 出退勤時の確認ダイアログ
   - 位置情報の記録
   - 写真撮影機能

### ベストプラクティス
1. **確認ダイアログは必須**
   - 誤操作を防ぐため、必ず確認ダイアログを表示

2. **時刻の表示**
   - 記録前に現在時刻を表示
   - ユーザーが確認できるようにする

3. **1日1回制限**
   - 出退勤は1日1回のみ記録可能
   - 誤操作を防ぐため

4. **状態の確認**
   - 既に出退勤済みの場合、警告を表示
   - 現在の状態を明確に表示

