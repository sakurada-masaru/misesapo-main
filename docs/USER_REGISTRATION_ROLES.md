# ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã¨ãƒ­ãƒ¼ãƒ«ç®¡ç†

## ğŸ“‹ æ¦‚è¦

ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã¯ã€ãƒ­ãƒ¼ãƒ«ã«ã‚ˆã£ã¦ç•°ãªã‚‹æ–¹æ³•ã§è¡Œã‚ã‚Œã¾ã™ã€‚

---

## ğŸ¯ ãƒ­ãƒ¼ãƒ«åˆ¥ã®ç™»éŒ²æ–¹æ³•

### 1. ãŠå®¢ã•ã‚“ï¼ˆcustomerï¼‰ã®ç™»éŒ²

**ç™»éŒ²æ–¹æ³•**: ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªåˆ†ã§ç™»éŒ²

**ç™»éŒ²ãƒšãƒ¼ã‚¸**: `/signup.html`

**ç™»éŒ²ãƒ•ãƒ­ãƒ¼**:
1. `/signup.html`ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›
3. Firebase Authenticationã§ç™»éŒ²
4. è‡ªå‹•çš„ã«`customer`ãƒ­ãƒ¼ãƒ«ã§ç™»éŒ²ã•ã‚Œã‚‹
5. ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

**æ³¨æ„äº‹é …**:
- `/signup.html`ã¯ãŠå®¢ã•ã‚“ï¼ˆcustomerï¼‰å°‚ç”¨ã®ç™»éŒ²ãƒšãƒ¼ã‚¸ã§ã™
- ç™»éŒ²ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªå‹•çš„ã«`customer`ãƒ­ãƒ¼ãƒ«ã«ãªã‚Šã¾ã™
- ä»–ã®ãƒ­ãƒ¼ãƒ«ï¼ˆstaff, concierge, adminãªã©ï¼‰ã¯ç™»éŒ²ã§ãã¾ã›ã‚“

---

### 2. æ¸…æƒå“¡ï¼ˆstaffï¼‰ã®ç™»éŒ²

**ç™»éŒ²æ–¹æ³•**: ç®¡ç†è€…ãŒç™»éŒ²

**ç™»éŒ²ãƒšãƒ¼ã‚¸**: `/admin/users/staff/new.html`ï¼ˆæœªå®Ÿè£…ï¼‰

**ç™»éŒ²ãƒ•ãƒ­ãƒ¼**:
1. ç®¡ç†è€…ãŒ`/admin/users/staff/new.html`ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨åˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®š
3. Firebase Authenticationã§ç™»éŒ²
4. Cloud Functionsã§`staff`ãƒ­ãƒ¼ãƒ«ã‚’è¨­å®šï¼ˆCustom Claimsï¼‰
5. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’é€šçŸ¥

**å®Ÿè£…çŠ¶æ³**: æœªå®Ÿè£…ï¼ˆä»Šå¾Œå®Ÿè£…äºˆå®šï¼‰

---

### 3. ã‚³ãƒ³ã‚·ã‚§ãƒ«ã‚¸ãƒ¥ï¼ˆconciergeï¼‰ã®ç™»éŒ²

**ç™»éŒ²æ–¹æ³•**: ç®¡ç†è€…ãŒç™»éŒ²

**ç™»éŒ²ãƒšãƒ¼ã‚¸**: `/admin/users/sales/new.html`ï¼ˆæœªå®Ÿè£…ï¼‰

**ç™»éŒ²ãƒ•ãƒ­ãƒ¼**:
1. ç®¡ç†è€…ãŒ`/admin/users/sales/new.html`ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨åˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®š
3. Firebase Authenticationã§ç™»éŒ²
4. Cloud Functionsã§`concierge`ãƒ­ãƒ¼ãƒ«ã‚’è¨­å®šï¼ˆCustom Claimsï¼‰
5. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’é€šçŸ¥

**å®Ÿè£…çŠ¶æ³**: æœªå®Ÿè£…ï¼ˆä»Šå¾Œå®Ÿè£…äºˆå®šï¼‰

---

### 4. ç®¡ç†è€…ï¼ˆadminï¼‰ã®ç™»éŒ²

**ç™»éŒ²æ–¹æ³•**: ãƒã‚¹ã‚¿ãƒ¼ã¾ãŸã¯æ—¢å­˜ç®¡ç†è€…ãŒç™»éŒ²

**ç™»éŒ²ãƒšãƒ¼ã‚¸**: `/admin/users/admins/new.html`ï¼ˆæœªå®Ÿè£…ï¼‰

**ç™»éŒ²ãƒ•ãƒ­ãƒ¼**:
1. ãƒã‚¹ã‚¿ãƒ¼ã¾ãŸã¯æ—¢å­˜ç®¡ç†è€…ãŒ`/admin/users/admins/new.html`ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨åˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®š
3. Firebase Authenticationã§ç™»éŒ²
4. Cloud Functionsã§`admin`ãƒ­ãƒ¼ãƒ«ã‚’è¨­å®šï¼ˆCustom Claimsï¼‰
5. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’é€šçŸ¥

**å®Ÿè£…çŠ¶æ³**: æœªå®Ÿè£…ï¼ˆä»Šå¾Œå®Ÿè£…äºˆå®šï¼‰

---

### 5. é–‹ç™ºè€…ï¼ˆdeveloperï¼‰ã®ç™»éŒ²

**ç™»éŒ²æ–¹æ³•**: ãƒã‚¹ã‚¿ãƒ¼ãŒç™»éŒ²

**ç™»éŒ²ãƒšãƒ¼ã‚¸**: `/admin/users/developers/new.html`ï¼ˆæœªå®Ÿè£…ï¼‰

**ç™»éŒ²ãƒ•ãƒ­ãƒ¼**:
1. ãƒã‚¹ã‚¿ãƒ¼ãŒ`/admin/users/developers/new.html`ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨åˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®š
3. Firebase Authenticationã§ç™»éŒ²
4. Cloud Functionsã§`developer`ãƒ­ãƒ¼ãƒ«ã‚’è¨­å®šï¼ˆCustom Claimsï¼‰
5. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’é€šçŸ¥

**å®Ÿè£…çŠ¶æ³**: æœªå®Ÿè£…ï¼ˆä»Šå¾Œå®Ÿè£…äºˆå®šï¼‰

---

### 6. ãƒã‚¹ã‚¿ãƒ¼ï¼ˆmasterï¼‰ã®ç™»éŒ²

**ç™»éŒ²æ–¹æ³•**: æ—¢å­˜ãƒã‚¹ã‚¿ãƒ¼ãŒç™»éŒ²ï¼ˆæ‰‹å‹•ã¾ãŸã¯åˆæœŸè¨­å®šï¼‰

**ç™»éŒ²ãƒ•ãƒ­ãƒ¼**:
1. æ—¢å­˜ãƒã‚¹ã‚¿ãƒ¼ãŒFirebase Consoleã‹ã‚‰æ‰‹å‹•ã§ç™»éŒ²
2. Cloud Functionsã§`master`ãƒ­ãƒ¼ãƒ«ã‚’è¨­å®šï¼ˆCustom Claimsï¼‰
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’é€šçŸ¥

**å®Ÿè£…çŠ¶æ³**: æ‰‹å‹•ã§å®Ÿè£…ï¼ˆFirebase Consoleã‹ã‚‰ï¼‰

---

## ğŸ”’ ãƒ­ãƒ¼ãƒ«ç®¡ç†ï¼ˆCustom Claimsï¼‰

### ç¾çŠ¶

ç¾åœ¨ã€Firebase Authenticationã§ç™»éŒ²ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§`customer`ãƒ­ãƒ¼ãƒ«ã«ãªã‚Šã¾ã™ã€‚

### å°†æ¥çš„ãªå®Ÿè£…

ä»–ã®ãƒ­ãƒ¼ãƒ«ï¼ˆstaff, concierge, adminãªã©ï¼‰ã‚’è¨­å®šã™ã‚‹ã«ã¯ã€Firebase Cloud Functionsã‚’ä½¿ç”¨ã—ã¦Custom Claimsã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

**å®Ÿè£…ä¾‹**:
```javascript
// functions/index.js
const functions = require('firebase-functions');
const admin = require('firebase-admin');
admin.initializeApp();

exports.setUserRole = functions.https.onCall(async (data, context) => {
  // ç®¡ç†è€…ã®ã¿ãŒå®Ÿè¡Œå¯èƒ½
  if (!context.auth || !context.auth.token.admin) {
    throw new functions.https.HttpsError('permission-denied', 'ç®¡ç†è€…æ¨©é™ãŒå¿…è¦ã§ã™');
  }
  
  const { uid, role } = data;
  
  // Custom Claimsã§ãƒ­ãƒ¼ãƒ«ã‚’è¨­å®š
  await admin.auth().setCustomUserClaims(uid, { role: role });
  
  return { success: true };
});
```

---

## ğŸ“ ã¾ã¨ã‚

### ç¾åœ¨å®Ÿè£…æ¸ˆã¿

- âœ… `/signup.html`: ãŠå®¢ã•ã‚“ï¼ˆcustomerï¼‰å°‚ç”¨ã®ç™»éŒ²ãƒšãƒ¼ã‚¸
- âœ… Firebase Authenticationã§ã®ç™»éŒ²
- âœ… è‡ªå‹•çš„ã«`customer`ãƒ­ãƒ¼ãƒ«ã§ç™»éŒ²

### ä»Šå¾Œå®Ÿè£…äºˆå®š

- â³ `/admin/users/staff/new.html`: æ¸…æƒå“¡ã®ç™»éŒ²ãƒšãƒ¼ã‚¸
- â³ `/admin/users/sales/new.html`: ã‚³ãƒ³ã‚·ã‚§ãƒ«ã‚¸ãƒ¥ã®ç™»éŒ²ãƒšãƒ¼ã‚¸
- â³ `/admin/users/admins/new.html`: ç®¡ç†è€…ã®ç™»éŒ²ãƒšãƒ¼ã‚¸
- â³ `/admin/users/developers/new.html`: é–‹ç™ºè€…ã®ç™»éŒ²ãƒšãƒ¼ã‚¸
- â³ Cloud Functions: Custom Claimsã§ãƒ­ãƒ¼ãƒ«ã‚’è¨­å®š

---

## âš ï¸ æ³¨æ„äº‹é …

1. **`/signup.html`ã¯ãŠå®¢ã•ã‚“å°‚ç”¨**
   - ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªåˆ†ã§ç™»éŒ²ã™ã‚‹ãƒšãƒ¼ã‚¸
   - ç™»éŒ²ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªå‹•çš„ã«`customer`ãƒ­ãƒ¼ãƒ«ã«ãªã‚Šã¾ã™
   - ä»–ã®ãƒ­ãƒ¼ãƒ«ã¯ç™»éŒ²ã§ãã¾ã›ã‚“

2. **ä»–ã®ãƒ­ãƒ¼ãƒ«ã®ç™»éŒ²**
   - ç®¡ç†è€…ãŒç™»éŒ²ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
   - ç¾åœ¨ã¯æœªå®Ÿè£…ã§ã™ï¼ˆä»Šå¾Œå®Ÿè£…äºˆå®šï¼‰

3. **ãƒ­ãƒ¼ãƒ«ã®è¨­å®š**
   - ç¾åœ¨ã¯ã€Firebase Authenticationã§ç™»éŒ²ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯`customer`ãƒ­ãƒ¼ãƒ«ã«ãªã‚Šã¾ã™
   - ä»–ã®ãƒ­ãƒ¼ãƒ«ã‚’è¨­å®šã™ã‚‹ã«ã¯ã€Cloud Functionsã§Custom Claimsã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™

