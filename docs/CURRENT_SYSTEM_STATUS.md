# ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ é‹è¡ŒçŠ¶æ³ã®ç¢ºèª

## ğŸ“Š ç¾åœ¨ã®æ§‹æˆ

### èªè¨¼ã‚·ã‚¹ãƒ†ãƒ 
- **Firebase Authentication**: å®Ÿè£…æ¸ˆã¿
  - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ + ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³
  - Custom Claimsã§ãƒ­ãƒ¼ãƒ«ç®¡ç†
  - ãƒ­ãƒ¼ãƒ«IDï¼ˆCustom Claimsï¼‰ã§ãƒ­ã‚°ã‚¤ãƒ³å¯èƒ½

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ç®¡ç†
- **DynamoDB `workers`ãƒ†ãƒ¼ãƒ–ãƒ«**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
- **Firebase UID**: èªè¨¼ç”¨ã®ID
- **DynamoDB ID**: ãƒ‡ãƒ¼ã‚¿ç®¡ç†ç”¨ã®IDï¼ˆW001å½¢å¼ãªã©ï¼‰

## ğŸ” ã‚·ã‚¹ãƒ†ãƒ é‹è¡Œä¸Šã®ç¢ºèªäº‹é …

### 1. èªè¨¼ãƒ•ãƒ­ãƒ¼

**ç¾åœ¨ã®ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼**:
1. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ + ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§Firebase Authenticationã«ãƒ­ã‚°ã‚¤ãƒ³
2. Firebase Custom Claimsã‹ã‚‰ãƒ­ãƒ¼ãƒ«ã‚’å–å¾—
3. ãƒ­ãƒ¼ãƒ«ã«å¿œã˜ã¦ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

**ãƒ­ãƒ¼ãƒ«å–å¾—ã®å„ªå…ˆé †ä½**:
1. Firebase Custom Claimsï¼ˆæœ€å„ªå…ˆï¼‰
2. `users.js`ã‹ã‚‰ã®å–å¾—ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰

### 2. ãƒ‡ãƒ¼ã‚¿ã®é€£æº

**å•é¡Œç‚¹**:
- Firebase UIDã¨DynamoDBã®IDãŒåˆ¥ã€…ã«ç®¡ç†ã•ã‚Œã¦ã„ã‚‹
- Firebase UIDã¨DynamoDBã®workersãƒ†ãƒ¼ãƒ–ãƒ«ã®IDãŒç´ä»˜ã„ã¦ã„ãªã„å¯èƒ½æ€§

**ç¾åœ¨ã®çŠ¶æ…‹**:
- èªè¨¼: Firebase Authenticationï¼ˆFirebase UIDï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿: DynamoDB workersãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆã‚«ã‚¹ã‚¿ãƒ IDï¼‰

### 3. Lambdaé–¢æ•°ã§ã®èªè¨¼æ¤œè¨¼

**ç¾çŠ¶**:
```python
def verify_firebase_token(id_token):
    # TODO: Firebase Admin SDKã‚’ä½¿ç”¨ã—ãŸæ¤œè¨¼ã‚’å®Ÿè£…
    # ç¾çŠ¶ã¯ç°¡æ˜“çš„ã«ãƒˆãƒ¼ã‚¯ãƒ³ã®å­˜åœ¨ã®ã¿ã‚’ãƒã‚§ãƒƒã‚¯
    return {
        'verified': True,
        'uid': 'admin-uid',  # å®Ÿéš›ã«ã¯ãƒˆãƒ¼ã‚¯ãƒ³ã‹ã‚‰å–å¾—
        'email': 'admin@example.com',
        'role': 'admin'  # å®Ÿéš›ã«ã¯Custom Claimsã‹ã‚‰å–å¾—
    }
```

**å•é¡Œç‚¹**:
- Firebase Admin SDKã‚’ä½¿ç”¨ã—ãŸå®Ÿéš›ã®ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ãŒæœªå®Ÿè£…
- ç°¡æ˜“çš„ãªæ¤œè¨¼ã®ã¿ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®ãƒªã‚¹ã‚¯ï¼‰

## âœ… ã‚·ã‚¹ãƒ†ãƒ é‹è¡Œä¸Šã®å•é¡Œç‚¹

### 1. èªè¨¼ã¨ãƒ‡ãƒ¼ã‚¿ã®åˆ†é›¢

**ç¾çŠ¶**:
- Firebase Authentication: èªè¨¼ã®ã¿
- DynamoDB: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®ã¿
- ä¸¡è€…ã®ç´ä»˜ã‘ãŒä¸æ˜ç¢º

**å½±éŸ¿**:
- Firebase UIDã¨DynamoDB IDã®å¯¾å¿œé–¢ä¿‚ãŒä¸æ˜
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®æ›´æ–°æ™‚ã«åŒæœŸãŒå¿…è¦

### 2. Lambdaé–¢æ•°ã§ã®èªè¨¼æ¤œè¨¼

**ç¾çŠ¶**:
- ç°¡æ˜“çš„ãªãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ã®ã¿
- å®Ÿéš›ã®Firebase Admin SDKã‚’ä½¿ç”¨ã—ãŸæ¤œè¨¼ãŒæœªå®Ÿè£…

**å½±éŸ¿**:
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®ãƒªã‚¹ã‚¯
- å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒå–å¾—ã§ããªã„

### 3. ãƒ­ãƒ¼ãƒ«ç®¡ç†

**ç¾çŠ¶**:
- Firebase Custom Claimsã§ãƒ­ãƒ¼ãƒ«ç®¡ç†
- DynamoDBã«ã‚‚roleãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå­˜åœ¨

**å½±éŸ¿**:
- ãƒ­ãƒ¼ãƒ«æƒ…å ±ãŒ2ç®‡æ‰€ã«å­˜åœ¨ï¼ˆåŒæœŸãŒå¿…è¦ï¼‰

## ğŸ’¡ æ¨å¥¨ã•ã‚Œã‚‹æ”¹å–„ç­–

### 1. Firebase UIDã¨DynamoDB IDã®ç´ä»˜ã‘

**æ–¹æ³•1: DynamoDBã«Firebase UIDã‚’ä¿å­˜**
```python
worker_data = {
    'id': worker_id,  # DynamoDBç”¨ã®ID
    'firebase_uid': firebase_uid,  # Firebase UIDã‚’è¿½åŠ 
    'email': email,
    'name': name,
    # ...
}
```

**æ–¹æ³•2: Firebase UIDã‚’DynamoDBã®IDã¨ã—ã¦ä½¿ç”¨**
```python
worker_data = {
    'id': firebase_uid,  # Firebase UIDã‚’ãã®ã¾ã¾ä½¿ç”¨
    'email': email,
    'name': name,
    # ...
}
```

### 2. Lambdaé–¢æ•°ã§ã®èªè¨¼æ¤œè¨¼ã®å®Ÿè£…

**Firebase Admin SDKã‚’ä½¿ç”¨ã—ãŸæ¤œè¨¼**:
```python
import firebase_admin
from firebase_admin import auth

def verify_firebase_token(id_token):
    try:
        decoded_token = auth.verify_id_token(id_token)
        return {
            'verified': True,
            'uid': decoded_token['uid'],
            'email': decoded_token.get('email'),
            'role': decoded_token.get('role', 'customer')
        }
    except Exception as e:
        return {'verified': False, 'error': str(e)}
```

### 3. ãƒ­ãƒ¼ãƒ«ç®¡ç†ã®ä¸€å…ƒåŒ–

**æ¨å¥¨**:
- Firebase Custom Claimsã‚’ä¸»è¦ãªãƒ­ãƒ¼ãƒ«ç®¡ç†ã¨ã—ã¦ä½¿ç”¨
- DynamoDBã®roleãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯å‚ç…§ç”¨ã¨ã—ã¦ä½¿ç”¨

## ğŸ¯ çµè«–

### ã‚·ã‚¹ãƒ†ãƒ é‹è¡Œä¸Šã®å•é¡Œ

1. **èªè¨¼ã¨ãƒ‡ãƒ¼ã‚¿ã®åˆ†é›¢**: Firebase UIDã¨DynamoDB IDã®ç´ä»˜ã‘ãŒä¸æ˜ç¢º
2. **Lambdaé–¢æ•°ã§ã®èªè¨¼æ¤œè¨¼**: ç°¡æ˜“çš„ãªæ¤œè¨¼ã®ã¿ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®ãƒªã‚¹ã‚¯ï¼‰
3. **ãƒ­ãƒ¼ãƒ«ç®¡ç†**: 2ç®‡æ‰€ã«å­˜åœ¨ï¼ˆåŒæœŸãŒå¿…è¦ï¼‰

### ç¾çŠ¶ã§ã®é‹ç”¨å¯èƒ½æ€§

**å•é¡Œãªãé‹ç”¨å¯èƒ½**:
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã®èªè¨¼ã¯æ­£å¸¸ã«å‹•ä½œ
- ãƒ­ãƒ¼ãƒ«IDã§ã®ãƒ­ã‚°ã‚¤ãƒ³ã‚‚å¯èƒ½
- åŸºæœ¬çš„ãªæ©Ÿèƒ½ã¯å‹•ä½œã—ã¦ã„ã‚‹

**æ”¹å–„ãŒå¿…è¦**:
- Lambdaé–¢æ•°ã§ã®èªè¨¼æ¤œè¨¼ã®å®Ÿè£…
- Firebase UIDã¨DynamoDB IDã®ç´ä»˜ã‘
- ãƒ­ãƒ¼ãƒ«ç®¡ç†ã®ä¸€å…ƒåŒ–

### æ¨å¥¨ã•ã‚Œã‚‹å¯¾å¿œ

1. **çŸ­æœŸ**: Lambdaé–¢æ•°ã§ã®Firebase Admin SDKã‚’ä½¿ç”¨ã—ãŸèªè¨¼æ¤œè¨¼ã‚’å®Ÿè£…
2. **ä¸­æœŸ**: Firebase UIDã¨DynamoDB IDã®ç´ä»˜ã‘ã‚’å®Ÿè£…
3. **é•·æœŸ**: Firestoreã¸ã®ç§»è¡Œã‚’æ¤œè¨ï¼ˆèªè¨¼ã¨ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã®çµ±åˆï¼‰

