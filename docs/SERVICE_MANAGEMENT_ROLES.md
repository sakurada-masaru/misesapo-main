# サービス管理機能 - 役割別・権限別整理

## 📋 概要

サービス管理機能は、**事務員の方**と**技術者（開発者）**で役割が分かれています。

---

## 👩‍💼 事務員の方の権限とできること

### ✅ アクセス可能なページ

1. **サービス一覧ページ** (`/admin/services.html`)
   - すべてのサービスを一覧表示
   - 検索・フィルタ機能
   - 各サービスの詳細・編集ページへのリンク

2. **新規サービス登録ページ** (`/admin/services/new.html`)
   - 新しいサービスを追加
   - フォーム入力でサービス情報を登録

3. **サービス詳細ページ** (`/admin/services/{id}.html`)
   - 各サービスの詳細情報を表示
   - 編集ページへのリンク

4. **サービス編集ページ** (`/admin/services/{id}/edit.html`)
   - 既存サービスの情報を編集
   - フォームでサービス情報を更新

### ✅ できる操作

#### 1. サービスの新規作成
- **ページ**: `/admin/services/new.html`
- **操作**:
  1. 「新規サービス登録」ボタンをクリック
  2. フォームに情報を入力
     - サービス名（必須）
     - カテゴリ（必須）
     - 価格（必須）
     - サービス画像URL
     - 詳細画像URL
     - 説明
     - 問題点（複数行）
     - 解決方法
  3. 「登録する」ボタンをクリック
  4. 自動的にローカルに保存され、ページが生成される

#### 2. サービスの編集
- **ページ**: `/admin/services/{id}/edit.html`
- **操作**:
  1. サービス一覧から「編集」ボタンをクリック
  2. フォームで情報を修正
  3. 「保存する」ボタンをクリック
  4. 自動的にローカルに保存され、ページが更新される

#### 3. サービスの削除
- **ページ**: `/admin/services.html`（各サービスカード）
- **操作**:
  1. サービスカードの「削除」ボタンをクリック
  2. 確認ダイアログで「OK」をクリック
  3. 自動的にローカルから削除される

#### 4. 変更内容の確認
- **ページ**: `/admin/services.html`
- **表示内容**:
  - 未反映の変更がある場合、ページ上部にアラートが表示される
  - 変更されたサービス一覧が表示される
  - 各サービスの変更タイプ（新規作成/編集）とタイムスタンプが表示される

### ❌ できない操作

- **Git操作は一切できません**
  - GitHubから最新データを取得
  - ローカルの変更を破棄
  - Gitにコミット・プッシュ
- **開発者専用レビューページへのアクセス**
  - パスワード保護されているため、アクセス不可

### 📝 注意事項

- 編集・作成した内容は**ローカルのみ**に保存されます
- GitHub Pagesに反映するには、**技術者に依頼**する必要があります
- 未反映の変更がある場合、ページ上部にアラートが表示されます

---

## 👨‍💻 技術者（開発者）の権限とできること

### ✅ アクセス可能なページ

1. **すべての事務員向けページ**（上記と同じ）
   - サービス一覧ページ
   - 新規サービス登録ページ
   - サービス詳細ページ
   - サービス編集ページ

2. **開発者専用レビューページ** (`/admin/services/review.html`)
   - **パスワード保護**: `misesapo1234`
   - **セッション管理**: 8時間有効
   - 変更内容の一括確認
   - Git操作の実行

### ✅ できる操作

#### 1. サービスの編集・作成（事務員と同じ）
- 事務員の方と同じように、サービスを編集・作成できます
- ブラウザ上で直感的に操作可能

#### 2. 変更内容の一括確認
- **ページ**: `/admin/services/review.html`
- **操作**:
  1. パスワード `misesapo1234` を入力
  2. 認証後、変更内容が一括表示される
  3. 変更されたサービス一覧を確認
  4. 各サービスの変更タイプ（新規作成/編集）とタイムスタンプを確認

#### 3. GitHubから最新データを取得
- **ページ**: `/admin/services/review.html`
- **操作**:
  1. 「GitHubから最新データを取得」ボタンをクリック
  2. 確認ダイアログで「OK」をクリック
  3. `git pull origin main` が実行される
  4. 自動的にビルドが実行される
  5. ページが再読み込みされる

#### 4. ローカルの変更を破棄
- **ページ**: `/admin/services/review.html`
- **操作**:
  1. 「ローカルの変更を破棄」ボタンをクリック
  2. 2回の確認ダイアログで「OK」をクリック
  3. `git restore` で変更が破棄される
  4. 未追跡ファイル（新規ページ）も削除される
  5. 自動的にビルドが実行される
  6. ページが再読み込みされる

#### 5. Gitにコミット・プッシュ
- **ページ**: `/admin/services/review.html`
- **操作**:
  1. 「Gitにコミット・プッシュ」ボタンをクリック
  2. 確認ダイアログで「OK」をクリック
  3. 自動的に以下が実行される:
     - `git add src/data/service_items.json public/`
     - `git commit -m "chore: サービス管理の更新"`
     - `git push origin main`
  4. 数分後にGitHub Pagesに反映される
  5. ページが再読み込みされる

### 📝 注意事項

- レビューページはパスワード保護されています
- セッションは8時間有効です（再認証不要）
- Git操作はすべてブラウザ上で実行できます
- ターミナルを使う必要はありません

---

## 🔄 作業フロー

### パターン1: 事務員が編集 → 技術者が確認・プッシュ

1. **事務員の方**:
   - `/admin/services.html` でサービスを編集・新規追加
   - 未反映の変更が表示されることを確認

2. **技術者**:
   - `/admin/services/review.html` にアクセス
   - パスワード `misesapo1234` を入力
   - 変更内容を確認
   - 問題なければ「Gitにコミット・プッシュ」をクリック
   - 数分後にGitHub Pagesに反映される

### パターン2: 技術者が直接編集・プッシュ

1. **技術者**:
   - `/admin/services.html` でサービスを編集・新規追加
   - `/admin/services/review.html` で変更内容を確認
   - 「Gitにコミット・プッシュ」をクリック

### パターン3: 競合が発生した場合

1. **技術者**:
   - `/admin/services/review.html` で「GitHubから最新データを取得」をクリック
   - ローカルの変更とリモートの変更を確認
   - 必要に応じて「ローカルの変更を破棄」で破棄
   - または、手動で競合を解決してからプッシュ

---

## 🔐 セキュリティ

### 権限分離

- **事務員の方**: 編集のみ可能、Git操作は不可
- **技術者**: 編集 + Git操作が可能

### 認証

- 開発者専用レビューページはパスワード保護
- セッション管理（8時間有効）
- パスワード: `misesapo1234`

### データ保護

- すべての変更はローカルに保存される
- Git操作は技術者のみが実行可能
- 誤操作を防ぐため、確認ダイアログを表示

---

## 📊 APIエンドポイント

### 事務員の方も技術者も使用可能

- `GET /api/services` - サービス一覧取得
- `POST /api/services` - 新規サービス作成
- `PUT /api/services/{id}` - サービス更新
- `DELETE /api/services/{id}` - サービス削除
- `GET /api/pending-changes` - 未反映の変更確認

### 技術者のみ使用可能

- `POST /api/pull` - GitHubから最新データを取得
- `POST /api/discard-changes` - ローカルの変更を破棄
- `POST /api/commit-and-push` - Gitにコミット・プッシュ

---

## 🎯 まとめ

| 機能 | 事務員の方 | 技術者 |
|------|-----------|--------|
| サービス一覧表示 | ✅ | ✅ |
| サービス新規作成 | ✅ | ✅ |
| サービス編集 | ✅ | ✅ |
| サービス削除 | ✅ | ✅ |
| 変更内容確認 | ✅（表示のみ） | ✅（一括表示） |
| GitHubから取得 | ❌ | ✅ |
| 変更を破棄 | ❌ | ✅ |
| Gitにプッシュ | ❌ | ✅ |
| レビューページアクセス | ❌ | ✅ |

---

## 📝 補足

- すべての操作はブラウザ上で実行可能
- ターミナルを使う必要はありません
- 変更は自動的にビルドされます
- GitHub Pagesへの反映は数分かかります

