# 次のステップ

## 📋 現在の状況

✅ **完了したこと**
- レポート機能のバックエンドAPI実装完了
- すべてのAPIエンドポイントが正常に動作
- フロントエンドページの作成完了
- ローカルサーバー起動

---

## 🚀 次のステップ

### ステップ1: フロントエンドの動作確認（優先度: 高）

#### 1-1. ブラウザで各ページを確認

1. **レポート一覧ページ**
   - http://localhost:5173/admin/reports.html
   - レポート一覧が表示されるか確認
   - フィルター機能が動作するか確認
   - エラーが表示されないか確認

2. **レポート作成ページ**
   - http://localhost:5173/admin/reports/new.html
   - フォームが表示されるか確認
   - 清掃項目の追加・削除が動作するか確認
   - 写真アップロードが動作するか確認
   - レポートを作成して送信

3. **レポート編集ページ**
   - http://localhost:5173/admin/reports/{report_id}/edit.html
   - 既存データが読み込まれるか確認
   - レポートを更新

4. **レポート詳細ページ**
   - http://localhost:5173/reports/{report_id}.html
   - レポート詳細が表示されるか確認
   - 写真が表示されるか確認

#### 1-2. ブラウザの開発者ツールで確認

- **Consoleタブ**: エラーメッセージを確認
- **Networkタブ**: APIリクエストが正しく送信されているか確認
- **レスポンス**: APIレスポンスが正しいか確認

---

### ステップ2: Firebase認証の統合（優先度: 中）

#### 2-1. 現状

- 現在は簡易的な認証（`mock-token`）を使用
- フロントエンドの `getFirebaseIdToken()` 関数が未実装

#### 2-2. 実装が必要なこと

1. **Firebase SDKの統合**
   - Firebase JavaScript SDKを読み込む
   - Firebase認証の初期化

2. **IDトークンの取得**
   - `getFirebaseIdToken()` 関数を実装
   - 現在のユーザーのIDトークンを取得

3. **Lambda関数での検証**
   - Firebase Admin SDKを使用したIDトークンの検証
   - ユーザー情報とロールの取得

#### 2-3. 実装ファイル

- `src/pages/admin/reports.html`
- `src/pages/admin/reports/new.html`
- `src/pages/admin/reports/[id]/edit.html`
- `src/pages/reports/[id].html`
- `lambda_function.py` (Firebase Admin SDKの統合)

---

### ステップ3: 写真アップロード機能のテスト（優先度: 中）

#### 3-1. 確認事項

1. **写真のアップロード**
   - Base64エンコードが正しく動作するか
   - S3へのアップロードが成功するか
   - 写真URLが正しく返されるか

2. **写真の表示**
   - アップロードした写真が表示されるか
   - レポート詳細ページで写真が表示されるか

3. **写真の削除**
   - レポート削除時にS3の写真も削除されるか（現在は未実装）

---

### ステップ4: エラーハンドリングの改善（優先度: 低）

#### 4-1. フロントエンド

- APIエラー時のユーザーフレンドリーなメッセージ表示
- ネットワークエラー時の処理
- バリデーションエラーの表示

#### 4-2. バックエンド

- より詳細なエラーメッセージ
- エラーログの改善

---

### ステップ5: DynamoDBテーブルスキーマの最適化（優先度: 低）

#### 5-1. 現状

- テーブルにソートキー（`created_at`）があるため、スキャン操作を使用
- スキャン操作は非効率（テーブルが大きくなると遅くなる）

#### 5-2. 改善案

- テーブルを削除して再作成
- `report_id`のみをパーティションキーにする
- `get_item`操作を使用できるようにする

詳細は `docs/DYNAMODB_SCHEMA_FIX.md` を参照してください。

---

## 🎯 推奨される順序

1. **ステップ1: フロントエンドの動作確認** ← 今すぐ
2. **ステップ2: Firebase認証の統合** ← 次に
3. **ステップ3: 写真アップロード機能のテスト** ← その後
4. **ステップ4: エラーハンドリングの改善** ← 必要に応じて
5. **ステップ5: DynamoDBテーブルスキーマの最適化** ← パフォーマンスが必要になったら

---

## 📝 注意事項

- 現在はテスト環境なので、`mock-token`で動作しています
- 本番環境にデプロイする前に、Firebase認証を実装してください
- 写真アップロード機能は、S3バケットの設定を確認してください

---

## 🆘 問題が発生した場合

1. ブラウザの開発者ツールでエラーを確認
2. CloudWatch LogsでLambda関数のログを確認
3. APIエンドポイントを直接テスト（`./test-api.sh`）

