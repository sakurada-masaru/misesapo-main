# 組織管理者への依頼方法（サービスアカウントキー作成許可）

## 依頼内容

Google Cloud Platformでサービスアカウントのキーを作成するための許可を依頼します。

## 依頼する理由

現在、Googleカレンダーで管理しているスケジュールを、システム側（DynamoDB）にも同期する必要があります。そのため、Google Calendar APIを使用するためのサービスアカウントキーが必要です。

## 依頼手順

### ステップ1: 組織管理者に連絡

組織管理者（Google Workspaceの管理者またはGCPの組織管理者）に以下の内容を依頼してください：

---

**依頼文例:**

```
【件名】Google Cloud Platform サービスアカウントキー作成の許可依頼

お世話になっております。

現在、Googleカレンダーで管理しているスケジュールをシステム側にも同期する機能を実装するため、
Google Calendar APIを使用するためのサービスアカウントキーを作成する必要があります。

しかし、現在の組織ポリシーにより、サービスアカウントキーの作成が制限されているようです。

以下のいずれかの方法で、キー作成を許可していただけますでしょうか：

【方法1】特定のプロジェクトに対して例外を設定
- プロジェクトID: [あなたのプロジェクトID]
- ポリシー: `constraints/iam.disableServiceAccountKeyCreation`
- 例外: このプロジェクトではキー作成を許可

【方法2】特定のサービスアカウントに対して例外を設定
- サービスアカウント名: `misesapo-calendar`（作成予定）
- ポリシー: `constraints/iam.disableServiceAccountKeyCreation`
- 例外: このサービスアカウントではキー作成を許可

ご対応のほど、よろしくお願いいたします。
```

---

### ステップ2: プロジェクトIDを確認

依頼する前に、あなたのGCPプロジェクトIDを確認してください：

1. [Google Cloud Console](https://console.cloud.google.com/)にアクセス
2. 画面上部のプロジェクト選択ドロップダウンをクリック
3. プロジェクトIDをコピー（例: `my-project-123456`）

### ステップ3: 組織ポリシーの確認（管理者向け）

組織管理者が確認すべき項目：

1. **組織ポリシーの確認**
   - [Google Cloud Console](https://console.cloud.google.com/) → 「IAMと管理」→「組織ポリシー」
   - `constraints/iam.disableServiceAccountKeyCreation` を検索
   - このポリシーが有効になっているか確認

2. **例外の設定方法**
   - 組織ポリシーの詳細ページを開く
   - 「カスタマイズ」を選択
   - 「例外を追加」をクリック
   - プロジェクトIDまたはサービスアカウント名を指定
   - 「保存」をクリック

---

## 許可が得られた後の手順

組織管理者から許可が得られたら、以下の手順でサービスアカウントキーを作成してください：

1. **サービスアカウントの作成**
   - 「IAMと管理」→「サービスアカウント」→「サービスアカウントを作成」
   - サービスアカウント名: `misesapo-calendar`
   - 「作成して続行」→「完了」

2. **キーの作成**
   - 作成したサービスアカウントをクリック
   - 「キー」タブ→「キーを追加」→「新しいキーを作成」
   - JSON形式を選択→「作成」
   - ダウンロードされたJSONファイルを安全に保管

3. **カレンダーの共有設定**
   - Googleカレンダーを開く
   - カレンダー設定→「特定のユーザーと共有」
   - サービスアカウントのメールアドレス（JSONファイルの`client_email`）を追加
   - 権限: 「変更イベントの管理」

4. **Lambda関数への設定**
   - 詳細は `docs/GOOGLE_CALENDAR_AUTH_SETUP.md` を参照

---

## 代替案: OAuth 2.0を使用する場合

組織管理者からの許可が得られない場合、OAuth 2.0を使用する方法もあります。

詳細は `docs/GOOGLE_CALENDAR_OAUTH2_SETUP.md` を参照してください。

**注意**: OAuth 2.0はユーザー認証が必要なため、自動化が難しくなります。

