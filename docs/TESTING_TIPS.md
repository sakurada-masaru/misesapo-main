# テストのヒント

## 🔍 よくある問題と対処法

### 問題1: レポートが作成された直後に取得できない（404エラー）

**原因**: DynamoDBの一貫性の問題。レポートが作成されてから、読み取り可能になるまでに少し時間がかかることがあります。

**対処法**:
1. 少し待ってから再度テストを実行
2. または、テストスクリプトに少し待機時間を追加

```bash
# 2秒待ってからテストを実行
sleep 2 && ./test-api.sh
```

### 問題2: Lambda関数が最新のコードでデプロイされていない

**確認方法**:
1. Lambdaコンソールで関数を選択
2. 「コード」タブを開く
3. `from boto3.dynamodb.conditions import Key, Attr` が含まれているか確認
4. `get_report_detail`関数内で `Attr('report_id').eq(report_id)` が使われているか確認

**対処法**:
- 最新の `lambda_function.py` の内容をコピーして、Lambda関数に貼り付けてデプロイ

### 問題3: CloudWatch Logsでデバッグログを確認したい

**手順**:
1. Lambda関数の「モニタリング」タブを開く
2. 「CloudWatch Logs を表示」をクリック
3. 最新のログストリームを開く
4. `DEBUG:` で始まるログを探す

**確認すべきログ**:
- `DEBUG: Getting report with ID: ...`
- `DEBUG: Scan response: ...`
- `DEBUG: Items found: ...`

---

## 📝 テストのベストプラクティス

1. **レポート作成後、少し待ってから取得**
   - 作成と取得の間に1-2秒の待機時間を入れる

2. **CloudWatch Logsを確認**
   - エラーが発生した場合は、必ずログを確認

3. **Lambda関数を再デプロイ**
   - コードを変更したら、必ずデプロイ

4. **テストデータをクリーンアップ**
   - テストが完了したら、不要なレポートを削除

---

## 🚀 テストスクリプトの改善案

テストスクリプトに待機時間を追加する場合：

```bash
# レポート作成後、少し待つ
sleep 2

# その後、取得を試みる
curl -X GET "${API_URL}/staff/reports/${REPORT_ID}" ...
```

