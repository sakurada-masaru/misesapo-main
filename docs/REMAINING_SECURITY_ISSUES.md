# 残っているセキュリティ問題

**作成日**: 2025年12月10日  
**目的**: パスワード問題修正後の残りのセキュリティ問題を整理

---

## ✅ 修正済み

### 1. ハードコードされたパスワード（高リスク）
- **状態**: ✅ **修正済み**
- **修正内容**: `review.html`のパスワード認証を削除（AWS Cognito認証に統一）

---

## ⚠️ 残っている問題

### 1. APIエンドポイントURLの公開（中リスク）

**問題**:
- 複数のJSファイルでAPIエンドポイントURLがハードコードされている
- 公開リポジトリに含まれている

**影響範囲**:
- `src/assets/js/cognito_auth.js`
- `src/assets/js/auth.js`
- `src/assets/js/admin-reports.js`
- `src/assets/js/staff-report-new.js`
- `src/assets/js/staff-mypage.js`
- `src/assets/js/admin-users.js`
- `src/assets/js/sales-clients.js`
- `src/assets/js/sales-schedules.js`
- `src/assets/js/admin-schedules.js`
- `src/assets/js/aws-*.js`（複数ファイル）

**公開されているエンドポイント**:
- `https://51bhoxkbxd.execute-api.ap-northeast-1.amazonaws.com/prod`
- `https://2z0ui5xfxb.execute-api.ap-northeast-1.amazonaws.com/prod`

**リスク評価**:
- 🟡 **中リスク**: APIエンドポイントが公開されている
- ⚠️ エンドポイントへの直接アクセスが可能
- ⚠️ DDoS攻撃の標的になる可能性

**対策**:
- ✅ API Gatewayでレート制限を設定（推奨）
- ✅ 認証・認可を適切に実装（既に実装済み）
- ✅ WAF（Web Application Firewall）の導入を検討
- ⚠️ 環境変数化は**推奨しない**（フロントエンドのJSファイルは公開されるため、環境変数化しても意味がない）

**結論**:
- **修正不要**: フロントエンドのJSファイルは公開されるため、APIエンドポイントURLを隠すことはできない
- **対策**: API Gateway側で適切なセキュリティ対策（レート制限、認証、WAF）を実装する

---

### 2. 開発用パスワードの平文保存（低リスク）

**問題**:
- `scripts/dev_server.py`: 開発サーバーのパスワードが平文で保存されている
- `scripts/register_employees.py`: 従業員登録スクリプトでデフォルトパスワードが設定されている

**影響範囲**:
- 開発環境のみ
- 本番環境では使用されない

**リスク評価**:
- 🟢 **低リスク**: 開発環境のみの問題
- ⚠️ 本番環境では適切な認証システム（Firebase/Cognito）を使用している

**対策**:
- ⚠️ 開発環境のみの問題のため、優先度は低い
- ✅ 本番環境では適切な認証システムを使用（既に実装済み）

**結論**:
- **修正不要（優先度低）**: 開発環境のみの問題で、本番環境には影響しない

---

## 📋 セキュリティチェックリスト

### 修正済み
- [x] ハードコードされたパスワードの削除（`review.html`）

### 修正不要（理由あり）
- [ ] APIエンドポイントURLの環境変数化（フロントエンドは公開されるため意味がない）
- [ ] 開発用パスワードのハッシュ化（開発環境のみの問題）

### 推奨される対策（API Gateway側）
- [ ] API Gatewayでレート制限を設定
- [ ] WAF（Web Application Firewall）の導入
- [ ] 認証・認可の強化（既に実装済み）

---

## 🎯 総合評価

### 現状のセキュリティレベル

**総合評価**: 🟢 **低リスク**

- ✅ 機密情報（APIキー、認証情報）は適切に保護されている
- ✅ ハードコードされたパスワードは削除済み
- ✅ 認証システムは適切に実装されている（Firebase/Cognito）
- ⚠️ APIエンドポイントURLは公開されているが、これはフロントエンドの特性上避けられない
- ⚠️ 開発環境のパスワードは平文だが、本番環境には影響しない

### 推奨される対策

1. **API Gateway側のセキュリティ強化**（最優先）
   - レート制限の設定
   - WAFの導入
   - 認証・認可の強化

2. **開発環境の改善**（優先度低）
   - 開発用パスワードのハッシュ化
   - 開発環境のセキュリティガイドライン策定

---

## 📝 まとめ

### 修正が必要な問題
- **なし**: すべての重要なセキュリティ問題は修正済み

### 修正不要な問題
- **APIエンドポイントURLの公開**: フロントエンドの特性上、避けられない
- **開発用パスワードの平文保存**: 開発環境のみの問題

### 推奨される対策
- **API Gateway側のセキュリティ強化**: レート制限、WAF、認証・認可の強化

---

**最終更新**: 2025年12月10日

