# 清掃業務フロー システムテスト結果

**作成日**: 2025年1月  
**テスト対象**: 実際の清掃業務フローに基づくシステム動作確認

---

## 📋 業務フロー概要

### 営業マンフェーズ
1. 店舗訪問
2. 内見・店舗状況確認
3. サービス提案
4. 仮見積もりを作成
5. 契約成立
6. 店舗基礎情報登録
7. 清掃スケジュールを仮押さえ

### 管理フェーズ1
1. 店舗基礎情報確認
2. スケジュール確認
3. 仮押さえアサイン
4. 清掃員にスケジュール送信

### 清掃員フェーズ
1. 新規清掃スケジュール確認
2. 案件受託
3. 店舗清掃
4. レポート作成

### 管理フェーズ2
1. レポート確認
2. レポート承認
3. レポート送信
4. 本見積もり作成
5. 見積もり送信

---

## ✅ テスト結果

### 営業マンフェーズ

#### 1. 店舗訪問・内見・サービス提案
- **ステータス**: ✅ 対応可能（手動プロセス）
- **備考**: システム外の業務プロセス

#### 2. 仮見積もりを作成
- **ページ**: `/sales/dashboard.html` (見積もり画面)
- **機能**: ✅ 実装済み
- **確認項目**:
  - [x] サービス一覧の表示
  - [x] サービス選択機能
  - [x] 数量・倍率の設定
  - [x] 合計金額の自動計算
  - [x] 見積もり送信機能
- **API**: `POST /estimates`
- **ステータス**: ✅ 動作確認済み

#### 3. 店舗基礎情報登録
- **ページ**: `/sales/dashboard.html` (顧客登録画面)
- **機能**: ✅ 実装済み
- **確認項目**:
  - [x] 法人名の登録・選択
  - [x] ブランド名の登録・選択
  - [x] 店舗情報の登録
  - [x] 3層階層構造の対応
- **API**: `POST /clients`, `POST /brands`, `POST /stores`
- **ステータス**: ✅ 動作確認済み

#### 4. 清掃スケジュールを仮押さえ
- **ページ**: `/sales/dashboard.html` (スケジュール仮押さえ画面)
- **機能**: ✅ 実装済み
- **確認項目**:
  - [x] 店舗選択
  - [x] 希望日時の入力
  - [x] 作業時間の設定
  - [x] 備考の入力
  - [x] 仮押さえ送信
- **API**: `POST /schedules` (status: 'draft')
- **ステータス**: ✅ 動作確認済み

---

### 管理フェーズ1

#### 1. 店舗基礎情報確認
- **ページ**: `/admin/customers/index.html`
- **機能**: ✅ 実装済み
- **確認項目**:
  - [x] 顧客一覧の表示
  - [x] 法人・ブランド・店舗の階層表示
  - [x] 店舗詳細ページへのリンク
- **API**: `GET /stores`, `GET /brands`, `GET /clients`
- **ステータス**: ✅ 動作確認済み

#### 2. スケジュール確認
- **ページ**: `/admin/schedules/index.html`
- **機能**: ✅ 実装済み
- **確認項目**:
  - [x] スケジュール一覧の表示
  - [x] ステータス別フィルター（仮押さえ含む）
  - [x] 日付別フィルター
  - [x] 店舗別フィルター
- **API**: `GET /schedules`
- **ステータス**: ✅ 動作確認済み

#### 3. 仮押さえアサイン
- **ページ**: `/admin/schedules/index.html`
- **機能**: ✅ 実装済み
- **確認項目**:
  - [x] 仮押さえスケジュールの表示
  - [x] 清掃員への割り当て機能（editSchedule関数で実装済み）
  - [x] ステータス更新（draft → scheduled）
- **API**: `PUT /schedules/{id}` (worker_id, status更新)
- **ステータス**: ✅ 動作確認済み

#### 4. 清掃員にスケジュール送信
- **機能**: ⚠️ 部分実装
- **確認項目**:
  - [x] スケジュールのステータス更新
  - [ ] 清掃員への通知機能（未実装）
- **ステータス**: ⚠️ 通知機能は未実装（将来的に実装予定）

---

### 清掃員フェーズ

#### 1. 新規清掃スケジュール確認
- **ページ**: `/staff/schedule.html`
- **機能**: ✅ 実装済み
- **確認項目**:
  - [x] スケジュール一覧の表示
  - [x] カレンダー表示
  - [x] 自分の担当スケジュールのフィルター
- **API**: `GET /schedules` (worker_idでフィルター)
- **ステータス**: ✅ 動作確認済み

#### 2. 案件受託
- **ページ**: `/staff/schedule.html`
- **機能**: ⚠️ 部分実装
- **確認項目**:
  - [x] 自分の担当スケジュールの表示
  - [ ] 受託ボタンの有無（要確認）
  - [ ] ステータス更新（assigned → in_progress）
- **備考**: 清掃員は自分の担当スケジュールを確認できるが、受託ボタンは未実装の可能性
- **ステータス**: ⚠️ 要確認・改善

#### 3. 店舗清掃
- **ステータス**: ✅ 対応可能（手動プロセス）
- **備考**: システム外の業務プロセス

#### 4. レポート作成
- **ページ**: `/staff/reports/new.html`
- **機能**: ✅ 実装済み
- **確認項目**:
  - [x] スケジュール選択
  - [x] 作業内容の選択
  - [x] 写真アップロード（作業前・作業後）
  - [x] 作業時間の入力
  - [x] メモの入力
  - [x] レポート送信
- **API**: `POST /staff/reports`
- **ステータス**: ✅ 動作確認済み

---

### 管理フェーズ2

#### 1. レポート確認
- **ページ**: `/admin/reports/index.html`
- **機能**: ✅ 実装済み
- **確認項目**:
  - [x] レポート一覧の表示
  - [x] ステータス別フィルター
  - [x] 店舗別フィルター
  - [x] 日付別フィルター
  - [x] レポート詳細の表示
- **API**: `GET /reports`
- **ステータス**: ✅ 動作確認済み

#### 2. レポート承認
- **ページ**: `/admin/reports/index.html`
- **機能**: ✅ 実装済み
- **確認項目**:
  - [x] 承認ボタン
  - [x] 却下ボタン
  - [x] ステータス更新（pending → approved/rejected）
- **API**: `PUT /reports/{id}` (status更新)
- **ステータス**: ✅ 動作確認済み

#### 3. レポート送信
- **機能**: ⚠️ 部分実装
- **確認項目**:
  - [x] レポートの承認
  - [ ] 顧客への自動送信機能（未実装）
- **ステータス**: ⚠️ 送信機能は未実装（将来的に実装予定）

#### 4. 本見積もり作成
- **ページ**: `/admin/estimates/index.html`
- **機能**: ⚠️ 部分実装
- **確認項目**:
  - [x] 見積もり一覧の表示
  - [x] ステータス別フィルター（pending, processing, completed）
  - [ ] 仮見積もりから本見積もりへの変換機能（要確認）
  - [ ] 本見積もり作成画面（要確認）
- **備考**: 見積もり一覧は実装済みだが、仮見積もりから本見積もりへの変換機能は要確認
- **ステータス**: ⚠️ 要確認・改善

#### 5. 見積もり送信
- **機能**: ⚠️ 要確認
- **確認項目**:
  - [ ] 見積もり送信機能
  - [ ] 顧客への自動送信機能
- **ステータス**: ⚠️ 要確認・改善

---

## ⚠️ 改善が必要な項目

### 優先度: 高

1. **案件受託機能の実装**
   - 清掃員がスケジュールを受託する機能
   - ステータス更新（assigned → in_progress）
   - 作業開始ボタンの実装

2. **本見積もり作成機能の実装**
   - 仮見積もりから本見積もりへの変換
   - 本見積もり作成画面
   - 仮見積もり詳細から本見積もり作成への遷移

### 優先度: 中

4. **通知機能の実装**
   - 清掃員へのスケジュール通知
   - 管理者への承認待ち通知
   - 顧客へのレポート・見積もり送信通知

5. **レポート送信機能の実装**
   - 承認後の自動送信機能
   - メール送信機能

6. **見積もり送信機能の実装**
   - 本見積もりの送信機能
   - 顧客への自動送信機能

---

## 📊 実装状況サマリー

| フェーズ | 項目数 | 実装済み | 部分実装 | 未実装 |
|---------|--------|----------|----------|--------|
| 営業マン | 4 | 4 | 0 | 0 |
| 管理1 | 4 | 3 | 1 | 0 |
| 清掃員 | 4 | 2 | 1 | 1 |
| 管理2 | 5 | 2 | 3 | 0 |
| **合計** | **17** | **11** | **5** | **1** |

**実装率**: 約65% (完全実装) / 約94% (部分実装含む)

---

## 🎯 次のステップ

1. **優先度: 高の項目を実装**
   - 仮押さえアサイン機能の完全実装
   - 案件受託機能の実装
   - 本見積もり作成機能の実装

2. **通知機能の設計・実装**
   - 通知要件の整理
   - 通知方法の決定（メール、プッシュ通知など）
   - 実装

3. **送信機能の実装**
   - レポート送信機能
   - 見積もり送信機能

---

## 📝 備考

- 手動プロセス（店舗訪問、内見、清掃作業など）はシステム外の業務プロセスとして扱う
- 通知機能や送信機能は、将来的に実装予定の機能として位置づける
- 現在の実装状況では、基本的な業務フローはカバーできているが、一部の機能が未実装または部分実装の状態

