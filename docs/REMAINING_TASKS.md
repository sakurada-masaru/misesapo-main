# やり残しているタスク

## ✅ 完了したタスク

### 認証システムの分離
- [x] AWS Cognito User Poolの作成
- [x] 従業員用ログインページ（`/staff/signin.html`）の作成
- [x] お客様用ログインページ（`/signin.html`）の更新
- [x] ログインページの完全分離（相互リンクなし）

### データベースの分離
- [x] DynamoDB `clients`テーブルの作成
- [x] Lambda関数に`clients`テーブル操作を追加
- [x] `/signup.html`での登録処理を`clients`テーブルに変更
- [x] 管理画面からお客様（customer）を除外

### 管理画面
- [x] 管理画面で従業員登録時にAWS Cognitoにもユーザーを作成
- [x] 従業員登録時に`workers`テーブルに`cognito_sub`を保存

---

## ⚠️ やり残しているタスク

### 1. API Gatewayの設定

#### `/clients`エンドポイントの設定
- [x] `/clients`リソースの作成
- [x] `/clients/{id}`リソースの作成
- [x] GET, POST, PUT, DELETEメソッドの設定
- [x] CORS設定
- [x] Lambda統合の設定

**状態**: ✅ 完了

### 2. 既存データの移行

#### 既存のクライアントデータの移行
- [ ] `workers`テーブルから`role: 'customer'`のユーザーを検索
- [ ] 該当ユーザーを`clients`テーブルに移行
- [ ] `workers`テーブルから移行済みデータを削除

**影響**: 既存のお客様データが`workers`テーブルに残っている

### 3. ログイン後のリダイレクト処理

#### お客様のログイン後リダイレクト
- [ ] `/signin.html`でログイン後、`/mypage.html`にリダイレクト（将来的に実装）
- [ ] 現在は`/mypage.html`にリダイレクトされるが、お客様用のマイページが必要

**影響**: お客様がログイン後の遷移先が不明確

### 4. マイページの対応

#### お客様用マイページ
- [ ] `/mypage.html`がお客様専用か確認
- [ ] 従業員用マイページ（`/staff/mypage.html`）との分離を確認

**影響**: お客様と従業員のマイページが混在している可能性

### 5. 認証処理の確認

#### Firebase認証でのクライアント情報取得
- [x] `/signin.html`でログイン時に`clients`テーブルからユーザー情報を取得する処理を実装
- [x] `firebase_uid`で`clients`テーブルを検索する処理を実装

**状態**: ✅ 完了

---

## 📋 優先度

### 高優先度
1. ~~**API Gatewayの`/clients`エンドポイント設定**~~ - ✅ 完了
2. ~~**Firebase認証でのクライアント情報取得**~~ - ✅ 完了

### 中優先度
3. **既存データの移行** - データの整合性のため
4. **ログイン後のリダイレクト処理** - UX向上のため

### 低優先度
5. **マイページの分離確認** - 既存機能の確認

---

## 🚀 次のステップ

1. **API Gatewayに`/clients`エンドポイントを設定**
   - スクリプトを作成して自動設定

2. **Firebase認証でのクライアント情報取得を実装**
   - `auth.js`の`loginWithFirebase`関数を修正

3. **既存データの移行スクリプトを作成**
   - `workers`テーブルから`clients`テーブルへの移行

