# システム分離可能性の評価（MDCS準拠）

**作成日**: 2025年12月10日  
**目的**: 6つのカテゴリへの分離可能性を評価し、現状での分離可否を判断

---

## 🎯 評価対象の6つのカテゴリ

1. **パブリック**: コーポレートサイト、サービス紹介、採用情報など
2. **カスタマー**: 顧客向け機能（マイページ、発注、問い合わせなど）
3. **清掃員**: 清掃員向けツール（スケジュール、レポート、在庫管理など）
4. **営業マン**: 営業向けツール（顧客管理、見積もり、スケジュールなど）
5. **管理**: 管理者向け機能（ダッシュボード、ユーザー管理、分析など）
6. **社内ツール**: 社内共通ツール（研修、マニュアル、Wikiなど）

---

## 📊 現状のシステム構造

### ファイル構造

```
public/
├── index.html (パブリック)
├── about.html (パブリック)
├── service.html (パブリック)
├── recruit.html (パブリック)
├── signin.html (認証: お客様用)
├── signup.html (認証: お客様用)
├── mypage/ (カスタマー)
├── admin/ (管理)
├── sales/ (営業マン)
├── staff/ (清掃員)
├── css/ (共通スタイル)
├── js/ (共通スクリプト)
└── data/ (共通データ)

src/pages/
├── index.html (パブリック)
├── admin/ (管理)
├── sales/ (営業マン)
├── staff/ (清掃員)
├── mypage/ (カスタマー)
└── ...
```

### 共有リソース

1. **認証システム**
   - Firebase Authentication（お客様用）
   - AWS Cognito（従業員用）
   - 認証関連のJSファイル（`auth.js`, `cognito_auth.js`）

2. **API基盤**
   - Lambda関数（`lambda_function.py`）
   - API Gateway
   - DynamoDBテーブル（`clients`, `workers`, `schedules`, `reports`など）

3. **共通コンポーネント**
   - ヘッダー（`header.html`, `header-admin.html`, `header-staff.html`など）
   - フッター
   - サイドバー（`admin-sidebar.html`, `staff-sidebar.html`）
   - モーダル（`modal_manager.js`）

4. **共通スタイル**
   - `style.css`（基本スタイル）
   - `header.css`（ヘッダー共通）
   - その他の共通CSSファイル

5. **共通スクリプト**
   - `app.js`（アプリケーション初期化）
   - `navigation.js`（ナビゲーション）
   - `data_utils.js`（データユーティリティ）
   - API関連のJSファイル

---

## 🔍 分離可能性の評価

### 1. パブリック

**現状のファイル**:
- `index.html`, `about.html`, `service.html`, `recruit.html`
- `contact.html`, `privacy-policy.html`, `security-policy.html`
- `lp.html`, `greeting.html`, `voice.html`

**依存関係**:
- ✅ **低依存**: 認証システムへの依存が少ない
- ✅ **静的コンテンツ**: 主に静的HTML
- ⚠️ **共通スタイル**: `style.css`, `header.css`に依存
- ⚠️ **共通スクリプト**: `app.js`, `navigation.js`に依存

**分離可能性**: **🟢 高い**

**分離時の課題**:
- 共通スタイルとスクリプトの分離が必要
- ヘッダー/フッターの共通化

---

### 2. カスタマー

**現状のファイル**:
- `mypage/` ディレクトリ内のファイル
- `signin.html`, `signup.html`（お客様用）
- `cart.html`, `checkout.html`, `order/`
- `customers.html`, `customers-support-desk.html`

**依存関係**:
- ⚠️ **認証システム**: Firebase Authenticationに依存
- ⚠️ **API**: Lambda関数（`/clients`エンドポイント）に依存
- ⚠️ **データベース**: DynamoDB `clients`テーブルに依存
- ⚠️ **共通スタイル**: 共通CSSに依存
- ⚠️ **共通スクリプト**: 認証関連JSに依存

**分離可能性**: **🟡 中程度**

**分離時の課題**:
- Firebase Authenticationの共有
- Lambda関数のエンドポイント分離
- 共通コンポーネントの分離

---

### 3. 清掃員

**現状のファイル**:
- `staff/` ディレクトリ内のファイル
- `staff/signin.html`（従業員用）
- `schedule.html`, `report.html`, `reports/`

**依存関係**:
- ⚠️ **認証システム**: AWS Cognitoに依存
- ⚠️ **API**: Lambda関数（`/workers`, `/schedules`, `/reports`エンドポイント）に依存
- ⚠️ **データベース**: DynamoDB `workers`, `schedules`, `reports`テーブルに依存
- ⚠️ **共通スタイル**: `staff-common.css`, `staff-mypage.css`などに依存
- ⚠️ **共通スクリプト**: `cognito_auth.js`, `staff-report-new.js`などに依存

**分離可能性**: **🟡 中程度**

**分離時の課題**:
- AWS Cognitoの共有
- Lambda関数のエンドポイント分離
- スケジュール/レポート機能の分離（営業マンと共有部分あり）

---

### 4. 営業マン

**現状のファイル**:
- `sales/` ディレクトリ内のファイル
- `sales/dashboard.html`, `sales/clients/`, `sales/estimates/`, `sales/schedules/`

**依存関係**:
- ⚠️ **認証システム**: AWS Cognitoに依存（清掃員と共有）
- ⚠️ **API**: Lambda関数（`/clients`, `/estimates`, `/schedules`エンドポイント）に依存
- ⚠️ **データベース**: DynamoDB `clients`, `estimates`, `schedules`テーブルに依存
- ⚠️ **共通スタイル**: `sales-clients.css`, `sales-schedules.css`に依存
- ⚠️ **共通スクリプト**: `sales-clients.js`, `sales-schedules.js`に依存
- ⚠️ **スケジュール機能**: 清掃員と共有部分あり

**分離可能性**: **🟡 中程度**

**分離時の課題**:
- AWS Cognitoの共有
- スケジュール機能の分離（清掃員と共有）
- 顧客管理機能の分離（カスタマーと共有部分あり）

---

### 5. 管理

**現状のファイル**:
- `admin/` ディレクトリ内のファイル
- `admin/dashboard.html`, `admin/users/`, `admin/schedules/`, `admin/reports/`

**依存関係**:
- ⚠️ **認証システム**: AWS Cognitoに依存（全従業員と共有）
- ⚠️ **API**: Lambda関数（全エンドポイント）に依存
- ⚠️ **データベース**: DynamoDB全テーブルに依存
- ⚠️ **共通スタイル**: `admin-sidebar.css`, `admin-reports.css`などに依存
- ⚠️ **共通スクリプト**: `admin-sidebar.js`, `admin-users.js`などに依存
- ⚠️ **全機能へのアクセス**: 他のカテゴリの機能を統合管理

**分離可能性**: **🔴 低い**

**分離時の課題**:
- 全システムへのアクセスが必要
- 他のカテゴリの機能を統合管理する必要がある
- 完全な分離は困難

---

### 6. 社内ツール

**現状のファイル**:
- `wiki/`, `cleaning-manual.html`, `cleaning-manual-admin.html`
- `announcements.html`, `staff/announcements.html`
- `staff/training.html`

**依存関係**:
- ⚠️ **認証システム**: AWS Cognitoに依存（従業員用）
- ⚠️ **API**: Lambda関数（Wiki、マニュアル、お知らせエンドポイント）に依存
- ⚠️ **データベース**: DynamoDB（Wiki、マニュアル、お知らせテーブル）に依存
- ⚠️ **共通スタイル**: 共通CSSに依存
- ⚠️ **共通スクリプト**: 共通JSに依存

**分離可能性**: **🟡 中程度**

**分離時の課題**:
- AWS Cognitoの共有
- お知らせ機能の分離（清掃員、営業マン、管理と共有）

---

## 📐 MDCSの論理に基づく評価

### 三段論法による前提条件の検証

**要素A**: 各カテゴリのファイル
**グループB**: 同じ認証システムを使用する（分類方法1: 認証方法）
**グループC**: 同じAPI基盤を使用する（分類方法2: バックエンド）

**検証**:
- パブリック: 認証不要（A1 ∉ B）、API依存少ない（A1 ∉ C）
- カスタマー: Firebase認証（A2 ∈ B）、Lambda API依存（A2 ∈ C）
- 清掃員: Cognito認証（A3 ∈ B）、Lambda API依存（A3 ∈ C）
- 営業マン: Cognito認証（A4 ∈ B）、Lambda API依存（A4 ∈ C）
- 管理: Cognito認証（A5 ∈ B）、Lambda API依存（A5 ∈ C）
- 社内ツール: Cognito認証（A6 ∈ B）、Lambda API依存（A6 ∈ C）

**結論**: 
- パブリックは他のカテゴリと異なる前提条件（認証不要）
- カスタマーはFirebase認証で他のカテゴリと異なる
- 清掃員、営業マン、管理、社内ツールは同じ前提条件（Cognito認証）

### 演繹法による論理的展開

**前提**: 
- 各カテゴリが異なる認証システムやAPIエンドポイントを使用する
- 共通リソース（認証、API、データベース）が存在する

**展開**:
- 完全な分離は困難（共通リソースの共有が必要）
- 部分的な分離は可能（ファイル構造の分離）
- 認証システムの分離は既に実装済み（Firebase: お客様、Cognito: 従業員）

**結論**:
- 現状での完全な分離は困難
- 段階的な分離は可能（末広がりな思想）

---

## 🎯 分離可能性の総合評価

### 現状での分離可否

**結論**: **🟡 部分的な分離は可能、完全な分離は困難**

### 分離可能な部分

1. **パブリック**: ✅ **完全分離可能**
   - 認証不要
   - 静的コンテンツ中心
   - 他のカテゴリへの依存が少ない

2. **カスタマー**: 🟡 **部分的分離可能**
   - Firebase認証は既に分離済み
   - ファイル構造の分離は可能
   - APIエンドポイントの分離が必要

3. **清掃員**: 🟡 **部分的分離可能**
   - Cognito認証は既に分離済み
   - ファイル構造の分離は可能
   - スケジュール機能の分離が必要（営業マンと共有）

4. **営業マン**: 🟡 **部分的分離可能**
   - Cognito認証は既に分離済み
   - ファイル構造の分離は可能
   - スケジュール機能の分離が必要（清掃員と共有）

5. **管理**: 🔴 **完全分離困難**
   - 全システムへのアクセスが必要
   - 他のカテゴリの機能を統合管理
   - 完全な分離は不可能

6. **社内ツール**: 🟡 **部分的分離可能**
   - Cognito認証は既に分離済み
   - ファイル構造の分離は可能
   - お知らせ機能の分離が必要（他のカテゴリと共有）

---

## 🚧 分離時の課題と対策

### 課題1: 認証システムの共有

**現状**:
- Firebase Authentication（お客様用）
- AWS Cognito（従業員用）

**対策**:
- ✅ 既に分離済み
- 各カテゴリで適切な認証システムを使用

### 課題2: APIエンドポイントの分離

**現状**:
- 単一のLambda関数（`lambda_function.py`）
- 全エンドポイントが1つの関数に集約

**対策**:
- Lambda関数をカテゴリ別に分割
- 各カテゴリ専用のエンドポイントを作成
- 共通機能は共有モジュールとして分離

### 課題3: データベーステーブルの分離

**現状**:
- DynamoDBテーブルが共有されている
- `clients`, `workers`, `schedules`, `reports`など

**対策**:
- テーブルは共有のまま（データの整合性のため）
- アクセス権限で制御
- 各カテゴリで必要なテーブルのみアクセス

### 課題4: 共通コンポーネントの分離

**現状**:
- ヘッダー、フッター、サイドバーが共通
- 共通スタイル、共通スクリプトが存在

**対策**:
- 共通コンポーネントを別リポジトリまたはパッケージとして分離
- npmパッケージまたはGit Submoduleとして管理
- 各カテゴリで必要なコンポーネントのみ使用

### 課題5: スケジュール機能の共有

**現状**:
- 清掃員と営業マンが同じスケジュール機能を使用
- 管理画面でもスケジュール機能を使用

**対策**:
- スケジュール機能を共通モジュールとして分離
- 各カテゴリで必要な機能のみ使用
- APIエンドポイントは共有、UIは分離

---

## 💡 推奨される分離戦略

### Phase 1: ファイル構造の分離（即座に可能）

**目標**: 各カテゴリのファイルを明確に分離

**実施内容**:
1. ディレクトリ構造の整理
   ```
   public/
   ├── public/ (パブリック)
   ├── customer/ (カスタマー)
   ├── staff/ (清掃員)
   ├── sales/ (営業マン)
   ├── admin/ (管理)
   └── internal/ (社内ツール)
   ```

2. 各カテゴリの担当エンジニアを割り当て
3. ファイルの移動と整理

**メリット**:
- 作業領域の明確化
- コンフリクトの減少
- 担当者の明確化

**デメリット**:
- 共通リソースの共有が複雑になる可能性

### Phase 2: APIエンドポイントの分離（中期）

**目標**: Lambda関数をカテゴリ別に分割

**実施内容**:
1. Lambda関数の分割
   - `lambda-public.py` (パブリック用)
   - `lambda-customer.py` (カスタマー用)
   - `lambda-staff.py` (清掃員用)
   - `lambda-sales.py` (営業マン用)
   - `lambda-admin.py` (管理用)
   - `lambda-internal.py` (社内ツール用)

2. 共通機能のモジュール化
   - `common/` ディレクトリに共通機能を配置
   - 各Lambda関数から共通モジュールをインポート

**メリット**:
- 各カテゴリの独立性向上
- デプロイの分離
- エラーの影響範囲の限定

**デメリット**:
- 開発・運用の複雑化
- 共通機能の更新が複数の関数に影響

### Phase 3: 完全な分離（長期・推奨しない）

**目標**: 各カテゴリを完全に独立したシステムとして分離

**実施内容**:
1. 別リポジトリへの分離
2. 別デプロイパイプラインの構築
3. 別ドメインでの運用

**メリット**:
- 完全な独立性
- スケーラビリティの向上

**デメリット**:
- 開発・運用コストの大幅な増加
- データの整合性の維持が困難
- MDCSの論理に反する（共通事項『う』の分離）

---

## 🎯 MDCSの論理に基づく推奨事項

### システムの流れ：う→あ→お→え→い

1. **『う』（存在）**: システムの存在そのもの
   - **推奨**: システムは1つとして維持
   - **理由**: システムの存在を分離することは、MDCSの根幹に反する

2. **『あ』（主観）**: 各カテゴリの担当エンジニア
   - **推奨**: ファイル構造の分離（Phase 1）
   - **理由**: 各エンジニアが担当領域を明確にできる

3. **『お』（経験知識）**: 共通コンポーネント、共通機能
   - **推奨**: 共通モジュールとして分離
   - **理由**: 知識の蓄積と再利用

4. **『え』（選択）**: 各カテゴリで必要な機能の選択
   - **推奨**: APIエンドポイントの分離（Phase 2）
   - **理由**: 各カテゴリで必要な機能のみ使用

5. **『い』（実行）**: デプロイ、運用
   - **推奨**: 段階的な分離（Phase 1 → Phase 2）
   - **理由**: 末広がりな思想に基づく段階的な拡張

### 対比関係：うわをゑゐ

- **『う』**: システムの存在（共通事項）
- **『わ』**: コードレビュー、統合管理（受け手）
- **『を』**: 共通コンポーネント、共通機能（蓄えられる側）
- **『ゑ』**: 選択された実装、機能（選ばれる側）
- **『ゐ』**: デプロイされたシステム（実行される側）

---

## 📋 結論

### 現状での分離可否

**結論**: **🟡 部分的な分離は可能、完全な分離は困難**

### 推奨されるアプローチ

1. **Phase 1: ファイル構造の分離**（即座に可能）
   - 各カテゴリのファイルを明確に分離
   - 担当エンジニアを割り当て
   - 作業領域の明確化

2. **Phase 2: APIエンドポイントの分離**（中期）
   - Lambda関数をカテゴリ別に分割
   - 共通機能のモジュール化
   - 各カテゴリの独立性向上

3. **完全な分離は推奨しない**
   - MDCSの論理に反する（共通事項『う』の分離）
   - 開発・運用コストの大幅な増加
   - データの整合性の維持が困難

### MDCSの論理に基づく判断

- **システムの存在（『う』）は1つとして維持**
- **各カテゴリ（『あ』）はファイル構造で分離**
- **共通機能（『お』）はモジュールとして分離**
- **段階的な拡張（末広がりな思想）**

このアプローチにより、MDCSの論理に基づいた、一貫性のある開発環境を構築できます。

