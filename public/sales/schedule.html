<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="/" />
    <title>スケジュール管理 | ミセサポ</title>
    <link rel="icon" type="image/png" href="/images/logo_144x144.png" />
<link rel="shortcut icon" href="/images/logo_144x144.png" />
<link rel="apple-touch-icon" href="/images/logo_144x144.png" />
<link rel="stylesheet" href="/styles.css" />
<link rel="stylesheet" href="/css/header.css" />
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<!-- 
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet" />
-->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<style>
  body { font-family: 'Noto Sans JP', 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif; }
  /* Brand theme variables (default + variants) */
  body { --primary: #FF679C; --primary-600: #E35687; }
  body.theme-pink { --primary: #FF679C; --primary-600: #E35687; }
  body.theme-blue { --primary: #2563eb; --primary-600: #1d4ed8; }
  body.theme-emerald { --primary: #10b981; --primary-600: #059669; }
  /* Note: :root also defines the same brand color; inline vars ensure early paint */
  </style>

  </head>
  <body class="theme-pink page-sales-schedule">
    <div id="default-header-wrapper">
    <a class="skip-link" href="#main">メインコンテンツへスキップ</a>
<header id="header-guest" class="site-header" data-role="guest">
  <div class="inner wide">
    <div class="nav-left">
      <a class="brand brand-logo" href="/index.html" aria-label="ミセサポ ホーム">
        <img src="/images/logo_144x144.png" alt="ミセサポ" />
      </a>
      <nav id="nav-guest" class="nav-left hide-sm" aria-label="Primary">
        <!-- ナビゲーション項目はJavaScriptで動的に生成されます -->
      </nav>
    </div>
    <div class="spacer"></div>
    <nav class="nav-right hide-sm" aria-label="User">
      <span class="role-badge" style="padding: 4px 12px; background: #e5e7eb; color: #6b7280; border-radius: 4px; font-size: 0.875rem; font-weight: 500;">ゲスト</span>
      <a class="nav-link" href="/signin.html">ログイン</a>
      <a class="nav-link primary" href="/signup.html">新規登録</a>
      <button class="icon-btn" aria-label="通知">
        <i class="fas fa-bell"></i>
      </button>
      <button class="icon-btn" aria-label="ログアウト" onclick="window.Auth && window.Auth.logout()" style="display: none;">
        <i class="fas fa-sign-out-alt"></i>
      </button>
    </nav>
    <button class="hamburger-btn show-sm" aria-label="メニュー" aria-expanded="false" id="hamburger-btn">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </div>
  <!-- スマホ版ナビゲーションメニュー -->
  <nav class="mobile-nav show-sm" id="mobile-nav" aria-label="モバイルナビゲーション">
    <div class="mobile-nav-content">
      <nav class="mobile-nav-primary" id="mobile-nav-primary" aria-label="Primary">
        <!-- ナビゲーション項目はJavaScriptで動的に生成されます -->
      </nav>
      <nav class="mobile-nav-user" aria-label="User">
        <span class="role-badge" style="padding: 4px 12px; background: #e5e7eb; color: #6b7280; border-radius: 4px; font-size: 0.875rem; font-weight: 500;">ゲスト</span>
        <a class="mobile-nav-link" href="/signin.html">ログイン</a>
        <a class="mobile-nav-link primary" href="/signup.html">新規登録</a>
      </nav>
    </div>
  </nav>
</header>

    </div>
    <!-- 通常ヘッダー（ログイン画面用） -->
    <div id="normal-header-wrapper" style="display: none;">
    <!-- 通常ヘッダー -->
<header class="normal-header">
    <div class="normal-header-inner">
        <div class="normal-header-logo">
            <a href="/">
                <img id="normal-header-logo-img" src="/images-material/logo_144x144.png" alt="ロゴ" onerror="this.style.display='none'">
            </a>
                </div>
        <nav class="normal-header-nav">
            <a href="/">TOP</a>
            <a href="/service.html">対応可能サービス</a>
            <a href="/lp.html#voice">お客様の声</a>
            <a href="/customers-support-desk.html">カスタマーズサポート</a>
            <a href="/announcements.html">お知らせ</a>
            <a href="/privacy-policy.html">規約＆ポリシー</a>
        </nav>
        <div class="normal-header-actions">
            <a href="/signin.html" class="normal-header-login">ログイン</a>
        </div>
            </div>
</header>


    </div>
    <main id="main">
      



<script src="/js/data_utils.js"></script>

<main id="main" class="gcal-mobile">
  <!-- ヘッダー -->
  <header class="gcal-header">
    <button class="menu-btn" id="menu-btn">
      <i class="fas fa-bars"></i>
    </button>
    <div class="header-title" id="header-title">
      <span class="month">11月</span>
      <span class="year">2025</span>
  </div>
    <button class="today-btn" id="today-btn">今日</button>
    <button class="search-btn">
        <i class="fas fa-search"></i>
      </button>
  </header>

  <!-- 月カレンダー（折りたたみ） -->
  <div class="month-picker" id="month-picker">
    <div class="month-nav">
      <button id="prev-month"><i class="fas fa-chevron-left"></i></button>
      <span id="month-label">2025年11月</span>
      <button id="next-month"><i class="fas fa-chevron-right"></i></button>
    </div>
    <div class="month-weekdays">
      <span class="sun">日</span><span>月</span><span>火</span><span>水</span><span>木</span><span>金</span><span class="sat">土</span>
    </div>
    <div class="month-days" id="month-days"></div>
  </div>

  <!-- 週ストリップ -->
  <div class="week-strip" id="week-strip">
    <div class="week-days" id="week-days"></div>
  </div>

  <!-- スケジュールビュー -->
  <div class="schedule-view" id="schedule-view">
    <!-- 動的生成 -->
    </div>

  <!-- FAB -->
  <button class="fab" id="fab" onclick="openDraftModal()">
    <i class="fas fa-plus"></i>
        </button>

  <!-- 仮押さえモーダル -->
  <div class="draft-sheet" id="draft-sheet">
    <div class="sheet-handle"></div>
    <div class="sheet-content">
      <h2>スケジュール仮押さえ</h2>
      <p class="draft-hint">希望日時を登録します。管理者が確認後、清掃員をアサインして確定します。</p>
      <form id="draft-form">
        <div class="form-group">
          <label>顧客（店舗）<span class="req">*</span></label>
          <select id="draft-store" required>
            <option value="">選択してください</option>
          </select>
        </div>
        <div class="form-group">
          <label>希望日<span class="req">*</span></label>
          <input type="date" id="draft-date" required>
      </div>
        <div class="form-group">
          <label>希望時間<span class="req">*</span></label>
          <input type="time" id="draft-time" required>
        </div>
        <div class="form-group">
          <label>作業時間（分）</label>
          <select id="draft-duration">
            <option value="60">60分</option>
            <option value="90">90分</option>
            <option value="120">120分</option>
            <option value="180">180分</option>
          </select>
        </div>
        <div class="form-group">
          <label>備考・要望</label>
          <textarea id="draft-notes" rows="3" placeholder="清掃内容や注意事項など"></textarea>
        </div>
        <div class="form-actions">
          <button type="button" class="btn-cancel" onclick="closeDraftModal()">キャンセル</button>
          <button type="submit" class="btn-submit">仮押さえする</button>
        </div>
      </form>
    </div>
  </div>
  <div class="draft-overlay" id="draft-overlay" onclick="closeDraftModal()"></div>

  <!-- サイドメニュー -->
  <div class="side-menu" id="side-menu">
    <div class="menu-header">
      <img src="/images/logo_144x144.png" alt="ミセサポ" class="menu-logo">
      <span>ミセサポ</span>
    </div>
    <nav class="menu-nav">
      <a href="/sales/dashboard.html" class="menu-item">
        <i class="fas fa-home"></i> ダッシュボード
      </a>
      <a href="/sales/schedule.html" class="menu-item active">
        <i class="fas fa-calendar"></i> スケジュール
      </a>
      <a href="/sales/clients.html" class="menu-item">
        <i class="fas fa-building"></i> 顧客一覧
      </a>
    </nav>
    <div class="menu-section">
      <h4>表示</h4>
      <label class="menu-check">
        <input type="checkbox" id="show-scheduled" checked>
        <span class="check-color scheduled"></span>
        予定
      </label>
      <label class="menu-check">
        <input type="checkbox" id="show-completed" checked>
        <span class="check-color completed"></span>
        完了
      </label>
    </div>
  </div>
  <div class="menu-overlay" id="menu-overlay"></div>

  <!-- 下部タブバー -->
  <nav class="bottom-tab-bar">
    <a href="/sales/dashboard.html" class="tab-item">
      <i class="fas fa-home"></i>
      <span>ホーム</span>
    </a>
    <a href="/sales/schedule.html" class="tab-item active">
      <i class="fas fa-calendar"></i>
      <span>スケジュール</span>
    </a>
    <a href="/sales/clients.html" class="tab-item">
      <i class="fas fa-building"></i>
      <span>顧客</span>
    </a>
    <a href="/sales/estimates.html" class="tab-item">
      <i class="fas fa-file-invoice"></i>
      <span>見積</span>
    </a>
  </nav>

  <!-- イベント詳細 -->
  <div class="event-sheet" id="event-sheet">
    <div class="sheet-handle"></div>
    <div class="sheet-content">
      <div class="event-header">
        <div class="event-color" id="event-color"></div>
        <h2 id="event-title">店舗名</h2>
      </div>
      <div class="event-info">
        <div class="info-item">
          <i class="fas fa-clock"></i>
          <div>
            <div id="event-date">2025年11月26日（水）</div>
            <div id="event-time" class="sub">10:00 - 11:00</div>
          </div>
        </div>
        <div class="info-item">
          <i class="fas fa-map-marker-alt"></i>
          <span id="event-address">東京都新宿区...</span>
        </div>
        <div class="info-item">
          <i class="fas fa-user"></i>
          <span id="event-worker">担当: 山田太郎</span>
        </div>
        <div class="info-item" id="event-notes-item">
          <i class="fas fa-align-left"></i>
          <span id="event-notes">備考テキスト</span>
        </div>
        </div>
      <div class="event-status-badge" id="event-status">予定</div>
    </div>
  </div>
  <div class="sheet-overlay" id="sheet-overlay"></div>

  <style>
    * {
      box-sizing: border-box;
    }
    .gcal-mobile {
      background: #fff;
      min-height: 100vh;
      max-width: 100%;
      overflow-x: hidden;
    }
    
    /* ヘッダー */
    .gcal-header {
      display: flex;
      align-items: center;
      padding: 8px 4px;
      background: #fff;
      position: sticky;
      top: 0;
      z-index: 100;
      border-bottom: 1px solid #e0e0e0;
    }
    .menu-btn, .search-btn {
      width: 48px;
      height: 48px;
      border: none;
      background: none;
      border-radius: 50%;
      color: #5f6368;
      font-size: 1.25rem;
    }
    .menu-btn:active, .search-btn:active {
      background: rgba(0,0,0,0.05);
    }
    .header-title {
      flex: 1;
      padding: 8px 12px;
      cursor: pointer;
    }
    .header-title .month {
      font-size: 1.25rem;
      font-weight: 500;
      color: #202124;
    }
    .header-title .year {
      font-size: 0.875rem;
      color: #5f6368;
      margin-left: 4px;
    }
    .today-btn {
      padding: 8px 16px;
      border: 1px solid var(--primary, #ff679c);
      background: #fff;
      border-radius: 20px;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--primary, #ff679c);
      margin-right: 4px;
    }
    .today-btn:active {
      background: #f1f3f4;
    }
    
    /* 月カレンダー */
    .month-picker {
      background: #fff;
      padding: 8px 16px 16px;
      display: none;
    }
    .month-picker.open {
      display: block;
    }
    .month-nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }
    .month-nav button {
      width: 40px;
      height: 40px;
      border: none;
      background: none;
      border-radius: 50%;
      color: #5f6368;
    }
    .month-nav button:active {
      background: #f1f3f4;
    }
    #month-label {
      font-size: 1rem;
      font-weight: 500;
      color: #202124;
    }
    .month-weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;
      margin-bottom: 8px;
    }
    .month-weekdays span {
      font-size: 0.75rem;
      color: #70757a;
      padding: 8px 0;
    }
    .month-weekdays .sun { color: #d93025; }
    .month-weekdays .sat { color: var(--primary, #ff679c); }
    .month-days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
    }
    .m-day {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.875rem;
      color: #202124;
      border-radius: 50%;
      cursor: pointer;
      position: relative;
    }
    .m-day:active {
      background: #f1f3f4;
    }
    .m-day.other {
      color: #dadce0;
    }
    .m-day.today {
      background: var(--primary, #ff679c);
      color: #fff;
      font-weight: 500;
    }
    .m-day.selected {
      border: 2px solid var(--primary, #ff679c);
    }
    .m-day.has-event::after {
      content: '';
      position: absolute;
      bottom: 4px;
      width: 4px;
      height: 4px;
      background: var(--primary, #ff679c);
      border-radius: 50%;
    }
    .m-day.today.has-event::after {
      background: #fff;
    }
    
    /* 週ストリップ */
    .week-strip {
      background: #fff;
      border-bottom: 1px solid #e0e0e0;
      padding: 8px 0;
    }
    .week-days {
      display: flex;
    }
    .w-day {
      flex: 1;
      text-align: center;
      padding: 4px;
      cursor: pointer;
    }
    .w-day-name {
      font-size: 0.7rem;
      color: #70757a;
      margin-bottom: 4px;
    }
    .w-day.sun .w-day-name { color: #d93025; }
    .w-day.sat .w-day-name { color: var(--primary, #ff679c); }
    .w-day-num {
      width: 40px;
      height: 40px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      color: #202124;
      border-radius: 50%;
      position: relative;
    }
    .w-day:active .w-day-num {
      background: #f1f3f4;
    }
    .w-day.today .w-day-num {
      background: var(--primary, #ff679c);
      color: #fff;
      font-weight: 500;
    }
    .w-day.selected .w-day-num {
      border: 2px solid var(--primary, #ff679c);
    }
    .w-day.today.selected .w-day-num {
      border: none;
    }
    .w-day.has-event .w-day-num::after {
      content: '';
      position: absolute;
      bottom: 2px;
      width: 4px;
      height: 4px;
      background: var(--primary, #ff679c);
      border-radius: 50%;
    }
    .w-day.today.has-event .w-day-num::after {
      background: #fff;
    }
    
    /* スケジュールビュー */
    .schedule-view {
      padding: 0 0 140px;
    }
    .day-section {
      border-bottom: 1px solid #e0e0e0;
    }
    .day-header {
      display: flex;
      align-items: center;
      padding: 16px;
      position: sticky;
      top: 65px;
      background: #fff;
      z-index: 10;
    }
    .day-date {
      width: 48px;
      text-align: center;
    }
    .day-date .num {
      font-size: 1.5rem;
      font-weight: 400;
      color: #202124;
    }
    .day-date .dow {
      font-size: 0.75rem;
      color: #70757a;
    }
    .day-date.today .num {
      background: var(--primary, #ff679c);
      color: #fff;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto;
    }
    .day-date.today .dow {
      color: var(--primary, #ff679c);
    }
    .day-events {
      flex: 1;
      padding-left: 16px;
    }
    .event-card {
      display: flex;
      align-items: flex-start;
      padding: 12px;
      margin-bottom: 8px;
      background: #fff;
      border-radius: 8px;
      cursor: pointer;
      border-left: 4px solid var(--primary, #ff679c);
    }
    .event-card:active {
      background: #f8f9fa;
    }
    .event-card.completed {
      border-left-color: #34a853;
    }
    .event-time-col {
      width: 56px;
      flex-shrink: 0;
    }
    .event-time-start {
      font-size: 0.875rem;
      font-weight: 500;
      color: #202124;
    }
    .event-time-end {
      font-size: 0.75rem;
      color: #5f6368;
    }
    .event-details {
      flex: 1;
      min-width: 0;
    }
    .event-name {
      font-size: 0.9rem;
      font-weight: 500;
      color: #202124;
      margin-bottom: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .event-location {
      font-size: 0.75rem;
      color: #5f6368;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .no-events {
      padding: 24px 16px;
      text-align: center;
      color: #5f6368;
      font-size: 0.875rem;
    }
    
    /* FAB */
    .fab {
      position: fixed;
      right: 16px;
      bottom: 80px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      border: none;
      background: var(--primary, #ff679c);
      box-shadow: 0 4px 12px rgba(255, 103, 156, 0.4);
      color: #fff;
      font-size: 1.5rem;
      cursor: pointer;
      z-index: 50;
    }
    .fab:active {
      background: #e85a8a;
      transform: scale(0.95);
    }
    
    /* サイドメニュー */
    .side-menu {
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      width: 280px;
      background: #fff;
      z-index: 300;
      transform: translateX(-100%);
      transition: transform 0.25s ease;
      overflow-y: auto;
    }
    .side-menu.open {
      transform: translateX(0);
    }
    .menu-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      z-index: 299;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s;
    }
    .menu-overlay.open {
      opacity: 1;
      pointer-events: auto;
    }
    .menu-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 20px 16px;
      border-bottom: 1px solid #e0e0e0;
    }
    .menu-logo {
      width: 32px;
      height: 32px;
    }
    .menu-header span {
      font-size: 1.125rem;
      font-weight: 500;
      color: #202124;
    }
    .menu-nav {
      padding: 8px 0;
      border-bottom: 1px solid #e0e0e0;
    }
    .menu-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 12px 24px;
      color: #202124;
      text-decoration: none;
      font-size: 0.875rem;
    }
    .menu-item:active {
      background: #f1f3f4;
    }
    .menu-item.active {
      background: rgba(255, 103, 156, 0.1);
      color: var(--primary, #ff679c);
    }
    .menu-item i {
      width: 20px;
      color: #5f6368;
    }
    .menu-item.active i {
      color: var(--primary, #ff679c);
    }
    .menu-section {
      padding: 16px 24px;
    }
    .menu-section h4 {
      font-size: 0.75rem;
      font-weight: 500;
      color: #5f6368;
      margin: 0 0 12px;
    }
    .menu-check {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px 0;
      font-size: 0.875rem;
      color: #202124;
      cursor: pointer;
    }
    .menu-check input {
      display: none;
    }
    .check-color {
      width: 16px;
      height: 16px;
      border-radius: 4px;
      border: 2px solid;
    }
    .check-color.scheduled {
      border-color: var(--primary, #ff679c);
      background: var(--primary, #ff679c);
    }
    .check-color.completed {
      border-color: #34a853;
      background: #34a853;
    }
    .menu-check input:not(:checked) + .check-color {
      background: transparent;
    }
    
    /* イベント詳細シート */
    .event-sheet {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      background: #fff;
      border-radius: 16px 16px 0 0;
      z-index: 200;
      transform: translateY(100%);
      transition: transform 0.3s ease;
      max-height: 85vh;
      overflow-y: auto;
    }
    .event-sheet.open {
      transform: translateY(0);
    }
    .sheet-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      z-index: 199;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    .sheet-overlay.open {
      opacity: 1;
      pointer-events: auto;
    }
    .sheet-handle {
      width: 32px;
      height: 4px;
      background: #dadce0;
      border-radius: 2px;
      margin: 12px auto;
    }
    .sheet-content {
      padding: 8px 24px 32px;
    }
    .event-header {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 24px;
    }
    .event-color {
      width: 16px;
      height: 16px;
      border-radius: 4px;
      background: var(--primary, #ff679c);
      margin-top: 4px;
      flex-shrink: 0;
    }
    .event-color.completed {
      background: #34a853;
    }
    .event-color.draft {
      background: #ffc107;
    }
    .event-header h2 {
      font-size: 1.25rem;
      font-weight: 400;
      color: #202124;
      margin: 0;
    }
    .event-info {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-bottom: 24px;
    }
    .info-item {
      display: flex;
      align-items: flex-start;
      gap: 16px;
    }
    .info-item i {
      width: 20px;
      color: #5f6368;
      margin-top: 2px;
    }
    .info-item span, .info-item div {
      font-size: 0.9rem;
      color: #202124;
    }
    .info-item .sub {
      font-size: 0.8rem;
      color: #5f6368;
      margin-top: 2px;
    }
    .event-status-badge {
      display: inline-block;
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
      background: rgba(255, 103, 156, 0.1);
      color: var(--primary, #ff679c);
    }
    .event-status-badge.completed {
      background: #e6f4ea;
      color: #137333;
    }
    
    /* 仮押さえモーダル */
    .draft-sheet {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      background: #fff;
      border-radius: 16px 16px 0 0;
      z-index: 200;
      transform: translateY(100%);
      transition: transform 0.3s ease;
      max-height: 90vh;
      overflow-y: auto;
    }
    .draft-sheet.open {
      transform: translateY(0);
    }
    .draft-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      z-index: 199;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    .draft-overlay.open {
      opacity: 1;
      pointer-events: auto;
    }
    .draft-sheet .sheet-content {
      padding: 8px 24px 32px;
    }
    .draft-sheet h2 {
      font-size: 1.125rem;
      font-weight: 500;
      color: #202124;
      margin: 0 0 8px;
    }
    .draft-hint {
      font-size: 0.8rem;
      color: #5f6368;
      margin: 0 0 20px;
      padding: 10px 12px;
      background: #fff8e1;
      border-radius: 8px;
      border-left: 3px solid #ffc107;
    }
    .draft-sheet .form-group {
      margin-bottom: 16px;
    }
    .draft-sheet label {
      display: block;
      font-size: 0.8rem;
      font-weight: 500;
      color: #5f6368;
      margin-bottom: 6px;
    }
    .draft-sheet .req {
      color: #d93025;
    }
    .draft-sheet select,
    .draft-sheet input,
    .draft-sheet textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #dadce0;
      border-radius: 8px;
      font-size: 1rem;
      background: #fff;
    }
    .draft-sheet select:focus,
    .draft-sheet input:focus,
    .draft-sheet textarea:focus {
      outline: none;
      border-color: var(--primary, #ff679c);
    }
    .draft-sheet .form-actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }
    .draft-sheet .btn-cancel {
      flex: 1;
      padding: 14px;
      border: 1px solid #dadce0;
      background: #fff;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 500;
      color: #5f6368;
    }
    .draft-sheet .btn-submit {
      flex: 2;
      padding: 14px;
      border: none;
      background: var(--primary, #ff679c);
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 500;
      color: #fff;
    }
    .draft-sheet .btn-submit:active {
      background: #e85a8a;
    }
    
    /* 仮押さえバッジ */
    .event-card.draft {
      border-left-color: #ffc107;
      background: #fffde7;
    }
    .event-status-badge.draft {
      background: #fff8e1;
      color: #f57c00;
    }
    
    /* 下部タブバー */
    .bottom-tab-bar {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      height: 64px;
      background: #fff;
      display: flex;
      justify-content: space-around;
      align-items: center;
      border-top: 1px solid #e0e0e0;
      z-index: 100;
      padding-bottom: env(safe-area-inset-bottom);
    }
    .tab-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 8px 16px;
      color: #9ca3af;
      text-decoration: none;
      font-size: 0.7rem;
      transition: color 0.2s;
    }
    .tab-item i {
      font-size: 1.25rem;
    }
    .tab-item.active {
      color: var(--primary, #ff679c);
    }
    .tab-item:active {
      opacity: 0.7;
    }
    
    @media (min-width: 600px) {
      .gcal-mobile {
        max-width: 480px;
        margin: 0 auto;
        box-shadow: 0 0 20px rgba(0,0,0,0.1);
      }
      .bottom-tab-bar {
        max-width: 480px;
        left: 50%;
        transform: translateX(-50%);
      }
    }
  </style>

  <script>
    const API_BASE = 'https://51bhoxkbxd.execute-api.ap-northeast-1.amazonaws.com/prod';
    
    let allSchedules = [];
    let allStores = [];
    let allWorkers = [];
    let selectedDate = new Date();
    let currentMonth = new Date();
    const weekdays = ['日', '月', '火', '水', '木', '金', '土'];
    const dowClass = ['sun', '', '', '', '', '', 'sat'];

    document.addEventListener('DOMContentLoaded', async () => {
      await Promise.all([loadStores(), loadWorkers(), loadSchedules()]);
      updateHeader();
      renderWeekStrip();
      renderScheduleView();
      setupEventListeners();
    });

    async function loadSchedules() {
      try {
        const response = await fetch(`${API_BASE}/schedules`);
        allSchedules = await response.json();
      } catch (error) {
        console.error('Failed to load schedules:', error);
      }
    }

    async function loadStores() {
      try {
        const response = await fetch(`${API_BASE}/stores`);
        allStores = await response.json();
      } catch (error) {
        console.error('Failed to load stores:', error);
      }
    }

    async function loadWorkers() {
      try {
        const response = await fetch(`${API_BASE}/workers`);
        allWorkers = await response.json();
      } catch (error) {
        console.error('Failed to load workers:', error);
      }
    }

    function getStoreName(id) {
      const s = allStores.find(x => x.id === id);
      return s ? s.name : '不明';
    }

    function getStoreAddress(id) {
      const s = allStores.find(x => x.id === id);
      return s ? `${s.pref || ''}${s.city || ''}${s.address1 || ''}` : '';
    }

    function getWorkerName(id) {
      if (!id) return '未割当';
      const w = allWorkers.find(x => x.id === id);
      return w ? w.name : '不明';
    }

    function updateHeader() {
      const m = selectedDate.getMonth() + 1;
      const y = selectedDate.getFullYear();
      document.querySelector('.header-title .month').textContent = `${m}月`;
      document.querySelector('.header-title .year').textContent = y;
    }

    function getWeekStart(d) {
      const date = new Date(d);
      date.setDate(date.getDate() - date.getDay());
      return date;
    }

    function renderWeekStrip() {
      const ws = getWeekStart(selectedDate);
      const today = new Date();
      today.setHours(0,0,0,0);
      const eventDates = new Set(allSchedules.map(s => s.scheduled_date));
      
      let html = '';
      for (let i = 0; i < 7; i++) {
        const d = new Date(ws);
        d.setDate(d.getDate() + i);
        const dateStr = d.toISOString().split('T')[0];
        const isToday = d.toDateString() === today.toDateString();
        const isSelected = d.toDateString() === selectedDate.toDateString();
        const hasEvent = eventDates.has(dateStr);
        
        html += `
          <div class="w-day ${dowClass[i]} ${isToday ? 'today' : ''} ${isSelected ? 'selected' : ''} ${hasEvent ? 'has-event' : ''}" data-date="${dateStr}">
            <div class="w-day-name">${weekdays[i]}</div>
            <div class="w-day-num">${d.getDate()}</div>
          </div>
        `;
      }
      document.getElementById('week-days').innerHTML = html;
    }

    function renderMonthPicker() {
      const y = currentMonth.getFullYear();
      const m = currentMonth.getMonth();
      document.getElementById('month-label').textContent = `${y}年${m + 1}月`;
      
      const firstDay = new Date(y, m, 1);
      const lastDay = new Date(y, m + 1, 0);
      const startDow = firstDay.getDay();
      const daysInMonth = lastDay.getDate();
      const today = new Date();
      today.setHours(0,0,0,0);
      const eventDates = new Set(allSchedules.map(s => s.scheduled_date));
      
      let html = '';
      const prevLast = new Date(y, m, 0).getDate();
      for (let i = startDow - 1; i >= 0; i--) {
        html += `<div class="m-day other">${prevLast - i}</div>`;
      }
      
      for (let i = 1; i <= daysInMonth; i++) {
        const d = new Date(y, m, i);
        const dateStr = d.toISOString().split('T')[0];
        const isToday = d.toDateString() === today.toDateString();
        const isSelected = d.toDateString() === selectedDate.toDateString();
        const hasEvent = eventDates.has(dateStr);
        html += `<div class="m-day ${isToday ? 'today' : ''} ${isSelected ? 'selected' : ''} ${hasEvent ? 'has-event' : ''}" data-date="${dateStr}">${i}</div>`;
      }
      
      const remaining = 42 - (startDow + daysInMonth);
      for (let i = 1; i <= remaining; i++) {
        html += `<div class="m-day other">${i}</div>`;
      }
      
      document.getElementById('month-days').innerHTML = html;
    }

    function renderScheduleView() {
      const container = document.getElementById('schedule-view');
      const showScheduled = document.getElementById('show-scheduled').checked;
      const showCompleted = document.getElementById('show-completed').checked;
      
      // 選択日から7日分表示
      const ws = getWeekStart(selectedDate);
      const today = new Date();
      today.setHours(0,0,0,0);
      
      let html = '';
      for (let i = 0; i < 7; i++) {
        const d = new Date(ws);
        d.setDate(d.getDate() + i);
        const dateStr = d.toISOString().split('T')[0];
        const isToday = d.toDateString() === today.toDateString();
        
        let daySchedules = allSchedules.filter(s => s.scheduled_date === dateStr);
        daySchedules = daySchedules.filter(s => {
          if (s.status === 'completed') return showCompleted;
          return showScheduled;
        });
        daySchedules.sort((a, b) => (a.scheduled_time || '').localeCompare(b.scheduled_time || ''));
        
        html += `
          <div class="day-section">
            <div class="day-header">
              <div class="day-date ${isToday ? 'today' : ''}">
                <div class="num">${d.getDate()}</div>
                <div class="dow">${weekdays[d.getDay()]}</div>
              </div>
              <div class="day-events">
                ${daySchedules.length > 0 ? daySchedules.map(s => {
                  const endTime = calcEndTime(s.scheduled_time, s.duration_minutes);
                  const statusClass = s.status === 'completed' ? 'completed' : (s.status === 'draft' ? 'draft' : '');
                  return `
                    <div class="event-card ${statusClass}" onclick="showEvent('${s.id}')">
                      <div class="event-time-col">
                        <div class="event-time-start">${s.scheduled_time || '-'}</div>
                        <div class="event-time-end">${endTime}</div>
                      </div>
                      <div class="event-details">
                        <div class="event-name">${escapeHtml(getStoreName(s.store_id))}</div>
                        <div class="event-location">${escapeHtml(getStoreAddress(s.store_id))}</div>
                      </div>
                    </div>
                  `;
                }).join('') : '<div class="no-events">予定なし</div>'}
              </div>
            </div>
          </div>
        `;
      }
      container.innerHTML = html;
    }

    function calcEndTime(start, duration) {
      if (!start) return '';
      const [h, m] = start.split(':').map(Number);
      const total = h * 60 + m + (duration || 60);
      return `${String(Math.floor(total / 60) % 24).padStart(2, '0')}:${String(total % 60).padStart(2, '0')}`;
    }

    window.showEvent = function(id) {
      const s = allSchedules.find(x => x.id === id);
      if (!s) return;
      
      const d = new Date(s.scheduled_date);
      const endTime = calcEndTime(s.scheduled_time, s.duration_minutes);
      
      document.getElementById('event-title').textContent = getStoreName(s.store_id);
      document.getElementById('event-date').textContent = `${d.getFullYear()}年${d.getMonth()+1}月${d.getDate()}日（${weekdays[d.getDay()]}）`;
      document.getElementById('event-time').textContent = `${s.scheduled_time || '-'} - ${endTime}（${s.duration_minutes || 60}分）`;
      document.getElementById('event-address').textContent = getStoreAddress(s.store_id) || '-';
      document.getElementById('event-worker').textContent = `担当: ${getWorkerName(s.worker_id)}`;
      
      const notesItem = document.getElementById('event-notes-item');
      if (s.notes) {
        document.getElementById('event-notes').textContent = s.notes;
        notesItem.style.display = 'flex';
      } else {
        notesItem.style.display = 'none';
      }
      
      const isDraft = s.status === 'draft';
      const isCompleted = s.status === 'completed';
      document.getElementById('event-color').className = 'event-color' + (isCompleted ? ' completed' : (isDraft ? ' draft' : ''));
      const statusEl = document.getElementById('event-status');
      statusEl.textContent = isDraft ? '仮押さえ' : (isCompleted ? '完了' : '確定');
      statusEl.className = 'event-status-badge' + (isCompleted ? ' completed' : (isDraft ? ' draft' : ''));
      
      document.getElementById('event-sheet').classList.add('open');
      document.getElementById('sheet-overlay').classList.add('open');
    };

    function setupEventListeners() {
      // メニュー
      document.getElementById('menu-btn').addEventListener('click', () => {
        document.getElementById('side-menu').classList.add('open');
        document.getElementById('menu-overlay').classList.add('open');
      });
      document.getElementById('menu-overlay').addEventListener('click', () => {
        document.getElementById('side-menu').classList.remove('open');
        document.getElementById('menu-overlay').classList.remove('open');
      });
      
      // ヘッダータイトル（月カレンダー表示）
      document.querySelector('.header-title').addEventListener('click', () => {
        const picker = document.getElementById('month-picker');
        if (picker.classList.contains('open')) {
          picker.classList.remove('open');
        } else {
          currentMonth = new Date(selectedDate);
          renderMonthPicker();
          picker.classList.add('open');
        }
      });
      
      // 月カレンダーナビ
      document.getElementById('prev-month').addEventListener('click', () => {
        currentMonth.setMonth(currentMonth.getMonth() - 1);
        renderMonthPicker();
      });
      document.getElementById('next-month').addEventListener('click', () => {
        currentMonth.setMonth(currentMonth.getMonth() + 1);
        renderMonthPicker();
      });
      
      // 月カレンダー日付選択
      document.getElementById('month-days').addEventListener('click', (e) => {
        const day = e.target.closest('.m-day:not(.other)');
        if (day && day.dataset.date) {
          selectedDate = new Date(day.dataset.date);
          document.getElementById('month-picker').classList.remove('open');
          updateHeader();
          renderWeekStrip();
          renderScheduleView();
        }
      });
      
      // 週ストリップ日付選択
      document.getElementById('week-days').addEventListener('click', (e) => {
        const day = e.target.closest('.w-day');
        if (day && day.dataset.date) {
          selectedDate = new Date(day.dataset.date);
          updateHeader();
          renderWeekStrip();
          renderScheduleView();
        }
      });
      
      // 今日ボタン
      document.getElementById('today-btn').addEventListener('click', () => {
        selectedDate = new Date();
        updateHeader();
        renderWeekStrip();
        renderScheduleView();
      });
      
      // フィルター
      document.getElementById('show-scheduled').addEventListener('change', renderScheduleView);
      document.getElementById('show-completed').addEventListener('change', renderScheduleView);
      
      // イベント詳細閉じる
      document.getElementById('sheet-overlay').addEventListener('click', () => {
        document.getElementById('event-sheet').classList.remove('open');
        document.getElementById('sheet-overlay').classList.remove('open');
      });
    }

    function escapeHtml(str) {
      if (!str) return '';
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    // 仮押さえモーダル
    function openDraftModal() {
      const select = document.getElementById('draft-store');
      select.innerHTML = '<option value="">選択してください</option>' +
        allStores.map(s => `<option value="${s.id}">${escapeHtml(s.name)}</option>`).join('');
      
      // デフォルトで明日の日付
      const tomorrow = new Date();
      tomorrow.setDate(tomorrow.getDate() + 1);
      document.getElementById('draft-date').value = tomorrow.toISOString().split('T')[0];
      document.getElementById('draft-time').value = '10:00';
      document.getElementById('draft-duration').value = '60';
      document.getElementById('draft-notes').value = '';
      
      document.getElementById('draft-sheet').classList.add('open');
      document.getElementById('draft-overlay').classList.add('open');
    }

    function closeDraftModal() {
      document.getElementById('draft-sheet').classList.remove('open');
      document.getElementById('draft-overlay').classList.remove('open');
    }

    // 仮押さえ送信
    document.getElementById('draft-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const storeId = document.getElementById('draft-store').value;
      const date = document.getElementById('draft-date').value;
      const time = document.getElementById('draft-time').value;
      const duration = document.getElementById('draft-duration').value;
      const notes = document.getElementById('draft-notes').value;
      
      if (!storeId || !date || !time) {
        alert('必須項目を入力してください');
        return;
      }
      
      const data = {
        id: DataUtils.IdUtils.generateSchedule(),
        store_id: storeId,
        worker_id: null, // 管理者がアサイン
        scheduled_date: date,
        scheduled_time: time,
        duration_minutes: parseInt(duration),
        status: 'draft', // 仮押さえ
        notes: notes,
        created_by: 'sales', // 営業が作成
        created_at: new Date().toISOString()
      };
      
      try {
        const response = await fetch(`${API_BASE}/schedules`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        if (response.ok) {
          alert('仮押さえを登録しました。\n管理者が確認後、確定されます。');
          closeDraftModal();
          await loadSchedules();
          renderWeekStrip();
          renderScheduleView();
        } else {
          throw new Error('Failed');
        }
      } catch (error) {
        console.error(error);
        alert('登録に失敗しました');
      }
    });
  </script>
</main>

    </main>
    <footer class="site-footer">
  <div class="container text-center muted small" style="padding: 16px 0;">
    <p>&copy; 2025 ミセサポ</p>
  </div>
</footer>


    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="/js/firebase-config.js"></script>
    <script src="/js/role_config.js"></script>
    <script src="/js/users.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/navigation.js"></script>
    <script src="/modal_manager.js"></script>
    <script src="/app.js"></script>
    <script>
      // ログイン画面では通常ヘッダーを表示
      (function() {
        const path = window.location.pathname || '';
        const isSigninPage = path.includes('/signin.html') || path.includes('/signin');
        
        // ログイン画面では通常ヘッダーを表示、デフォルトヘッダーを非表示
        if (isSigninPage) {
          const defaultHeaderWrapper = document.getElementById('default-header-wrapper');
          const normalHeaderWrapper = document.getElementById('normal-header-wrapper');
          if (defaultHeaderWrapper) {
            defaultHeaderWrapper.style.display = 'none';
          }
          if (normalHeaderWrapper) {
            normalHeaderWrapper.style.display = 'block';
            // ログイン画面では通常ヘッダーを常に表示
            const normalHeader = normalHeaderWrapper.querySelector('.normal-header');
            if (normalHeader) {
              normalHeader.classList.add('visible');
            }
          }
        }
      })();
    </script>
  </body>
  </html>


