<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <base href="/" />
    <title>スケジュール管理 | 営業ダッシュボード</title>
    
    <link rel="icon" type="image/png" href="/images/logo_144x144.png" />
<link rel="shortcut icon" href="/images/logo_144x144.png" />
<link rel="apple-touch-icon" href="/images/logo_144x144.png" />
<link rel="stylesheet" href="/styles.css" />
<link rel="stylesheet" href="/css/header.css" />
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<!-- 
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet" />
-->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<style>
  body { font-family: 'Noto Sans JP', 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif; }
  /* Brand theme variables (default + variants) */
  body { --primary: #FF679C; --primary-600: #E35687; }
  body.theme-pink { --primary: #FF679C; --primary-600: #E35687; }
  body.theme-blue { --primary: #2563eb; --primary-600: #1d4ed8; }
  body.theme-emerald { --primary: #10b981; --primary-600: #059669; }
  /* Note: :root also defines the same brand color; inline vars ensure early paint */
  </style>

    <style>
      /* Staff signin page: hide all headers */
      body.page-staff-signin #default-header-wrapper,
      body.page-staff-signin #normal-header-wrapper {
        display: none !important;
      }
      
      /* Staff pages: hide global header and footer */
      body[class*="page-staff-"] #default-header-wrapper,
      body[class*="page-staff-"] #normal-header-wrapper,
      body[class*="page-staff-"] footer {
        display: none !important;
      }
      
      /* Staff pages: ensure full height layout */
      body[class*="page-staff-"] {
        margin: 0;
        padding: 0;
      }
      
      body[class*="page-staff-"] #main {
        margin: 0;
        padding: 0;
      }
      
      /* Admin pages: hide global header while keeping auth buttons */
      body[class*="page-admin-"] #default-header-wrapper {
        height: 0;
        overflow: visible;
      }
      body[class*="page-admin-"] #default-header-wrapper .site-header {
        background: transparent;
        box-shadow: none;
        padding: 0;
        min-height: 0;
      }
      body[class*="page-admin-"] #default-header-wrapper .inner {
        justify-content: flex-end;
        padding: 0;
      }
      body[class*="page-admin-"] #default-header-wrapper .nav-left,
      body[class*="page-admin-"] #default-header-wrapper .hamburger-btn,
      body[class*="page-admin-"] #default-header-wrapper .mobile-nav,
      body[class*="page-admin-"] #default-header-wrapper .spacer,
      body[class*="page-admin-"] #default-header-wrapper .role-badge {
        display: none !important;
      }
      body[class*="page-admin-"] #default-header-wrapper .nav-right {
        position: fixed;
        top: 16px;
        right: 24px;
        display: inline-flex;
        align-items: center;
        gap: 12px;
        background: #fff;
        border-radius: 999px;
        padding: 6px 18px;
        box-shadow: 0 12px 30px rgba(15,23,42,0.18);
        z-index: 300;
      }
      body[class*="page-admin-"] #default-header-wrapper .nav-right .nav-link {
        font-weight: 600;
      }
      body[class*="page-admin-"] #default-header-wrapper .nav-right .icon-btn {
        width: 36px;
        height: 36px;
        border-radius: 999px;
        border: 1px solid #e5e7eb;
      }
      
      /* Sales pages: hide global header and footer */
      body[class*="sales-"] #default-header-wrapper,
      body[class*="sales-"] #normal-header-wrapper,
      body[class*="sales-"] footer {
        display: none !important;
      }
      
      /* Sales pages: ensure full height layout */
      body[class*="sales-"] {
        margin: 0;
        padding: 0;
      }
      
      body[class*="sales-"] #main {
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body class="theme-pink sales-schedules">
    <div id="default-header-wrapper">
    <a class="skip-link" href="#main">メインコンテンツへスキップ</a>
<header id="header-guest" class="site-header" data-role="guest">
  <div class="inner wide">
    <div class="nav-left">
      <a class="brand brand-logo" href="/" aria-label="ミセサポ ホーム">
        <img src="/images/logo_144x144.png" alt="ミセサポ" />
      </a>
      <nav id="nav-guest" class="nav-left hide-sm" aria-label="Primary">
        <!-- ナビゲーション項目はJavaScriptで動的に生成されます -->
      </nav>
    </div>
    <div class="spacer"></div>
    <nav class="nav-right hide-sm" aria-label="User">
      <span class="role-badge" style="padding: 4px 12px; background: #e5e7eb; color: #6b7280; border-radius: 4px; font-size: 0.875rem; font-weight: 500;">ゲスト</span>
      <a class="nav-link" href="/signin">ログイン</a>
      <a class="nav-link primary" href="/signup">新規登録</a>
      <button class="icon-btn" aria-label="通知">
        <i class="fas fa-bell"></i>
      </button>
      <button class="icon-btn" aria-label="ログアウト" onclick="window.Auth && window.Auth.logout()" style="display: none;">
        <i class="fas fa-sign-out-alt"></i>
      </button>
    </nav>
    <button class="hamburger-btn show-sm" aria-label="メニュー" aria-expanded="false" id="hamburger-btn">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </div>
  <!-- スマホ版ナビゲーションメニュー -->
  <nav class="mobile-nav show-sm" id="mobile-nav" aria-label="モバイルナビゲーション">
    <div class="mobile-nav-content">
      <nav class="mobile-nav-primary" id="mobile-nav-primary" aria-label="Primary">
        <!-- ナビゲーション項目はJavaScriptで動的に生成されます -->
      </nav>
      <nav class="mobile-nav-user" aria-label="User">
        <span class="role-badge" style="padding: 4px 12px; background: #e5e7eb; color: #6b7280; border-radius: 4px; font-size: 0.875rem; font-weight: 500;">ゲスト</span>
        <a class="mobile-nav-link" href="/signin">ログイン</a>
        <a class="mobile-nav-link primary" href="/signup">新規登録</a>
      </nav>
    </div>
  </nav>
</header>

    </div>
    <!-- 通常ヘッダー（ログイン画面用） -->
    <div id="normal-header-wrapper" style="display: none;">
    <!-- 通常ヘッダー -->
<header class="normal-header">
    <div class="normal-header-inner">
        <div class="normal-header-logo">
            <a href="/">
                <img id="normal-header-logo-img" src="/images-material/logo_144x144.png" alt="ロゴ" onerror="this.style.display='none'">
            </a>
                </div>
        <nav class="normal-header-nav">
            <a href="/">TOP</a>
            <a href="/service">対応可能サービス</a>
            <a href="/lp#voice">お客様の声</a>
            <a href="/customers-support-desk">カスタマーズサポート</a>
            <a href="/announcements">お知らせ</a>
            <a href="/privacy-policy">規約＆ポリシー</a>
        </nav>
        <div class="normal-header-actions">
            <a href="/signin" class="normal-header-login">ログイン</a>
        </div>
            </div>
</header>


    </div>
    <main id="main">
      



<link rel="stylesheet" href="/css/sales-schedules.css" />
<script src="/js/data_utils.js"></script>
<script src="/js/aws-services-api.js"></script>

<main id="main" class="container sales-schedules">
  <div class="page-header">
    <a href="/sales/dashboard" class="back-btn">
      <i class="fas fa-chevron-left"></i>
    </a>
    <h1 class="page-title">スケジュール管理</h1>
    <div class="header-actions">
      <button type="button" class="btn-icon" id="view-toggle" title="カレンダー表示">
        <i class="fas fa-calendar"></i>
      </button>
      <button type="button" class="btn btn-primary btn-sm" id="add-schedule-btn">
        <i class="fas fa-plus"></i> 新規作成
      </button>
    </div>
  </div>

  <!-- 新規案件アラート -->
  <div class="new-project-alert hidden" id="draft-alert">
    <div class="new-project-alert-icon">
      <i class="fas fa-clock"></i>
    </div>
    <div class="new-project-alert-content">
      <div class="new-project-alert-title">新規案件があります</div>
      <div class="new-project-alert-text" id="draft-alert-text">未確定のスケジュールが<span id="draft-count">0</span>件あります。</div>
    </div>
    <button class="new-project-alert-btn" onclick="filterNewProjects()">
      <i class="fas fa-list"></i> 確認する
    </button>
  </div>

  <!-- フィルター -->
  <div class="filter-section">
    <div class="filter-row">
      <div class="filter-group">
        <label>店舗</label>
        <select id="store-filter">
          <option value="">全店舗</option>
        </select>
      </div>
      <div class="filter-group">
        <label>清掃員</label>
        <select id="worker-filter">
          <option value="">全員</option>
        </select>
      </div>
      <div class="filter-group">
        <label>ステータス</label>
        <select id="status-filter">
          <option value="">全て</option>
          <option value="draft">未確定</option>
          <option value="scheduled">確定</option>
          <option value="in_progress">作業中</option>
          <option value="completed">完了</option>
          <option value="cancelled">キャンセル</option>
        </select>
      </div>
      <button type="button" class="btn btn-secondary btn-sm" id="reset-filters">
        <i class="fas fa-undo"></i> リセット
      </button>
    </div>
  </div>

  <!-- リスト表示 -->
  <div class="schedule-list-view" id="list-view">
    <div class="schedule-card-list" id="schedule-card-list">
      <div class="loading-state">
        <i class="fas fa-spinner fa-spin"></i> 読み込み中...
      </div>
    </div>
    <div class="pagination" id="pagination"></div>
  </div>

  <!-- カレンダー表示 -->
  <div class="schedule-calendar-view" id="calendar-view" style="display:none;">
    <div class="calendar-header">
      <button type="button" class="btn btn-icon" id="prev-month">
        <i class="fas fa-chevron-left"></i>
      </button>
      <h2 id="calendar-month">2025年11月</h2>
      <button type="button" class="btn btn-icon" id="next-month">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
    <div class="calendar-weekdays">
      <div class="calendar-day-header sun">日</div>
      <div class="calendar-day-header">月</div>
      <div class="calendar-day-header">火</div>
      <div class="calendar-day-header">水</div>
      <div class="calendar-day-header">木</div>
      <div class="calendar-day-header">金</div>
      <div class="calendar-day-header sat">土</div>
    </div>
    <div class="calendar-grid" id="calendar-days"></div>
  </div>
</main>

<!-- ボトムタブナビゲーション -->
<nav class="bottom-tabs">
  <button class="tab" onclick="window.location.href='/sales/dashboard'">
    <i class="fas fa-bolt"></i>
    <span>アクティビティ</span>
  </button>
  <button class="tab" onclick="window.location.href='/sales/dashboard#client'">
    <i class="fas fa-user-plus"></i>
    <span>顧客登録</span>
  </button>
  <button class="tab active" onclick="window.location.href='/sales/schedules'">
    <i class="fas fa-calendar"></i>
    <span>スケジュール</span>
  </button>
  <button class="tab" onclick="window.location.href='/sales/dashboard#case'">
    <i class="fas fa-folder-open"></i>
    <span>案件管理</span>
  </button>
</nav>

<!-- 新規作成/編集ダイアログ -->
<dialog id="schedule-dialog" class="schedule-dialog">
  <div class="dialog-content">
    <button type="button" class="dialog-close" onclick="document.getElementById('schedule-dialog').close()">
      <i class="fas fa-times"></i>
    </button>
    <h3 id="dialog-title">新規スケジュール作成</h3>
    <form id="schedule-form">
      <input type="hidden" id="schedule-id" name="id">
      
      <div class="form-row">
        <div class="form-field">
          <label for="schedule-store-search">店舗・ブランド・法人名 <span class="required">*</span></label>
          <div class="store-search-wrapper">
            <div class="store-search-controls">
              <select id="store-category-filter" class="store-category-filter">
                <option value="">全て</option>
                <option value="store">店舗名</option>
                <option value="brand">ブランド名</option>
                <option value="client">法人名</option>
              </select>
              <input type="text" id="schedule-store-search" placeholder="店舗名、ブランド名、法人名で検索..." autocomplete="off" required>
            </div>
            <input type="hidden" id="schedule-store" name="store_id">
            <div class="store-search-results" id="schedule-store-results" style="display: none;"></div>
          </div>
          <div style="display:flex; gap:8px; margin-top:8px; flex-wrap:wrap;">
            <a class="btn btn-secondary btn-sm" href="/sales/clients/new.html" target="_blank" rel="noopener noreferrer" id="open-customers-page-btn">
              <i class="fas fa-external-link-alt"></i> 新規顧客（店舗）登録
            </a>
            <button type="button" class="btn btn-secondary btn-sm" id="reload-customers-data-btn">
              <i class="fas fa-sync-alt"></i> 顧客データ再読み込み
            </button>
          </div>
          <div id="schedule-store-summary" style="margin-top:8px;color:#6b7280;font-size:0.875rem;">
            <div><strong style="color:#111827;">選択中:</strong> <span id="schedule-store-summary-store">-</span></div>
            <div>法人: <span id="schedule-store-summary-client">-</span> / ブランド: <span id="schedule-store-summary-brand">-</span></div>
            <div>住所: <span id="schedule-store-summary-address">-</span></div>
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-field">
          <label for="schedule-address">住所（必要に応じて編集）</label>
          <textarea id="schedule-address" name="address" rows="2" placeholder="住所を入力（店舗選択で自動入力されます）"></textarea>
        </div>
      </div>

      <div class="form-row">
        <div class="form-field half">
          <label for="schedule-phone">電話番号</label>
          <input type="tel" id="schedule-phone" name="phone" placeholder="店舗の電話番号（店舗選択で自動入力）">
        </div>
        <div class="form-field half">
          <label for="schedule-email">メール</label>
          <input type="email" id="schedule-email" name="email" placeholder="連絡先メール（店舗選択で自動入力）">
        </div>
      </div>

      <div class="form-row">
        <div class="form-field">
          <label for="schedule-contact-person">相手先担当者名</label>
          <input type="text" id="schedule-contact-person" name="contact_person" placeholder="当日の相手先担当者（店舗選択で自動入力）">
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-field half">
          <label for="schedule-date">日付 <span class="required">*</span></label>
          <input type="date" id="schedule-date" name="scheduled_date" required>
        </div>
        <div class="form-field half">
          <label for="schedule-time">時間 <span class="required">*</span></label>
          <input type="time" id="schedule-time" name="scheduled_time" required>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-field half">
          <label for="schedule-duration">作業時間（分）</label>
          <input type="number" id="schedule-duration" name="duration_minutes" value="60" min="15" step="15">
        </div>
        <div class="form-field half">
          <label for="schedule-sales">営業担当者</label>
          <select id="schedule-sales" name="sales_id">
            <option value="">未設定</option>
          </select>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-field half">
          <label for="schedule-worker">担当清掃員</label>
          <select id="schedule-worker" name="worker_id">
            <option value="">未割当</option>
          </select>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-field">
          <label for="cleaning-items-search">清掃内容</label>
          <div class="cleaning-items-search-wrapper">
            <div class="store-search-controls">
              <select id="cleaning-category-filter" class="store-category-filter">
                <option value="">全て</option>
                <option value="service">サービス名</option>
              </select>
              <input type="text" id="cleaning-items-search" placeholder="清掃内容（サービス）を検索..." autocomplete="off">
            </div>
            <div class="cleaning-items-results" id="cleaning-items-results" style="display: none;"></div>
          </div>
          <div class="cleaning-items-selected" id="cleaning-items-selected">
            <div style="color: #9ca3af; font-size: 0.875rem; padding: 8px;">選択された清掃内容がありません</div>
          </div>
          <input type="hidden" id="selected-cleaning-items-json" name="cleaning_items">
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-field">
          <label for="schedule-status">ステータス</label>
          <select id="schedule-status" name="status">
            <option value="draft">未確定</option>
            <option value="scheduled">確定</option>
            <option value="in_progress">作業中</option>
            <option value="completed">完了</option>
            <option value="cancelled">キャンセル</option>
          </select>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-field">
          <label for="schedule-notes">備考</label>
          <textarea id="schedule-notes" name="notes" rows="3" placeholder="特記事項があれば入力"></textarea>
        </div>
      </div>
      
      <div class="form-status" id="form-status"></div>
      <div class="dialog-actions">
        <button type="button" class="btn btn-secondary" onclick="document.getElementById('schedule-dialog').close()">キャンセル</button>
        <button type="submit" class="btn btn-primary">保存</button>
      </div>
    </form>
  </div>
</dialog>

<!-- 削除確認ダイアログ -->
<dialog id="delete-dialog" class="delete-dialog">
  <div class="dialog-content dialog-sm">
    <h3>削除確認</h3>
    <p id="delete-message">このスケジュールを削除しますか？</p>
    <div class="dialog-actions">
      <button type="button" class="btn btn-secondary" onclick="document.getElementById('delete-dialog').close()">キャンセル</button>
      <button type="button" class="btn btn-danger" id="confirm-delete">削除</button>
    </div>
  </div>
</dialog>

<script src="/js/sales-schedules.js"></script>


    </main>
    <footer class="site-footer">
  <div class="container text-center muted small" style="padding: 16px 0;">
    <p>&copy; 2025 ミセサポ</p>
  </div>
</footer>


    <!-- Firebase SDK - 削除済み（Cognitoに移行） -->
    <script src="/js/role_config.js"></script>
    <script src="/js/users.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/navigation.js"></script>
    <script src="/modal_manager.js"></script>
    <script src="/app.js"></script>
    <script>
      // ログイン画面では通常ヘッダーを表示
      (function() {
        const path = window.location.pathname || '';
        const isSigninPage = path.includes('/signin.html') || path.includes('/signin');
        
        // ログイン画面では通常ヘッダーを表示、デフォルトヘッダーを非表示
        if (isSigninPage) {
          const defaultHeaderWrapper = document.getElementById('default-header-wrapper');
          const normalHeaderWrapper = document.getElementById('normal-header-wrapper');
          if (defaultHeaderWrapper) {
            defaultHeaderWrapper.style.display = 'none';
          }
          if (normalHeaderWrapper) {
            normalHeaderWrapper.style.display = 'block';
            // ログイン画面では通常ヘッダーを常に表示
            const normalHeader = normalHeaderWrapper.querySelector('.normal-header');
            if (normalHeader) {
              normalHeader.classList.add('visible');
            }
          }
        }
      })();
    </script>
  </body>
  </html>


